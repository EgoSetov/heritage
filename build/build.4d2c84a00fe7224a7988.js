/*! For license information please see build.4d2c84a00fe7224a7988.js.LICENSE.txt */
(()=>{"use strict";var e,t,n={},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var s=r[e]={id:e,exports:{}};return n[e](s,s.exports,i),s.exports}i.m=n,i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,n)=>(i.f[n](e,t),t)),[])),i.u=e=>"build.6d6de5dd1e2a39880d18.js",i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="heritage:",i.l=(n,r,s,o)=>{if(e[n])e[n].push(r);else{var a,c;if(void 0!==s)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var h=u[l];if(h.getAttribute("src")==n||h.getAttribute("data-webpack")==t+s){a=h;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,i.nc&&a.setAttribute("nonce",i.nc),a.setAttribute("data-webpack",t+s),a.src=n),e[n]=[r];var d=(t,r)=>{a.onerror=a.onload=null,clearTimeout(f);var i=e[n];if(delete e[n],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(r))),t)return t(r)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),c&&document.head.appendChild(a)}},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;i.g.importScripts&&(e=i.g.location+"");var t=i.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),i.p=e})(),(()=>{var e={179:0};i.f.j=(t,n)=>{var r=i.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var s=new Promise(((n,i)=>r=e[t]=[n,i]));n.push(r[2]=s);var o=i.p+i.u(t),a=new Error;i.l(o,(n=>{if(i.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var s=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+s+": "+o+")",a.name="ChunkLoadError",a.type=s,a.request=o,r[1](a)}}),"chunk-"+t,t)}};var t=(t,n)=>{var r,s,[o,a,c]=n,u=0;if(o.some((t=>0!==e[t]))){for(r in a)i.o(a,r)&&(i.m[r]=a[r]);c&&c(i)}for(t&&t(n);u<o.length;u++)s=o[u],i.o(e,s)&&e[s]&&e[s][0](),e[s]=0},n=self.webpackChunkheritage=self.webpackChunkheritage||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),i.nc=void 0;var s={};i.r(s),i.d(s,{FirebaseError:()=>P,SDK_VERSION:()=>Le,_DEFAULT_ENTRY_NAME:()=>Te,_addComponent:()=>Ae,_addOrOverwriteComponent:()=>Ne,_apps:()=>Se,_clearComponents:()=>xe,_components:()=>ke,_getProvider:()=>De,_registerComponent:()=>Ce,_removeServiceInstance:()=>Re,deleteApp:()=>Ue,getApp:()=>Fe,getApps:()=>Ve,initializeApp:()=>Me,onLog:()=>Be,registerVersion:()=>qe,setLogLevel:()=>je});const o=new bootstrap.Modal("#exampleModal",{keyboard:!1}),a=new bootstrap.Modal("#forDevops",{keyboard:!1}),c=document.querySelector(".rours"),u=document.querySelector(".modal-xl"),l=document.querySelector("#forDevops"),h=document.querySelector("form.formClients"),d=document.querySelectorAll("form.formClients")[1],f=document.querySelector("form.formRoutes"),p=document.querySelector("form.formReviews"),m=h.querySelector("button"),g=f.querySelector("button"),y=p.querySelector("button"),v=document.querySelector(".reviews"),w=document.querySelector(".btnForDevops"),b={roursEl:c,modalRoute:u,formClients:h,formClientsDevops:d,formRoutes:f,formReviews:p,btnSubmitClient:m,btnSubmitRoute:g,btnSubmitReviews:y,reviews:v,modalforDevops:l,btnForDevops:w};w.addEventListener("click",(async()=>{a.show()}));const I=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},_={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[u],n[l],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(I(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==o||null==a)throw Error();const c=i<<2|s>>4;if(r.push(c),64!==o){const e=s<<4&240|o>>2;if(r.push(e),64!==a){const e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},T=function(e){return function(e){const t=I(e);return _.encodeByteArray(t,!0)}(e).replace(/\./g,"")};function E(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=E(e[n],t[n]));return e}class S{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function k(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function A(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(k())}function N(){try{return"[object process]"===Object.prototype.toString.call(i.g.process)}catch(e){return!1}}function C(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function D(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function R(){const e=k();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function x(){return"object"==typeof indexedDB}class P extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,P.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,O.prototype.create)}}class O{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(L,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new P(r,o,n)}}const L=/\{\$([^}]+)}/g;function M(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function F(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(V(n)&&V(s)){if(!F(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function V(e){return null!==e&&"object"==typeof e}function U(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function q(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function B(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function j(e,t){const n=new K(e,t);return n.subscribe.bind(n)}class K{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=$),void 0===r.error&&(r.error=$),void 0===r.complete&&(r.complete=$);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function $(){}function G(e){return e&&e._delegate?e._delegate:e}class z{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const W="[DEFAULT]";class H{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new S;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:W})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e="[DEFAULT]"){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e="[DEFAULT]"){return this.instances.has(e)}getOptions(e="[DEFAULT]"){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===W?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e="[DEFAULT]"){return this.component?this.component.multipleInstances?e:W:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Q{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new H(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Y=[];var J;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(J||(J={}));const X={debug:J.DEBUG,verbose:J.VERBOSE,info:J.INFO,warn:J.WARN,error:J.ERROR,silent:J.SILENT},Z=J.INFO,ee={[J.DEBUG]:"log",[J.VERBOSE]:"log",[J.INFO]:"info",[J.WARN]:"warn",[J.ERROR]:"error"},te=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=ee[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class ne{constructor(e){this.name=e,this._logLevel=Z,this._logHandler=te,this._userLogHandler=null,Y.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in J))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?X[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,J.DEBUG,...e),this._logHandler(this,J.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,J.VERBOSE,...e),this._logHandler(this,J.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,J.INFO,...e),this._logHandler(this,J.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,J.WARN,...e),this._logHandler(this,J.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,J.ERROR,...e),this._logHandler(this,J.ERROR,...e)}}let re,ie;const se=new WeakMap,oe=new WeakMap,ae=new WeakMap,ce=new WeakMap,ue=new WeakMap;let le={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return oe.get(e);if("objectStoreNames"===t)return e.objectStoreNames||ae.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return de(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function he(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(ie||(ie=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(fe(this),e),de(se.get(this))}:function(...e){return de(t.apply(fe(this),e))}:function(e,...n){const r=t.call(fe(this),e,...n);return ae.set(r,e.sort?e.sort():[e]),de(r)}:(e instanceof IDBTransaction&&function(e){if(oe.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));oe.set(e,t)}(e),n=e,(re||(re=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,le):e);var t,n}function de(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(de(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&se.set(t,e)})).catch((()=>{})),ue.set(t,e),t}(e);if(ce.has(e))return ce.get(e);const t=he(e);return t!==e&&(ce.set(e,t),ue.set(t,e)),t}const fe=e=>ue.get(e),pe=["get","getKey","getAll","getAllKeys","count"],me=["put","add","delete","clear"],ge=new Map;function ye(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(ge.get(t))return ge.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=me.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!pe.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return ge.set(t,s),s}var ve;ve=le,le={...ve,get:(e,t,n)=>ye(e,t)||ve.get(e,t,n),has:(e,t)=>!!ye(e,t)||ve.has(e,t)};class we{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const be="@firebase/app",Ie="0.7.24",_e=new ne("@firebase/app"),Te="[DEFAULT]",Ee={[be]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},Se=new Map,ke=new Map;function Ae(e,t){try{e.container.addComponent(t)}catch(n){_e.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function Ne(e,t){e.container.addOrOverwriteComponent(t)}function Ce(e){const t=e.name;if(ke.has(t))return _e.debug(`There were multiple attempts to register component ${t}.`),!1;ke.set(t,e);for(const t of Se.values())Ae(t,e);return!0}function De(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function Re(e,t,n=Te){De(e,t).clearInstance(n)}function xe(){ke.clear()}const Pe=new O("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}."});class Oe{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new z("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Pe.create("app-deleted",{appName:this._name})}}const Le="9.8.1";function Me(e,t={}){"object"!=typeof t&&(t={name:t});const n=Object.assign({name:Te,automaticDataCollectionEnabled:!1},t),r=n.name;if("string"!=typeof r||!r)throw Pe.create("bad-app-name",{appName:String(r)});const i=Se.get(r);if(i){if(F(e,i.options)&&F(n,i.config))return i;throw Pe.create("duplicate-app",{appName:r})}const s=new Q(r);for(const e of ke.values())s.addComponent(e);const o=new Oe(e,n,s);return Se.set(r,o),o}function Fe(e=Te){const t=Se.get(e);if(!t)throw Pe.create("no-app",{appName:e});return t}function Ve(){return Array.from(Se.values())}async function Ue(e){const t=e.name;Se.has(t)&&(Se.delete(t),await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}function qe(e,t,n){var r;let i=null!==(r=Ee[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void _e.warn(e.join(" "))}Ce(new z(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}function Be(e,t){if(null!==e&&"function"!=typeof e)throw Pe.create("invalid-log-argument");!function(e,t){for(const n of Y){let r=null;t&&t.level&&(r=X[t.level]),n.userLogHandler=null===e?null:(t,n,...i)=>{const s=i.map((e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}})).filter((e=>e)).join(" ");n>=(null!=r?r:t.logLevel)&&e({level:J[n].toLowerCase(),message:s,args:i,type:t.name})}}}(e,t)}function je(e){var t;t=e,Y.forEach((e=>{e.setLogLevel(t)}))}const Ke="firebase-heartbeat-store";let $e=null;function Ge(){return $e||($e=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=de(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(de(o.result),e.oldVersion,e.newVersion,de(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(()=>i()))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Ke)}}).catch((e=>{throw Pe.create("storage-open",{originalErrorMessage:e.message})}))),$e}async function ze(e,t){try{const n=(await Ge()).transaction(Ke,"readwrite"),r=n.objectStore(Ke);return await r.put(t,We(e)),n.done}catch(e){throw Pe.create("storage-set",{originalErrorMessage:e.message})}}function We(e){return`${e.name}!${e.options.appId}`}class He{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Ye(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=Qe();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=Qe(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),Je(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Je(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=T(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}}function Qe(){return(new Date).toISOString().substring(0,10)}class Ye{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!x()&&new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})).then((()=>!0)).catch((()=>!1))}async read(){return await this._canUseIndexedDBPromise&&await async function(e){try{return(await Ge()).transaction(Ke).objectStore(Ke).get(We(e))}catch(e){throw Pe.create("storage-get",{originalErrorMessage:e.message})}}(this.app)||{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return ze(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return ze(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Je(e){return T(JSON.stringify({version:2,heartbeats:e})).length}Ce(new z("platform-logger",(e=>new we(e)),"PRIVATE")),Ce(new z("heartbeat",(e=>new He(e)),"PRIVATE")),qe(be,Ie,""),qe(be,Ie,"esm2017"),qe("fire-js","");var Xe,Ze="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self?self:{},et={},tt=tt||{},nt=Ze||self;function rt(){}function it(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function st(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var ot="closure_uid_"+(1e9*Math.random()>>>0),at=0;function ct(e,t,n){return e.call.apply(e.bind,arguments)}function ut(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function lt(e,t,n){return(lt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ct:ut).apply(null,arguments)}function ht(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function dt(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}function ft(){this.s=this.s,this.o=this.o}var pt={};ft.prototype.s=!1,ft.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,ot)&&e[ot]||(e[ot]=++at)}(this);delete pt[e]}},ft.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const mt=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},gt=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){const r=e.length,i="string"==typeof e?e.split(""):e;for(let s=0;s<r;s++)s in i&&t.call(n,i[s],s,e)};function yt(e){return Array.prototype.concat.apply([],arguments)}function vt(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function wt(e){return/^[\s\xa0]*$/.test(e)}var bt,It=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function _t(e,t){return-1!=e.indexOf(t)}function Tt(e,t){return e<t?-1:e>t?1:0}e:{var Et=nt.navigator;if(Et){var St=Et.userAgent;if(St){bt=St;break e}}bt=""}function kt(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function At(e){const t={};for(const n in e)t[n]=e[n];return t}var Nt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ct(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<Nt.length;t++)n=Nt[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Dt(e){return Dt[" "](e),e}Dt[" "]=rt;var Rt,xt,Pt=_t(bt,"Opera"),Ot=_t(bt,"Trident")||_t(bt,"MSIE"),Lt=_t(bt,"Edge"),Mt=Lt||Ot,Ft=_t(bt,"Gecko")&&!(_t(bt.toLowerCase(),"webkit")&&!_t(bt,"Edge"))&&!(_t(bt,"Trident")||_t(bt,"MSIE"))&&!_t(bt,"Edge"),Vt=_t(bt.toLowerCase(),"webkit")&&!_t(bt,"Edge");function Ut(){var e=nt.document;return e?e.documentMode:void 0}e:{var qt="",Bt=(xt=bt,Ft?/rv:([^\);]+)(\)|;)/.exec(xt):Lt?/Edge\/([\d\.]+)/.exec(xt):Ot?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(xt):Vt?/WebKit\/(\S+)/.exec(xt):Pt?/(?:Version)[ \/]?(\S+)/.exec(xt):void 0);if(Bt&&(qt=Bt?Bt[1]:""),Ot){var jt=Ut();if(null!=jt&&jt>parseFloat(qt)){Rt=String(jt);break e}}Rt=qt}var Kt,$t={};function Gt(){return e=$t,Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=function(){let e=0;const t=It(String(Rt)).split("."),n=It("9").split("."),r=Math.max(t.length,n.length);for(let o=0;0==e&&o<r;o++){var i=t[o]||"",s=n[o]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;e=Tt(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||Tt(0==i[2].length,0==s[2].length)||Tt(i[2],s[2]),i=i[3],s=s[3]}while(0==e)}return 0<=e}();var e}nt.document&&Ot?Kt=Ut()||parseInt(Rt,10)||void 0:Kt=void 0;var zt=Kt,Wt=function(){if(!nt.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{nt.addEventListener("test",rt,t),nt.removeEventListener("test",rt,t)}catch(e){}return e}();function Ht(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}function Qt(e,t){if(Ht.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(Ft){e:{try{Dt(t.nodeName);var i=!0;break e}catch(e){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:Yt[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&Qt.Z.h.call(this)}}Ht.prototype.h=function(){this.defaultPrevented=!0},dt(Qt,Ht);var Yt={2:"touch",3:"pen",4:"mouse"};Qt.prototype.h=function(){Qt.Z.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var Jt="closure_listenable_"+(1e6*Math.random()|0),Xt=0;function Zt(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ia=i,this.key=++Xt,this.ca=this.fa=!1}function en(e){e.ca=!0,e.listener=null,e.proxy=null,e.src=null,e.ia=null}function tn(e){this.src=e,this.g={},this.h=0}function nn(e,t){var n=t.type;if(n in e.g){var r,i=e.g[n],s=mt(i,t);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(en(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function rn(e,t,n,r){for(var i=0;i<e.length;++i){var s=e[i];if(!s.ca&&s.listener==t&&s.capture==!!n&&s.ia==r)return i}return-1}tn.prototype.add=function(e,t,n,r,i){var s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);var o=rn(e,t,r,i);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new Zt(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var sn="closure_lm_"+(1e6*Math.random()|0),on={};function an(e,t,n,r,i){if(r&&r.once)return un(e,t,n,r,i);if(Array.isArray(t)){for(var s=0;s<t.length;s++)an(e,t[s],n,r,i);return null}return n=gn(n),e&&e[Jt]?e.N(t,n,st(r)?!!r.capture:!!r,i):cn(e,t,n,!1,r,i)}function cn(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");var o=st(i)?!!i.capture:!!i,a=pn(e);if(a||(e[sn]=a=new tn(e)),(n=a.add(t,n,r,o,s)).proxy)return n;if(r=function(){var e=fn;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)Wt||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(dn(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function un(e,t,n,r,i){if(Array.isArray(t)){for(var s=0;s<t.length;s++)un(e,t[s],n,r,i);return null}return n=gn(n),e&&e[Jt]?e.O(t,n,st(r)?!!r.capture:!!r,i):cn(e,t,n,!0,r,i)}function ln(e,t,n,r,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)ln(e,t[s],n,r,i);else r=st(r)?!!r.capture:!!r,n=gn(n),e&&e[Jt]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=rn(s=e.g[t],n,r,i))&&(en(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete e.g[t],e.h--))):e&&(e=pn(e))&&(t=e.g[t.toString()],e=-1,t&&(e=rn(t,n,r,i)),(n=-1<e?t[e]:null)&&hn(n))}function hn(e){if("number"!=typeof e&&e&&!e.ca){var t=e.src;if(t&&t[Jt])nn(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(dn(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=pn(t))?(nn(n,e),0==n.h&&(n.src=null,t[sn]=null)):en(e)}}}function dn(e){return e in on?on[e]:on[e]="on"+e}function fn(e,t){if(e.ca)e=!0;else{t=new Qt(t,this);var n=e.listener,r=e.ia||e.src;e.fa&&hn(e),e=n.call(r,t)}return e}function pn(e){return(e=e[sn])instanceof tn?e:null}var mn="__closure_events_fn_"+(1e9*Math.random()>>>0);function gn(e){return"function"==typeof e?e:(e[mn]||(e[mn]=function(t){return e.handleEvent(t)}),e[mn])}function yn(){ft.call(this),this.i=new tn(this),this.P=this,this.I=null}function vn(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"==typeof t)t=new Ht(t,e);else if(t instanceof Ht)t.target=t.target||e;else{var i=t;Ct(t=new Ht(r,e),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=t.g=n[s];i=wn(o,r,!0,t)&&i}if(i=wn(o=t.g=e,r,!0,t)&&i,i=wn(o,r,!1,t)&&i,n)for(s=0;s<n.length;s++)i=wn(o=t.g=n[s],r,!1,t)&&i}function wn(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var i=!0,s=0;s<t.length;++s){var o=t[s];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&nn(e.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}dt(yn,ft),yn.prototype[Jt]=!0,yn.prototype.removeEventListener=function(e,t,n,r){ln(this,e,t,n,r)},yn.prototype.M=function(){if(yn.Z.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)en(n[r]);delete t.g[e],t.h--}}this.I=null},yn.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},yn.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var bn=nt.JSON.stringify;function In(){var e=Nn;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var _n,Tn=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new En),(e=>e.reset()));class En{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Sn(e){nt.setTimeout((()=>{throw e}),0)}function kn(e,t){_n||function(){var e=nt.Promise.resolve(void 0);_n=function(){e.then(Cn)}}(),An||(_n(),An=!0),Nn.add(e,t)}var An=!1,Nn=new class{constructor(){this.h=this.g=null}add(e,t){const n=Tn.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}};function Cn(){for(var e;e=In();){try{e.h.call(e.g)}catch(e){Sn(e)}var t=Tn;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}An=!1}function Dn(e,t){yn.call(this),this.h=e||1,this.g=t||nt,this.j=lt(this.kb,this),this.l=Date.now()}function Rn(e){e.da=!1,e.S&&(e.g.clearTimeout(e.S),e.S=null)}function xn(e,t,n){if("function"==typeof e)n&&(e=lt(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=lt(e.handleEvent,e)}return 2147483647<Number(t)?-1:nt.setTimeout(e,t||0)}function Pn(e){e.g=xn((()=>{e.g=null,e.i&&(e.i=!1,Pn(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}dt(Dn,yn),(Xe=Dn.prototype).da=!1,Xe.S=null,Xe.kb=function(){if(this.da){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-e):(this.S&&(this.g.clearTimeout(this.S),this.S=null),vn(this,"tick"),this.da&&(Rn(this),this.start()))}},Xe.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Xe.M=function(){Dn.Z.M.call(this),Rn(this),delete this.g};class On extends ft{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Pn(this)}M(){super.M(),this.g&&(nt.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ln(e){ft.call(this),this.h=e,this.g={}}dt(Ln,ft);var Mn=[];function Fn(e,t,n,r){Array.isArray(n)||(n&&(Mn[0]=n.toString()),n=Mn);for(var i=0;i<n.length;i++){var s=an(t,n[i],r||e.handleEvent,!1,e.h||e);if(!s)break;e.g[s.key]=s}}function Vn(e){kt(e.g,(function(e,t){this.g.hasOwnProperty(t)&&hn(e)}),e),e.g={}}function Un(){this.g=!0}function qn(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return bn(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}Ln.prototype.M=function(){Ln.Z.M.call(this),Vn(this)},Ln.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Un.prototype.Aa=function(){this.g=!1},Un.prototype.info=function(){};var Bn={},jn=null;function Kn(){return jn=jn||new yn}function $n(e){Ht.call(this,Bn.Ma,e)}function Gn(e){const t=Kn();vn(t,new $n(t,e))}function zn(e,t){Ht.call(this,Bn.STAT_EVENT,e),this.stat=t}function Wn(e){const t=Kn();vn(t,new zn(t,e))}function Hn(e,t){Ht.call(this,Bn.Na,e),this.size=t}function Qn(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return nt.setTimeout((function(){e()}),t)}Bn.Ma="serverreachability",dt($n,Ht),Bn.STAT_EVENT="statevent",dt(zn,Ht),Bn.Na="timingevent",dt(Hn,Ht);var Yn={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Jn={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Xn(){}function Zn(e){return e.h||(e.h=e.i())}function er(){}Xn.prototype.h=null;var tr,nr={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function rr(){Ht.call(this,"d")}function ir(){Ht.call(this,"c")}function sr(){}function or(e,t,n,r){this.l=e,this.j=t,this.m=n,this.X=r||1,this.V=new Ln(this),this.P=cr,e=Mt?125:void 0,this.W=new Dn(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new ar}function ar(){this.i=null,this.g="",this.h=!1}dt(rr,Ht),dt(ir,Ht),dt(sr,Xn),sr.prototype.g=function(){return new XMLHttpRequest},sr.prototype.i=function(){return{}},tr=new sr;var cr=45e3,ur={},lr={};function hr(e,t,n){e.K=1,e.v=Or(Nr(t)),e.s=n,e.U=!0,dr(e,null)}function dr(e,t){e.F=Date.now(),gr(e),e.A=Nr(e.v);var n=e.A,r=e.X;Array.isArray(r)||(r=[String(r)]),Wr(n.h,"t",r),e.C=0,n=e.l.H,e.h=new ar,e.g=Wi(e.l,n?t:null,!e.s),0<e.O&&(e.L=new On(lt(e.Ia,e,e.g),e.O)),Fn(e.V,e.g,"readystatechange",e.gb),t=e.H?At(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.s,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),Gn(1),function(e,t,n,r,i,s){e.info((function(){if(e.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+u+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.X,e.s)}function fr(e){return!!e.g&&"GET"==e.u&&2!=e.K&&e.l.Ba}function pr(e,t,n){let r,i=!0;for(;!e.I&&e.C<n.length;){if(r=mr(e,n),r==lr){4==t&&(e.o=4,Wn(14),i=!1),qn(e.j,e.m,null,"[Incomplete Response]");break}if(r==ur){e.o=4,Wn(15),qn(e.j,e.m,n,"[Invalid Chunk]"),i=!1;break}qn(e.j,e.m,r,null),Ir(e,r)}fr(e)&&r!=lr&&r!=ur&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,Wn(16),i=!1),e.i=e.i&&i,i?0<n.length&&!e.aa&&(e.aa=!0,(t=e.l).g==e&&t.$&&!t.L&&(t.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Ui(t),t.L=!0,Wn(11))):(qn(e.j,e.m,n,"[Invalid Chunked Response]"),br(e),wr(e))}function mr(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?lr:(n=Number(t.substring(n,r)),isNaN(n)?ur:(r+=1)+n>t.length?lr:(t=t.substr(r,n),e.C=r+n,t))}function gr(e){e.Y=Date.now()+e.P,yr(e,e.P)}function yr(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Qn(lt(e.eb,e),t)}function vr(e){e.B&&(nt.clearTimeout(e.B),e.B=null)}function wr(e){0==e.l.G||e.I||ji(e.l,e)}function br(e){vr(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Rn(e.W),Vn(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Ir(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||Zr(n.i,e)))if(n.I=e.N,!e.J&&Zr(n.i,e)&&3==n.G){try{var r=n.Ca.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;Bi(n),Di(n)}Vi(n),Wn(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=Qn(lt(n.ab,n),6e3));if(1>=Xr(n.i)&&n.ka){try{n.ka()}catch(e){}n.ka=void 0}}else $i(n,11)}else if((e.J||n.g==e)&&Bi(n),!wt(t))for(i=n.Ca.g.parse(t),t=0;t<i.length;t++){let u=i[t];if(n.U=u[0],u=u[1],2==n.G)if("c"==u[0]){n.J=u[1],n.la=u[2];const t=u[3];null!=t&&(n.ma=t,n.h.info("VER="+n.ma));const i=u[4];null!=i&&(n.za=i,n.h.info("SVER="+n.za));const l=u[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.K=r,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=e.g;if(h){const e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.i;!s.g&&(_t(e,"spdy")||_t(e,"quic")||_t(e,"h2"))&&(s.j=s.l,s.g=new Set,s.h&&(ei(s,s.h),s.h=null))}if(r.D){const e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.sa=e,Pr(r.F,r.D,e))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-e.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=e;if((r=n).oa=zi(r,r.H?r.la:null,r.W),o.J){ti(r.i,o);var a=o,c=r.K;c&&a.setTimeout(c),a.B&&(vr(a),gr(a)),r.g=o}else Fi(r);0<n.l.length&&Pi(n)}else"stop"!=u[0]&&"close"!=u[0]||$i(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?$i(n,7):Ci(n):"noop"!=u[0]&&n.j&&n.j.wa(u),n.A=0)}Gn(4)}catch(e){}}function _r(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(it(e)||"string"==typeof e)gt(e,t,void 0);else{if(e.T&&"function"==typeof e.T)var n=e.T();else if(e.R&&"function"==typeof e.R)n=void 0;else if(it(e)||"string"==typeof e){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;r=function(e){if(e.R&&"function"==typeof e.R)return e.R();if("string"==typeof e)return e.split("");if(it(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),i=r.length;for(var s=0;s<i;s++)t.call(void 0,r[s],n&&n[s],e)}}function Tr(e,t){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof Tr)for(n=e.T(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function Er(e){if(e.i!=e.g.length){for(var t=0,n=0;t<e.g.length;){var r=e.g[t];Sr(e.h,r)&&(e.g[n++]=r),t++}e.g.length=n}if(e.i!=e.g.length){var i={};for(n=t=0;t<e.g.length;)Sr(i,r=e.g[t])||(e.g[n++]=r,i[r]=1),t++;e.g.length=n}}function Sr(e,t){return Object.prototype.hasOwnProperty.call(e,t)}(Xe=or.prototype).setTimeout=function(e){this.P=e},Xe.gb=function(e){e=e.target;const t=this.L;t&&3==Ei(e)?t.l():this.Ia(e)},Xe.Ia=function(e){try{if(e==this.g)e:{const l=Ei(this.g);var t=this.g.Da();const h=this.g.ba();if(!(3>l)&&(3!=l||Mt||this.g&&(this.h.h||this.g.ga()||Si(this.g)))){this.I||4!=l||7==t||Gn(8==t||0>=h?3:2),vr(this);var n=this.g.ba();this.N=n;t:if(fr(this)){var r=Si(this.g);e="";var i=r.length,s=4==Ei(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){br(this),wr(this);var o="";break t}this.h.i=new nt.TextDecoder}for(t=0;t<i;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:s&&t==i-1});r.splice(0,i),this.h.g+=e,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(e,t,n,r,i,s,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.X,l,n),this.i){if(this.$&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!wt(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.o=3,Wn(12),br(this),wr(this);break e}qn(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Ir(this,n)}this.U?(pr(this,l,o),Mt&&this.i&&3==l&&(Fn(this.V,this.W,"tick",this.fb),this.W.start())):(qn(this.j,this.m,o,null),Ir(this,o)),4==l&&br(this),this.i&&!this.I&&(4==l?ji(this.l,this):(this.i=!1,gr(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,Wn(12)):(this.o=0,Wn(13)),br(this),wr(this)}}}catch(e){}},Xe.fb=function(){if(this.g){var e=Ei(this.g),t=this.g.ga();this.C<t.length&&(vr(this),pr(this,e,t),this.i&&4!=e&&gr(this))}},Xe.cancel=function(){this.I=!0,br(this)},Xe.eb=function(){this.B=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.K&&(Gn(3),Wn(17)),br(this),this.o=2,wr(this)):yr(this,this.Y-e)},(Xe=Tr.prototype).R=function(){Er(this);for(var e=[],t=0;t<this.g.length;t++)e.push(this.h[this.g[t]]);return e},Xe.T=function(){return Er(this),this.g.concat()},Xe.get=function(e,t){return Sr(this.h,e)?this.h[e]:t},Xe.set=function(e,t){Sr(this.h,e)||(this.i++,this.g.push(e)),this.h[e]=t},Xe.forEach=function(e,t){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],s=this.get(i);e.call(t,s,i,this)}};var kr=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ar(e,t){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,e instanceof Ar){this.g=void 0!==t?t:e.g,Cr(this,e.j),this.s=e.s,Dr(this,e.i),Rr(this,e.m),this.l=e.l,t=e.h;var n=new Kr;n.i=t.i,t.g&&(n.g=new Tr(t.g),n.h=t.h),xr(this,n),this.o=e.o}else e&&(n=String(e).match(kr))?(this.g=!!t,Cr(this,n[1]||"",!0),this.s=Lr(n[2]||""),Dr(this,n[3]||"",!0),Rr(this,n[4]),this.l=Lr(n[5]||"",!0),xr(this,n[6]||"",!0),this.o=Lr(n[7]||"")):(this.g=!!t,this.h=new Kr(null,this.g))}function Nr(e){return new Ar(e)}function Cr(e,t,n){e.j=n?Lr(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Dr(e,t,n){e.i=n?Lr(t,!0):t}function Rr(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function xr(e,t,n){t instanceof Kr?(e.h=t,function(e,t){t&&!e.j&&($r(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Gr(this,t),Wr(this,n,e))}),e)),e.j=t}(e.h,e.g)):(n||(t=Mr(t,Br)),e.h=new Kr(t,e.g))}function Pr(e,t,n){e.h.set(t,n)}function Or(e){return Pr(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Lr(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Mr(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,Fr),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Fr(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Ar.prototype.toString=function(){var e=[],t=this.j;t&&e.push(Mr(t,Vr,!0),":");var n=this.i;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(Mr(t,Vr,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&e.push("/"),e.push(Mr(n,"/"==n.charAt(0)?qr:Ur,!0))),(n=this.h.toString())&&e.push("?",n),(n=this.o)&&e.push("#",Mr(n,jr)),e.join("")};var Vr=/[#\/\?@]/g,Ur=/[#\?:]/g,qr=/[#\?]/g,Br=/[#\?@]/g,jr=/#/g;function Kr(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function $r(e){e.g||(e.g=new Tr,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var s=e[n].substring(0,r);i=e[n].substring(r+1)}else s=e[n];t(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Gr(e,t){$r(e),t=Hr(e,t),Sr(e.g.h,t)&&(e.i=null,e.h-=e.g.get(t).length,Sr((e=e.g).h,t)&&(delete e.h[t],e.i--,e.g.length>2*e.i&&Er(e)))}function zr(e,t){return $r(e),t=Hr(e,t),Sr(e.g.h,t)}function Wr(e,t,n){Gr(e,t),0<n.length&&(e.i=null,e.g.set(Hr(e,t),vt(n)),e.h+=n.length)}function Hr(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Qr(e){this.l=e||Yr,e=nt.PerformanceNavigationTiming?0<(e=nt.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(nt.g&&nt.g.Ea&&nt.g.Ea()&&nt.g.Ea().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(Xe=Kr.prototype).add=function(e,t){$r(this),this.i=null,e=Hr(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},Xe.forEach=function(e,t){$r(this),this.g.forEach((function(n,r){gt(n,(function(n){e.call(t,n,r,this)}),this)}),this)},Xe.T=function(){$r(this);for(var e=this.g.R(),t=this.g.T(),n=[],r=0;r<t.length;r++)for(var i=e[r],s=0;s<i.length;s++)n.push(t[r]);return n},Xe.R=function(e){$r(this);var t=[];if("string"==typeof e)zr(this,e)&&(t=yt(t,this.g.get(Hr(this,e))));else{e=this.g.R();for(var n=0;n<e.length;n++)t=yt(t,e[n])}return t},Xe.set=function(e,t){return $r(this),this.i=null,zr(this,e=Hr(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},Xe.get=function(e,t){return e&&0<(e=this.R(e)).length?String(e[0]):t},Xe.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=this.g.T(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.R(r);for(var s=0;s<r.length;s++){var o=i;""!==r[s]&&(o+="="+encodeURIComponent(String(r[s]))),e.push(o)}}return this.i=e.join("&")};var Yr=10;function Jr(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Xr(e){return e.h?1:e.g?e.g.size:0}function Zr(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function ei(e,t){e.g?e.g.add(t):e.h=t}function ti(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function ni(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return vt(e.i)}function ri(){}function ii(){this.g=new ri}function si(e,t,n){const r=n||"";try{_r(e,(function(e,n){let i=e;st(e)&&(i=bn(e)),t.push(r+n+"="+encodeURIComponent(i))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function oi(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch(e){}}function ai(e){this.l=e.$b||null,this.j=e.ib||!1}function ci(e,t){yn.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=ui,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Qr.prototype.cancel=function(){if(this.i=ni(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}},ri.prototype.stringify=function(e){return nt.JSON.stringify(e,void 0)},ri.prototype.parse=function(e){return nt.JSON.parse(e,void 0)},dt(ai,Xn),ai.prototype.g=function(){return new ci(this.l,this.j)},ai.prototype.i=function(e){return function(){return e}}({}),dt(ci,yn);var ui=0;function li(e){e.j.read().then(e.Sa.bind(e)).catch(e.ha.bind(e))}function hi(e){e.readyState=4,e.l=null,e.j=null,e.A=null,di(e)}function di(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(Xe=ci.prototype).open=function(e,t){if(this.readyState!=ui)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,di(this)},Xe.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||nt).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ha.bind(this))},Xe.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,hi(this)),this.readyState=ui},Xe.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,di(this)),this.g&&(this.readyState=3,di(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==nt.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;li(this)}else e.text().then(this.Ua.bind(this),this.ha.bind(this))},Xe.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?hi(this):di(this),3==this.readyState&&li(this)}},Xe.Ua=function(e){this.g&&(this.response=this.responseText=e,hi(this))},Xe.Ta=function(e){this.g&&(this.response=e,hi(this))},Xe.ha=function(){this.g&&hi(this)},Xe.setRequestHeader=function(e,t){this.v.append(e,t)},Xe.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},Xe.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(ci.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var fi=nt.JSON.parse;function pi(e){yn.call(this),this.headers=new Tr,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=mi,this.K=this.L=!1}dt(pi,yn);var mi="",gi=/^https?$/i,yi=["POST","PUT"];function vi(e){return"content-type"==e.toLowerCase()}function wi(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,bi(e),_i(e)}function bi(e){e.D||(e.D=!0,vn(e,"complete"),vn(e,"error"))}function Ii(e){if(e.h&&void 0!==tt&&(!e.C[1]||4!=Ei(e)||2!=e.ba()))if(e.v&&4==Ei(e))xn(e.Fa,0,e);else if(vn(e,"readystatechange"),4==Ei(e)){e.h=!1;try{const a=e.ba();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===a){var i=String(e.H).match(kr)[1]||null;if(!i&&nt.self&&nt.self.location){var s=nt.self.location.protocol;i=s.substr(0,s.length-1)}r=!gi.test(i?i.toLowerCase():"")}n=r}if(n)vn(e,"complete"),vn(e,"success");else{e.m=6;try{var o=2<Ei(e)?e.g.statusText:""}catch(e){o=""}e.j=o+" ["+e.ba()+"]",bi(e)}}finally{_i(e)}}}function _i(e,t){if(e.g){Ti(e);const n=e.g,r=e.C[0]?rt:null;e.g=null,e.C=null,t||vn(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function Ti(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(nt.clearTimeout(e.A),e.A=null)}function Ei(e){return e.g?e.g.readyState:0}function Si(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case mi:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function ki(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=function(e){let t="";return kt(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Pr(e,t,n))}function Ai(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Ni(e){this.za=0,this.l=[],this.h=new Un,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Ai("failFast",!1,e),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Ai("baseRetryDelayMs",5e3,e),this.$a=Ai("retryDelaySeedMs",1e4,e),this.Ya=Ai("forwardChannelMaxRetries",2,e),this.ra=Ai("forwardChannelRequestTimeoutMs",2e4,e),this.qa=e&&e.xmlHttpFactory||void 0,this.Ba=e&&e.Yb||!1,this.K=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.J="",this.i=new Qr(e&&e.concurrentRequestLimit),this.Ca=new ii,this.ja=e&&e.fastHandshake||!1,this.Ra=e&&e.Wb||!1,e&&e.Aa&&this.h.Aa(),e&&e.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&e&&e.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!e||!1!==e.Xb}function Ci(e){if(Ri(e),3==e.G){var t=e.V++,n=Nr(e.F);Pr(n,"SID",e.J),Pr(n,"RID",t),Pr(n,"TYPE","terminate"),Li(e,n),(t=new or(e,e.h,t,void 0)).K=2,t.v=Or(Nr(n)),n=!1,nt.navigator&&nt.navigator.sendBeacon&&(n=nt.navigator.sendBeacon(t.v.toString(),"")),!n&&nt.Image&&((new Image).src=t.v,n=!0),n||(t.g=Wi(t.l,null),t.g.ea(t.v)),t.F=Date.now(),gr(t)}Gi(e)}function Di(e){e.g&&(Ui(e),e.g.cancel(),e.g=null)}function Ri(e){Di(e),e.u&&(nt.clearTimeout(e.u),e.u=null),Bi(e),e.i.cancel(),e.m&&("number"==typeof e.m&&nt.clearTimeout(e.m),e.m=null)}function xi(e,t){e.l.push(new class{constructor(e,t){this.h=e,this.g=t}}(e.Za++,t)),3==e.G&&Pi(e)}function Pi(e){Jr(e.i)||e.m||(e.m=!0,kn(e.Ha,e),e.C=0)}function Oi(e,t){var n;n=t?t.m:e.V++;const r=Nr(e.F);Pr(r,"SID",e.J),Pr(r,"RID",n),Pr(r,"AID",e.U),Li(e,r),e.o&&e.s&&ki(r,e.o,e.s),n=new or(e,e.h,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.l=t.D.concat(e.l)),t=Mi(e,n,1e3),n.setTimeout(Math.round(.5*e.ra)+Math.round(.5*e.ra*Math.random())),ei(e.i,n),hr(n,r,t)}function Li(e,t){e.j&&_r({},(function(e,n){Pr(t,n,e)}))}function Mi(e,t,n){n=Math.min(e.l.length,n);var r=e.j?lt(e.j.Oa,e.j,e):null;e:{var i=e.l;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=i[0].h,e.push("ofs="+t)):t=0:e.push("ofs="+t);let s=!0;for(let o=0;o<n;o++){let n=i[o].h;const a=i[o].g;if(n-=t,0>n)t=Math.max(0,i[o].h-100),s=!1;else try{si(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(s){r=e.join("&");break e}}}return e=e.l.splice(0,n),t.D=e,r}function Fi(e){e.g||e.u||(e.Y=1,kn(e.Ga,e),e.A=0)}function Vi(e){return!(e.g||e.u||3<=e.A||(e.Y++,e.u=Qn(lt(e.Ga,e),Ki(e,e.A)),e.A++,0))}function Ui(e){null!=e.B&&(nt.clearTimeout(e.B),e.B=null)}function qi(e){e.g=new or(e,e.h,"rpc",e.Y),null===e.o&&(e.g.H=e.s),e.g.O=0;var t=Nr(e.oa);Pr(t,"RID","rpc"),Pr(t,"SID",e.J),Pr(t,"CI",e.N?"0":"1"),Pr(t,"AID",e.U),Li(e,t),Pr(t,"TYPE","xmlhttp"),e.o&&e.s&&ki(t,e.o,e.s),e.K&&e.g.setTimeout(e.K);var n=e.g;e=e.la,n.K=1,n.v=Or(Nr(t)),n.s=null,n.U=!0,dr(n,e)}function Bi(e){null!=e.v&&(nt.clearTimeout(e.v),e.v=null)}function ji(e,t){var n=null;if(e.g==t){Bi(e),Ui(e),e.g=null;var r=2}else{if(!Zr(e.i,t))return;n=t.D,ti(e.i,t),r=1}if(e.I=t.N,0!=e.G)if(t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var i=e.C;vn(r=Kn(),new Hn(r,n,t,i)),Pi(e)}else Fi(e);else if(3==(i=t.o)||0==i&&0<e.I||!(1==r&&function(e,t){return!(Xr(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.l=t.D.concat(e.l),0):1==e.G||2==e.G||e.C>=(e.Xa?0:e.Ya)||(e.m=Qn(lt(e.Ha,e,t),Ki(e,e.C)),e.C++,0)))}(e,t)||2==r&&Vi(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),i){case 1:$i(e,5);break;case 4:$i(e,10);break;case 3:$i(e,6);break;default:$i(e,2)}}function Ki(e,t){let n=e.Pa+Math.floor(Math.random()*e.$a);return e.j||(n*=2),n*t}function $i(e,t){if(e.h.info("Error code "+t),2==t){var n=null;e.j&&(n=null);var r=lt(e.jb,e);n||(n=new Ar("//www.google.com/images/cleardot.gif"),nt.location&&"http"==nt.location.protocol||Cr(n,"https"),Or(n)),function(e,t){const n=new Un;if(nt.Image){const r=new Image;r.onload=ht(oi,n,r,"TestLoadImage: loaded",!0,t),r.onerror=ht(oi,n,r,"TestLoadImage: error",!1,t),r.onabort=ht(oi,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=ht(oi,n,r,"TestLoadImage: timeout",!1,t),nt.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else Wn(2);e.G=0,e.j&&e.j.va(t),Gi(e),Ri(e)}function Gi(e){e.G=0,e.I=-1,e.j&&(0==ni(e.i).length&&0==e.l.length||(e.i.i.length=0,vt(e.l),e.l.length=0),e.j.ua())}function zi(e,t,n){let r=function(e){return e instanceof Ar?Nr(e):new Ar(e,void 0)}(n);if(""!=r.i)t&&Dr(r,t+"."+r.i),Rr(r,r.m);else{const e=nt.location;r=function(e,t,n,r){var i=new Ar(null,void 0);return e&&Cr(i,e),t&&Dr(i,t),n&&Rr(i,n),r&&(i.l=r),i}(e.protocol,t?t+"."+e.hostname:e.hostname,+e.port,n)}return e.aa&&kt(e.aa,(function(e,t){Pr(r,t,e)})),t=e.D,n=e.sa,t&&n&&Pr(r,t,n),Pr(r,"VER",e.ma),Li(e,r),r}function Wi(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Ba&&!e.qa?new pi(new ai({ib:!0})):new pi(e.qa)).L=e.H,t}function Hi(){}function Qi(){if(Ot&&!(10<=Number(zt)))throw Error("Environmental error: no available transport.")}function Yi(e,t){yn.call(this),this.g=new Ni(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.P=e,(e=t&&t.httpHeadersOverwriteParam)&&!wt(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!wt(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new Zi(this)}function Ji(e){rr.call(this);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function Xi(){ir.call(this),this.status=1}function Zi(e){this.g=e}(Xe=pi.prototype).ea=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():tr.g(),this.C=this.u?Zn(this.u):Zn(tr),this.g.onreadystatechange=lt(this.Fa,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(e){return void wi(this,e)}e=n||"";const i=new Tr(this.headers);r&&_r(r,(function(e,t){i.set(t,e)})),r=function(e){e:{var t=vi;const n=e.length,r="string"==typeof e?e.split(""):e;for(let i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return 0>t?null:"string"==typeof e?e.charAt(t):e[t]}(i.T()),n=nt.FormData&&e instanceof nt.FormData,!(0<=mt(yi,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach((function(e,t){this.g.setRequestHeader(t,e)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Ti(this),0<this.B&&((this.K=function(e){return Ot&&Gt()&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=lt(this.pa,this)):this.A=xn(this.pa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){wi(this,e)}},Xe.pa=function(){void 0!==tt&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,vn(this,"timeout"),this.abort(8))},Xe.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,vn(this,"complete"),vn(this,"abort"),_i(this))},Xe.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),_i(this,!0)),pi.Z.M.call(this)},Xe.Fa=function(){this.s||(this.F||this.v||this.l?Ii(this):this.cb())},Xe.cb=function(){Ii(this)},Xe.ba=function(){try{return 2<Ei(this)?this.g.status:-1}catch(e){return-1}},Xe.ga=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},Xe.Qa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),fi(t)}},Xe.Da=function(){return this.m},Xe.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(Xe=Ni.prototype).ma=8,Xe.G=1,Xe.hb=function(e){try{this.h.info("Origin Trials invoked: "+e)}catch(e){}},Xe.Ha=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const i=new or(this,this.h,e,void 0);let s=this.s;if(this.P&&(s?(s=At(s),Ct(s,this.P)):s=this.P),null===this.o&&(i.H=s),this.ja)e:{for(var t=0,n=0;n<this.l.length;n++){var r=this.l[n];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.l.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=Mi(this,i,t),Pr(n=Nr(this.F),"RID",e),Pr(n,"CVER",22),this.D&&Pr(n,"X-HTTP-Session-Id",this.D),Li(this,n),this.o&&s&&ki(n,this.o,s),ei(this.i,i),this.Ra&&Pr(n,"TYPE","init"),this.ja?(Pr(n,"$req",t),Pr(n,"SID","null"),i.$=!0,hr(i,n,null)):hr(i,n,t),this.G=2}}else 3==this.G&&(e?Oi(this,e):0==this.l.length||Jr(this.i)||Oi(this))},Xe.Ga=function(){if(this.u=null,qi(this),this.$&&!(this.L||null==this.g||0>=this.O)){var e=2*this.O;this.h.info("BP detection timer enabled: "+e),this.B=Qn(lt(this.bb,this),e)}},Xe.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,Wn(10),Di(this),qi(this))},Xe.ab=function(){null!=this.v&&(this.v=null,Di(this),Vi(this),Wn(19))},Xe.jb=function(e){e?(this.h.info("Successfully pinged google.com"),Wn(2)):(this.h.info("Failed to ping google.com"),Wn(1))},(Xe=Hi.prototype).xa=function(){},Xe.wa=function(){},Xe.va=function(){},Xe.ua=function(){},Xe.Oa=function(){},Qi.prototype.g=function(e,t){return new Yi(e,t)},dt(Yi,yn),Yi.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;e.Wa&&(e.h.info("Origin Trials enabled."),kn(lt(e.hb,e,t))),Wn(0),e.W=t,e.aa=n||{},e.N=e.X,e.F=zi(e,null,e.W),Pi(e)},Yi.prototype.close=function(){Ci(this.g)},Yi.prototype.u=function(e){if("string"==typeof e){var t={};t.__data__=e,xi(this.g,t)}else this.v?((t={}).__data__=bn(e),xi(this.g,t)):xi(this.g,e)},Yi.prototype.M=function(){this.g.j=null,delete this.j,Ci(this.g),delete this.g,Yi.Z.M.call(this)},dt(Ji,rr),dt(Xi,ir),dt(Zi,Hi),Zi.prototype.xa=function(){vn(this.g,"a")},Zi.prototype.wa=function(e){vn(this.g,new Ji(e))},Zi.prototype.va=function(e){vn(this.g,new Xi(e))},Zi.prototype.ua=function(){vn(this.g,"b")},Qi.prototype.createWebChannel=Qi.prototype.g,Yi.prototype.send=Yi.prototype.u,Yi.prototype.open=Yi.prototype.m,Yi.prototype.close=Yi.prototype.close,Yn.NO_ERROR=0,Yn.TIMEOUT=8,Yn.HTTP_ERROR=6,Jn.COMPLETE="complete",er.EventType=nr,nr.OPEN="a",nr.CLOSE="b",nr.ERROR="c",nr.MESSAGE="d",yn.prototype.listen=yn.prototype.N,pi.prototype.listenOnce=pi.prototype.O,pi.prototype.getLastError=pi.prototype.La,pi.prototype.getLastErrorCode=pi.prototype.Da,pi.prototype.getStatus=pi.prototype.ba,pi.prototype.getResponseJson=pi.prototype.Qa,pi.prototype.getResponseText=pi.prototype.ga,pi.prototype.send=pi.prototype.ea;var es=et.createWebChannelTransport=function(){return new Qi},ts=et.getStatEventTarget=function(){return Kn()},ns=et.ErrorCode=Yn,rs=et.EventType=Jn,is=et.Event=Bn,ss=et.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},os=et.FetchXmlHttpFactory=ai,as=et.WebChannel=er,cs=et.XhrIo=pi;const us="@firebase/firestore";class ls{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}ls.UNAUTHENTICATED=new ls(null),ls.GOOGLE_CREDENTIALS=new ls("google-credentials-uid"),ls.FIRST_PARTY=new ls("first-party-uid"),ls.MOCK_USER=new ls("mock-user");let hs="9.8.0";const ds=new ne("@firebase/firestore");function fs(){return ds.logLevel}function ps(e,...t){if(ds.logLevel<=J.DEBUG){const n=t.map(ys);ds.debug(`Firestore (${hs}): ${e}`,...n)}}function ms(e,...t){if(ds.logLevel<=J.ERROR){const n=t.map(ys);ds.error(`Firestore (${hs}): ${e}`,...n)}}function gs(e,...t){if(ds.logLevel<=J.WARN){const n=t.map(ys);ds.warn(`Firestore (${hs}): ${e}`,...n)}}function ys(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function vs(e="Unexpected state"){const t=`FIRESTORE (${hs}) INTERNAL ASSERTION FAILED: `+e;throw ms(t),new Error(t)}function ws(e,t){e||vs()}function bs(e,t){return e}const Is={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class _s extends P{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ts{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class Es{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Ss{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(ls.UNAUTHENTICATED)))}shutdown(){}}class ks{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class As{constructor(e){this.t=e,this.currentUser=ls.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let i=new Ts;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Ts,e.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const t=i;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{ps("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(ps("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Ts)}}),0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(ps("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(ws("string"==typeof t.accessToken),new Es(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return ws(null===e||"string"==typeof e),new ls(e)}}class Ns{constructor(e,t,n){this.type="FirstParty",this.user=ls.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const r=e.auth.getAuthHeaderValueForFirstParty([]);r&&this.headers.set("Authorization",r),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class Cs{constructor(e,t,n){this.h=e,this.l=t,this.m=n}getToken(){return Promise.resolve(new Ns(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable((()=>t(ls.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Ds{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Rs{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(e,t){const n=e=>{null!=e.error&&ps("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.p;return this.p=e.token,ps("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{ps("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.g.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.g.getImmediate({optional:!0});e?r(e):ps("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(ws("string"==typeof e.token),this.p=e.token,new Ds(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class xs{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.I(e),this.T=e=>t.writeSequenceNumber(e))}I(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.T&&this.T(e),e}}function Ps(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}xs.A=-1;class Os{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let n="";for(;n.length<20;){const r=Ps(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length))}return n}}function Ls(e,t){return e<t?-1:e>t?1:0}function Ms(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}function Fs(e){return e+"\0"}class Vs{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new _s(Is.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new _s(Is.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new _s(Is.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new _s(Is.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Vs.fromMillis(Date.now())}static fromDate(e){return Vs.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new Vs(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?Ls(this.nanoseconds,e.nanoseconds):Ls(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Us{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Us(e)}static min(){return new Us(new Vs(0,0))}static max(){return new Us(new Vs(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function qs(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Bs(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function js(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Ks{constructor(e,t,n){void 0===t?t=0:t>e.length&&vs(),void 0===n?n=e.length-t:n>e.length-t&&vs(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===Ks.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ks?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),i=t.get(r);if(n<i)return-1;if(n>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class $s extends Ks{construct(e,t,n){return new $s(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new _s(Is.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new $s(t)}static emptyPath(){return new $s([])}}const Gs=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class zs extends Ks{construct(e,t,n){return new zs(e,t,n)}static isValidIdentifier(e){return Gs.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),zs.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new zs(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const i=()=>{if(0===n.length)throw new _s(Is.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let s=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new _s(Is.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new _s(Is.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(s=!s,r++):"."!==t||s?(n+=t,r++):(i(),r++)}if(i(),s)throw new _s(Is.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new zs(t)}static emptyPath(){return new zs([])}}class Ws{constructor(e){this.fields=e,e.sort(zs.comparator)}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ms(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Hs{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new Hs(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Hs(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ls(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Hs.EMPTY_BYTE_STRING=new Hs("");const Qs=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ys(e){if(ws(!!e),"string"==typeof e){let t=0;const n=Qs.exec(e);if(ws(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:Js(e.seconds),nanos:Js(e.nanos)}}function Js(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Xs(e){return"string"==typeof e?Hs.fromBase64String(e):Hs.fromUint8Array(e)}function Zs(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function eo(e){const t=e.mapValue.fields.__previous_value__;return Zs(t)?eo(t):t}function to(e){const t=Ys(e.mapValue.fields.__local_write_time__.timestampValue);return new Vs(t.seconds,t.nanos)}class no{constructor(e,t,n,r,i,s,o,a){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class ro{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ro("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof ro&&e.projectId===this.projectId&&e.database===this.database}}function io(e){return null==e}function so(e){return 0===e&&1/e==-1/0}function oo(e){return"number"==typeof e&&Number.isInteger(e)&&!so(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}class ao{constructor(e){this.path=e}static fromPath(e){return new ao($s.fromString(e))}static fromName(e){return new ao($s.fromString(e).popFirst(5))}static empty(){return new ao($s.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===$s.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return $s.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ao(new $s(e.slice()))}}const co={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},uo={nullValue:"NULL_VALUE"};function lo(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Zs(e)?4:So(e)?9007199254740991:10:vs()}function ho(e,t){if(e===t)return!0;const n=lo(e);if(n!==lo(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return to(e).isEqual(to(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=Ys(e.timestampValue),r=Ys(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Xs(e.bytesValue).isEqual(Xs(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Js(e.geoPointValue.latitude)===Js(t.geoPointValue.latitude)&&Js(e.geoPointValue.longitude)===Js(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Js(e.integerValue)===Js(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=Js(e.doubleValue),r=Js(t.doubleValue);return n===r?so(n)===so(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return Ms(e.arrayValue.values||[],t.arrayValue.values||[],ho);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(qs(n)!==qs(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!ho(n[e],r[e])))return!1;return!0}(e,t);default:return vs()}}function fo(e,t){return void 0!==(e.values||[]).find((e=>ho(e,t)))}function po(e,t){if(e===t)return 0;const n=lo(e),r=lo(t);if(n!==r)return Ls(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ls(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=Js(e.integerValue||e.doubleValue),r=Js(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return mo(e.timestampValue,t.timestampValue);case 4:return mo(to(e),to(t));case 5:return Ls(e.stringValue,t.stringValue);case 6:return function(e,t){const n=Xs(e),r=Xs(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=Ls(n[e],r[e]);if(0!==t)return t}return Ls(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Ls(Js(e.latitude),Js(t.latitude));return 0!==n?n:Ls(Js(e.longitude),Js(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=po(n[e],r[e]);if(t)return t}return Ls(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===co.mapValue&&t===co.mapValue)return 0;if(e===co.mapValue)return 1;if(t===co.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){const t=Ls(r[e],s[e]);if(0!==t)return t;const o=po(n[r[e]],i[s[e]]);if(0!==o)return o}return Ls(r.length,s.length)}(e.mapValue,t.mapValue);default:throw vs()}}function mo(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Ls(e,t);const n=Ys(e),r=Ys(t),i=Ls(n.seconds,r.seconds);return 0!==i?i:Ls(n.nanos,r.nanos)}function go(e){return yo(e)}function yo(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=Ys(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Xs(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,ao.fromName(n).toString()):"geoPointValue"in e?`geo(${(t=e.geoPointValue).latitude},${t.longitude})`:"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=yo(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const i of t)r?r=!1:n+=",",n+=`${i}:${yo(e.fields[i])}`;return n+"}"}(e.mapValue):vs();var t,n}function vo(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function wo(e){return!!e&&"integerValue"in e}function bo(e){return!!e&&"arrayValue"in e}function Io(e){return!!e&&"nullValue"in e}function _o(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function To(e){return!!e&&"mapValue"in e}function Eo(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Bs(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Eo(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Eo(e.arrayValue.values[n]);return t}return Object.assign({},e)}function So(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function ko(e){return"nullValue"in e?uo:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?vo(ro.empty(),ao.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:vs()}function Ao(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?vo(ro.empty(),ao.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?co:vs()}function No(e,t){const n=po(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Co(e,t){const n=po(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class Do{constructor(e){this.value=e}static empty(){return new Do({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!To(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Eo(t)}setAll(e){let t=zs.emptyPath(),n={},r=[];e.forEach(((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=Eo(e):r.push(i.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){const t=this.field(e.popLast());To(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return ho(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];To(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Bs(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new Do(Eo(this.value))}}function Ro(e){const t=[];return Bs(e.fields,((e,n)=>{const r=new zs([e]);if(To(n)){const e=Ro(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new Ws(t)}class xo{constructor(e,t,n,r,i,s){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.data=i,this.documentState=s}static newInvalidDocument(e){return new xo(e,0,Us.min(),Us.min(),Do.empty(),0)}static newFoundDocument(e,t,n){return new xo(e,1,t,Us.min(),n,0)}static newNoDocument(e,t){return new xo(e,2,t,Us.min(),Do.empty(),0)}static newUnknownDocument(e,t){return new xo(e,3,t,Us.min(),Do.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Do.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Do.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof xo&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new xo(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Po{constructor(e,t,n,r){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=r}}function Oo(e){return e.fields.find((e=>2===e.kind))}function Lo(e){return e.fields.filter((e=>2!==e.kind))}Po.UNKNOWN_ID=-1;class Mo{constructor(e,t){this.fieldPath=e,this.kind=t}}class Fo{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Fo(0,qo.min())}}function Vo(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,i=Us.fromTimestamp(1e9===r?new Vs(n+1,0):new Vs(n,r));return new qo(i,ao.empty(),t)}function Uo(e){return new qo(e.readTime,e.key,-1)}class qo{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new qo(Us.min(),ao.empty(),-1)}static max(){return new qo(Us.max(),ao.empty(),-1)}}function Bo(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=ao.comparator(e.documentKey,t.documentKey),0!==n?n:Ls(e.largestBatchId,t.largestBatchId))}class jo{constructor(e,t){this.comparator=e,this.root=t||$o.EMPTY}insert(e,t){return new jo(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,$o.BLACK,null,null))}remove(e){return new jo(this.comparator,this.root.remove(e,this.comparator).copy(null,null,$o.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ko(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ko(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ko(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ko(this.root,e,this.comparator,!0)}}class Ko{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class $o{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:$o.RED,this.left=null!=r?r:$o.EMPTY,this.right=null!=i?i:$o.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new $o(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return $o.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return $o.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,$o.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,$o.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw vs();if(this.right.isRed())throw vs();const e=this.left.check();if(e!==this.right.check())throw vs();return e+(this.isRed()?0:1)}}$o.EMPTY=null,$o.RED=!0,$o.BLACK=!1,$o.EMPTY=new class{constructor(){this.size=0}get key(){throw vs()}get value(){throw vs()}get color(){throw vs()}get left(){throw vs()}get right(){throw vs()}copy(e,t,n,r,i){return this}insert(e,t,n){return new $o(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Go{constructor(e){this.comparator=e,this.data=new jo(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new zo(this.data.getIterator())}getIteratorFrom(e){return new zo(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Go))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Go(this.comparator);return t.data=e,t}}class zo{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Wo(e){return e.hasNext()?e.getNext():void 0}class Ho{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.P=null}}function Qo(e,t=null,n=[],r=[],i=null,s=null,o=null){return new Ho(e,t,n,r,i,s,o)}function Yo(e){const t=bs(e);if(null===t.P){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>{return(t=e).field.canonicalString()+t.op.toString()+go(t.value);var t})).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),io(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>go(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>go(e))).join(",")),t.P=e}return t.P}function Jo(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!fa(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let i=0;i<e.filters.length;i++)if(n=e.filters[i],r=t.filters[i],n.op!==r.op||!n.field.isEqual(r.field)||!ho(n.value,r.value))return!1;var n,r;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ma(e.startAt,t.startAt)&&ma(e.endAt,t.endAt)}function Xo(e){return ao.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Zo(e,t){return e.filters.filter((e=>e instanceof na&&e.field.isEqual(t)))}function ea(e,t,n){let r=uo,i=!0;for(const n of Zo(e,t)){let e=uo,t=!0;switch(n.op){case"<":case"<=":e=ko(n.value);break;case"==":case"in":case">=":e=n.value;break;case">":e=n.value,t=!1;break;case"!=":case"not-in":e=uo}No({value:r,inclusive:i},{value:e,inclusive:t})<0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];No({value:r,inclusive:i},{value:e,inclusive:n.inclusive})<0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}function ta(e,t,n){let r=co,i=!0;for(const n of Zo(e,t)){let e=co,t=!0;switch(n.op){case">=":case">":e=Ao(n.value),t=!1;break;case"==":case"in":case"<=":e=n.value;break;case"<":e=n.value,t=!1;break;case"!=":case"not-in":e=co}Co({value:r,inclusive:i},{value:e,inclusive:t})>0&&(r=e,i=t)}if(null!==n)for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){const e=n.position[s];Co({value:r,inclusive:i},{value:e,inclusive:n.inclusive})>0&&(r=e,i=n.inclusive);break}return{value:r,inclusive:i}}class na extends class{}{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.V(e,t,n):new ra(e,t,n):"array-contains"===t?new aa(e,n):"in"===t?new ca(e,n):"not-in"===t?new ua(e,n):"array-contains-any"===t?new la(e,n):new na(e,t,n)}static V(e,t,n){return"in"===t?new ia(e,n):new sa(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.v(po(t,this.value)):null!==t&&lo(this.value)===lo(t)&&this.v(po(t,this.value))}v(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return vs()}}S(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class ra extends na{constructor(e,t,n){super(e,t,n),this.key=ao.fromName(n.referenceValue)}matches(e){const t=ao.comparator(e.key,this.key);return this.v(t)}}class ia extends na{constructor(e,t){super(e,"in",t),this.keys=oa(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class sa extends na{constructor(e,t){super(e,"not-in",t),this.keys=oa(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function oa(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>ao.fromName(e.referenceValue)))}class aa extends na{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return bo(t)&&fo(t.arrayValue,this.value)}}class ca extends na{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&fo(this.value.arrayValue,t)}}class ua extends na{constructor(e,t){super(e,"not-in",t)}matches(e){if(fo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!fo(this.value.arrayValue,t)}}class la extends na{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!bo(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>fo(this.value.arrayValue,e)))}}class ha{constructor(e,t){this.position=e,this.inclusive=t}}class da{constructor(e,t="asc"){this.field=e,this.dir=t}}function fa(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function pa(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(r=s.field.isKeyField()?ao.comparator(ao.fromName(o.referenceValue),n.key):po(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function ma(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!ho(e.position[n],t.position[n]))return!1;return!0}class ga{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.D=null,this.C=null,this.startAt,this.endAt}}function ya(e,t,n,r,i,s,o,a){return new ga(e,t,n,r,i,s,o,a)}function va(e){return new ga(e)}function wa(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function ba(e){for(const t of e.filters)if(t.S())return t.field;return null}function Ia(e){return null!==e.collectionGroup}function _a(e){const t=bs(e);if(null===t.D){t.D=[];const e=ba(t),n=wa(t);if(null!==e&&null===n)e.isKeyField()||t.D.push(new da(e)),t.D.push(new da(zs.keyField(),"asc"));else{let e=!1;for(const n of t.explicitOrderBy)t.D.push(n),n.field.isKeyField()&&(e=!0);if(!e){const e=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.D.push(new da(zs.keyField(),e))}}}return t.D}function Ta(e){const t=bs(e);if(!t.C)if("F"===t.limitType)t.C=Qo(t.path,t.collectionGroup,_a(t),t.filters,t.limit,t.startAt,t.endAt);else{const e=[];for(const n of _a(t)){const t="desc"===n.dir?"asc":"desc";e.push(new da(n.field,t))}const n=t.endAt?new ha(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new ha(t.startAt.position,t.startAt.inclusive):null;t.C=Qo(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}return t.C}function Ea(e,t,n){return new ga(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function Sa(e,t){return Jo(Ta(e),Ta(t))&&e.limitType===t.limitType}function ka(e){return`${Yo(Ta(e))}|lt:${e.limitType}`}function Aa(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>{return`${(t=e).field.canonicalString()} ${t.op} ${go(t.value)}`;var t})).join(", ")}]`),io(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>go(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>go(e))).join(",")),`Target(${t})`}(Ta(e))}; limitType=${e.limitType})`}function Na(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):ao.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of e.explicitOrderBy)if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=pa(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,_a(e),t)||e.endAt&&!function(e,t,n){const r=pa(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,_a(e),t))}(e,t)}function Ca(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function Da(e){return(t,n)=>{let r=!1;for(const i of _a(e)){const e=Ra(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}function Ra(e,t,n){const r=e.field.isKeyField()?ao.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?po(r,i):vs()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return vs()}}function xa(e,t){if(e.N){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:so(t)?"-0":t}}function Pa(e){return{integerValue:""+e}}function Oa(e,t){return oo(t)?Pa(t):xa(e,t)}class La{constructor(){this._=void 0}}function Ma(e,t,n){return e instanceof Ua?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof qa?Ba(e,t):e instanceof ja?Ka(e,t):function(e,t){const n=Va(e,t),r=Ga(n)+Ga(e.k);return wo(n)&&wo(e.k)?Pa(r):xa(e.M,r)}(e,t)}function Fa(e,t,n){return e instanceof qa?Ba(e,t):e instanceof ja?Ka(e,t):n}function Va(e,t){return e instanceof $a?wo(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}class Ua extends La{}class qa extends La{constructor(e){super(),this.elements=e}}function Ba(e,t){const n=za(t);for(const t of e.elements)n.some((e=>ho(e,t)))||n.push(t);return{arrayValue:{values:n}}}class ja extends La{constructor(e){super(),this.elements=e}}function Ka(e,t){let n=za(t);for(const t of e.elements)n=n.filter((e=>!ho(e,t)));return{arrayValue:{values:n}}}class $a extends La{constructor(e,t){super(),this.M=e,this.k=t}}function Ga(e){return Js(e.integerValue||e.doubleValue)}function za(e){return bo(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Wa{constructor(e,t){this.field=e,this.transform=t}}class Ha{constructor(e,t){this.version=e,this.transformResults=t}}class Qa{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Qa}static exists(e){return new Qa(void 0,e)}static updateTime(e){return new Qa(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ya(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Ja{}function Xa(e,t,n){e instanceof rc?function(e,t,n){const r=e.value.clone(),i=oc(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof ic?function(e,t,n){if(!Ya(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=oc(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(sc(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Za(e,t,n){e instanceof rc?function(e,t,n){if(!Ya(e.precondition,t))return;const r=e.value.clone(),i=ac(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument(nc(t),r).setHasLocalMutations()}(e,t,n):e instanceof ic?function(e,t,n){if(!Ya(e.precondition,t))return;const r=ac(e.fieldTransforms,n,t),i=t.data;i.setAll(sc(e)),i.setAll(r),t.convertToFoundDocument(nc(t),i).setHasLocalMutations()}(e,t,n):function(e,t){Ya(e.precondition,t)&&t.convertToNoDocument(Us.min())}(e,t)}function ec(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),i=Va(r.transform,e||null);null!=i&&(null==n&&(n=Do.empty()),n.set(r.field,i))}return n||null}function tc(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Ms(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof qa&&t instanceof qa||e instanceof ja&&t instanceof ja?Ms(e.elements,t.elements,ho):e instanceof $a&&t instanceof $a?ho(e.k,t.k):e instanceof Ua&&t instanceof Ua}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function nc(e){return e.isFoundDocument()?e.version:Us.min()}class rc extends Ja{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}}class ic extends Ja{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}}function sc(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function oc(e,t,n){const r=new Map;ws(e.length===n.length);for(let i=0;i<n.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);r.set(s.field,Fa(o,a,n[i]))}return r}function ac(e,t,n){const r=new Map;for(const i of e){const e=i.transform,s=n.data.field(i.field);r.set(i.field,Ma(e,s,t))}return r}class cc extends Ja{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}}class uc extends Ja{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}}class lc{constructor(e){this.count=e}}var hc,dc;function fc(e){switch(e){default:return vs();case Is.CANCELLED:case Is.UNKNOWN:case Is.DEADLINE_EXCEEDED:case Is.RESOURCE_EXHAUSTED:case Is.INTERNAL:case Is.UNAVAILABLE:case Is.UNAUTHENTICATED:return!1;case Is.INVALID_ARGUMENT:case Is.NOT_FOUND:case Is.ALREADY_EXISTS:case Is.PERMISSION_DENIED:case Is.FAILED_PRECONDITION:case Is.ABORTED:case Is.OUT_OF_RANGE:case Is.UNIMPLEMENTED:case Is.DATA_LOSS:return!0}}function pc(e){if(void 0===e)return ms("GRPC error has no .code"),Is.UNKNOWN;switch(e){case hc.OK:return Is.OK;case hc.CANCELLED:return Is.CANCELLED;case hc.UNKNOWN:return Is.UNKNOWN;case hc.DEADLINE_EXCEEDED:return Is.DEADLINE_EXCEEDED;case hc.RESOURCE_EXHAUSTED:return Is.RESOURCE_EXHAUSTED;case hc.INTERNAL:return Is.INTERNAL;case hc.UNAVAILABLE:return Is.UNAVAILABLE;case hc.UNAUTHENTICATED:return Is.UNAUTHENTICATED;case hc.INVALID_ARGUMENT:return Is.INVALID_ARGUMENT;case hc.NOT_FOUND:return Is.NOT_FOUND;case hc.ALREADY_EXISTS:return Is.ALREADY_EXISTS;case hc.PERMISSION_DENIED:return Is.PERMISSION_DENIED;case hc.FAILED_PRECONDITION:return Is.FAILED_PRECONDITION;case hc.ABORTED:return Is.ABORTED;case hc.OUT_OF_RANGE:return Is.OUT_OF_RANGE;case hc.UNIMPLEMENTED:return Is.UNIMPLEMENTED;case hc.DATA_LOSS:return Is.DATA_LOSS;default:return vs()}}(dc=hc||(hc={}))[dc.OK=0]="OK",dc[dc.CANCELLED=1]="CANCELLED",dc[dc.UNKNOWN=2]="UNKNOWN",dc[dc.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",dc[dc.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",dc[dc.NOT_FOUND=5]="NOT_FOUND",dc[dc.ALREADY_EXISTS=6]="ALREADY_EXISTS",dc[dc.PERMISSION_DENIED=7]="PERMISSION_DENIED",dc[dc.UNAUTHENTICATED=16]="UNAUTHENTICATED",dc[dc.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",dc[dc.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",dc[dc.ABORTED=10]="ABORTED",dc[dc.OUT_OF_RANGE=11]="OUT_OF_RANGE",dc[dc.UNIMPLEMENTED=12]="UNIMPLEMENTED",dc[dc.INTERNAL=13]="INTERNAL",dc[dc.UNAVAILABLE=14]="UNAVAILABLE",dc[dc.DATA_LOSS=15]="DATA_LOSS";class mc{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Bs(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return js(this.inner)}size(){return this.innerSize}}const gc=new jo(ao.comparator);function yc(){return gc}const vc=new jo(ao.comparator);function wc(...e){let t=vc;for(const n of e)t=t.insert(n.key,n);return t}function bc(){return new mc((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Ic=new jo(ao.comparator),_c=new Go(ao.comparator);function Tc(...e){let t=_c;for(const n of e)t=t.add(n);return t}const Ec=new Go(Ls);function Sc(){return Ec}class kc{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t){const n=new Map;return n.set(e,Ac.createSynthesizedTargetChangeForCurrentChange(e,t)),new kc(Us.min(),n,Sc(),yc(),Tc())}}class Ac{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t){return new Ac(Hs.EMPTY_BYTE_STRING,t,Tc(),Tc(),Tc())}}class Nc{constructor(e,t,n,r){this.O=e,this.removedTargetIds=t,this.key=n,this.F=r}}class Cc{constructor(e,t){this.targetId=e,this.$=t}}class Dc{constructor(e,t,n=Hs.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Rc{constructor(){this.B=0,this.L=Oc(),this.U=Hs.EMPTY_BYTE_STRING,this.q=!1,this.K=!0}get current(){return this.q}get resumeToken(){return this.U}get G(){return 0!==this.B}get j(){return this.K}W(e){e.approximateByteSize()>0&&(this.K=!0,this.U=e)}H(){let e=Tc(),t=Tc(),n=Tc();return this.L.forEach(((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:vs()}})),new Ac(this.U,this.q,e,t,n)}J(){this.K=!1,this.L=Oc()}Y(e,t){this.K=!0,this.L=this.L.insert(e,t)}X(e){this.K=!0,this.L=this.L.remove(e)}Z(){this.B+=1}tt(){this.B-=1}et(){this.K=!0,this.q=!0}}class xc{constructor(e){this.nt=e,this.st=new Map,this.it=yc(),this.rt=Pc(),this.ot=new Go(Ls)}ut(e){for(const t of e.O)e.F&&e.F.isFoundDocument()?this.at(t,e.F):this.ct(t,e.key,e.F);for(const t of e.removedTargetIds)this.ct(t,e.key,e.F)}ht(e){this.forEachTarget(e,(t=>{const n=this.lt(t);switch(e.state){case 0:this.ft(t)&&n.W(e.resumeToken);break;case 1:n.tt(),n.G||n.J(),n.W(e.resumeToken);break;case 2:n.tt(),n.G||this.removeTarget(t);break;case 3:this.ft(t)&&(n.et(),n.W(e.resumeToken));break;case 4:this.ft(t)&&(this.dt(t),n.W(e.resumeToken));break;default:vs()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.st.forEach(((e,n)=>{this.ft(n)&&t(n)}))}_t(e){const t=e.targetId,n=e.$.count,r=this.wt(t);if(r){const e=r.target;if(Xo(e))if(0===n){const n=new ao(e.path);this.ct(t,n,xo.newNoDocument(n,Us.min()))}else ws(1===n);else this.gt(t)!==n&&(this.dt(t),this.ot=this.ot.add(t))}}yt(e){const t=new Map;this.st.forEach(((n,r)=>{const i=this.wt(r);if(i){if(n.current&&Xo(i.target)){const t=new ao(i.target.path);null!==this.it.get(t)||this.It(r,t)||this.ct(r,t,xo.newNoDocument(t,e))}n.j&&(t.set(r,n.H()),n.J())}}));let n=Tc();this.rt.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.wt(e);return!t||2===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.it.forEach(((t,n)=>n.setReadTime(e)));const r=new kc(e,t,this.ot,this.it,n);return this.it=yc(),this.rt=Pc(),this.ot=new Go(Ls),r}at(e,t){if(!this.ft(e))return;const n=this.It(e,t.key)?2:0;this.lt(e).Y(t.key,n),this.it=this.it.insert(t.key,t),this.rt=this.rt.insert(t.key,this.Tt(t.key).add(e))}ct(e,t,n){if(!this.ft(e))return;const r=this.lt(e);this.It(e,t)?r.Y(t,1):r.X(t),this.rt=this.rt.insert(t,this.Tt(t).delete(e)),n&&(this.it=this.it.insert(t,n))}removeTarget(e){this.st.delete(e)}gt(e){const t=this.lt(e).H();return this.nt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Z(e){this.lt(e).Z()}lt(e){let t=this.st.get(e);return t||(t=new Rc,this.st.set(e,t)),t}Tt(e){let t=this.rt.get(e);return t||(t=new Go(Ls),this.rt=this.rt.insert(e,t)),t}ft(e){const t=null!==this.wt(e);return t||ps("WatchChangeAggregator","Detected inactive target",e),t}wt(e){const t=this.st.get(e);return t&&t.G?null:this.nt.Et(e)}dt(e){this.st.set(e,new Rc),this.nt.getRemoteKeysForTarget(e).forEach((t=>{this.ct(e,t,null)}))}It(e,t){return this.nt.getRemoteKeysForTarget(e).has(t)}}function Pc(){return new jo(ao.comparator)}function Oc(){return new jo(ao.comparator)}const Lc={asc:"ASCENDING",desc:"DESCENDING"},Mc={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Fc{constructor(e,t){this.databaseId=e,this.N=t}}function Vc(e,t){return e.N?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Uc(e,t){return e.N?t.toBase64():t.toUint8Array()}function qc(e,t){return Vc(e,t.toTimestamp())}function Bc(e){return ws(!!e),Us.fromTimestamp(function(e){const t=Ys(e);return new Vs(t.seconds,t.nanos)}(e))}function jc(e,t){return function(e){return new $s(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Kc(e){const t=$s.fromString(e);return ws(hu(t)),t}function $c(e,t){return jc(e.databaseId,t.path)}function Gc(e,t){const n=Kc(t);if(n.get(1)!==e.databaseId.projectId)throw new _s(Is.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new _s(Is.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new ao(Qc(n))}function zc(e,t){return jc(e.databaseId,t)}function Wc(e){const t=Kc(e);return 4===t.length?$s.emptyPath():Qc(t)}function Hc(e){return new $s(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Qc(e){return ws(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Yc(e,t,n){return{name:$c(e,t),fields:n.value.mapValue.fields}}function Jc(e,t,n){const r=Gc(e,t.name),i=Bc(t.updateTime),s=new Do({mapValue:{fields:t.fields}}),o=xo.newFoundDocument(r,i,s);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Xc(e,t){let n;if(t instanceof rc)n={update:Yc(e,t.key,t.value)};else if(t instanceof cc)n={delete:$c(e,t.key)};else if(t instanceof ic)n={update:Yc(e,t.key,t.data),updateMask:lu(t.fieldMask)};else{if(!(t instanceof uc))return vs();n={verify:$c(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof Ua)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof qa)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ja)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof $a)return{fieldPath:t.field.canonicalString(),increment:n.k};throw vs()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:qc(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:vs()}(e,t.precondition)),n}function Zc(e,t){const n=t.currentDocument?function(e){return void 0!==e.updateTime?Qa.updateTime(Bc(e.updateTime)):void 0!==e.exists?Qa.exists(e.exists):Qa.none()}(t.currentDocument):Qa.none(),r=t.updateTransforms?t.updateTransforms.map((t=>function(e,t){let n=null;if("setToServerValue"in t)ws("REQUEST_TIME"===t.setToServerValue),n=new Ua;else if("appendMissingElements"in t){const e=t.appendMissingElements.values||[];n=new qa(e)}else if("removeAllFromArray"in t){const e=t.removeAllFromArray.values||[];n=new ja(e)}else"increment"in t?n=new $a(e,t.increment):vs();const r=zs.fromServerFormat(t.fieldPath);return new Wa(r,n)}(e,t))):[];if(t.update){t.update.name;const i=Gc(e,t.update.name),s=new Do({mapValue:{fields:t.update.fields}});if(t.updateMask){const e=function(e){const t=e.fieldPaths||[];return new Ws(t.map((e=>zs.fromServerFormat(e))))}(t.updateMask);return new ic(i,s,e,n,r)}return new rc(i,s,n,r)}if(t.delete){const r=Gc(e,t.delete);return new cc(r,n)}if(t.verify){const r=Gc(e,t.verify);return new uc(r,n)}return vs()}function eu(e,t){return{documents:[zc(e,t.path)]}}function tu(e,t){const n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=zc(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=zc(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(e){if(0===e.length)return;const t=e.map((e=>function(e){if("=="===e.op){if(_o(e.value))return{unaryFilter:{field:ou(e.field),op:"IS_NAN"}};if(Io(e.value))return{unaryFilter:{field:ou(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(_o(e.value))return{unaryFilter:{field:ou(e.field),op:"IS_NOT_NAN"}};if(Io(e.value))return{unaryFilter:{field:ou(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ou(e.field),op:su(e.op),value:e.value}}}(e)));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}(t.filters);i&&(n.structuredQuery.where=i);const s=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:ou(e.field),direction:iu(e.dir)}}(e)))}(t.orderBy);s&&(n.structuredQuery.orderBy=s);const o=function(e,t){return e.N||io(t)?t:{value:t}}(e,t.limit);var a;return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt={before:(a=t.startAt).inclusive,values:a.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function nu(e){let t=Wc(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){ws(1===r);const e=n.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];n.where&&(s=ru(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((e=>function(e){return new da(au(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,io(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new ha(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new ha(n,t)}(n.endAt)),ya(t,i,o,s,a,"F",c,u)}function ru(e){return e?void 0!==e.unaryFilter?[uu(e)]:void 0!==e.fieldFilter?[cu(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((e=>ru(e))).reduce(((e,t)=>e.concat(t))):vs():[]}function iu(e){return Lc[e]}function su(e){return Mc[e]}function ou(e){return{fieldPath:e.canonicalString()}}function au(e){return zs.fromServerFormat(e.fieldPath)}function cu(e){return na.create(au(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return vs()}}(e.fieldFilter.op),e.fieldFilter.value)}function uu(e){switch(e.unaryFilter.op){case"IS_NAN":const t=au(e.unaryFilter.field);return na.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=au(e.unaryFilter.field);return na.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=au(e.unaryFilter.field);return na.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=au(e.unaryFilter.field);return na.create(i,"!=",{nullValue:"NULL_VALUE"});default:return vs()}}function lu(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function hu(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function du(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=pu(t)),t=fu(e.get(n),t);return pu(t)}function fu(e,t){let n=t;const r=e.length;for(let t=0;t<r;t++){const r=e.charAt(t);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function pu(e){return e+""}function mu(e){const t=e.length;if(ws(t>=2),2===t)return ws(""===e.charAt(0)&&""===e.charAt(1)),$s.emptyPath();const n=t-2,r=[];let i="";for(let s=0;s<t;){const t=e.indexOf("",s);switch((t<0||t>n)&&vs(),e.charAt(t+1)){case"":const n=e.substring(s,t);let o;0===i.length?o=n:(i+=n,o=i,i=""),r.push(o);break;case"":i+=e.substring(s,t),i+="\0";break;case"":i+=e.substring(s,t+1);break;default:vs()}s=t+2}return new $s(r)}const gu=["userId","batchId"];function yu(e,t){return[e,du(t)]}function vu(e,t,n){return[e,du(t),n]}const wu={},bu=["prefixPath","collectionGroup","readTime","documentId"],Iu=["prefixPath","collectionGroup","documentId"],_u=["collectionGroup","readTime","prefixPath","documentId"],Tu=["canonicalId","targetId"],Eu=["targetId","path"],Su=["path","targetId"],ku=["collectionId","parent"],Au=["indexId","uid"],Nu=["uid","sequenceNumber"],Cu=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Du=["indexId","uid","orderedDocumentKey"],Ru=["userId","collectionPath","documentId"],xu=["userId","collectionPath","largestBatchId"],Pu=["userId","collectionGroup","largestBatchId"],Ou=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Lu=[...Ou,"documentOverlays"],Mu=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Fu=[...Mu,"indexConfiguration","indexState","indexEntries"],Vu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Uu{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}class qu{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&vs(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new qu(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof qu?t:qu.resolve(t)}catch(e){return qu.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):qu.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):qu.reject(t)}static resolve(e){return new qu(((t,n)=>{t(e)}))}static reject(e){return new qu(((t,n)=>{n(e)}))}static waitFor(e){return new qu(((t,n)=>{let r=0,i=0,s=!1;e.forEach((e=>{++r,e.next((()=>{++i,s&&i===r&&t()}),(e=>n(e)))})),s=!0,i===r&&t()}))}static or(e){let t=qu.resolve(!1);for(const n of e)t=t.next((e=>e?qu.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}}class Bu{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.At=new Ts,this.transaction.oncomplete=()=>{this.At.resolve()},this.transaction.onabort=()=>{t.error?this.At.reject(new $u(e,t.error)):this.At.resolve()},this.transaction.onerror=t=>{const n=Qu(t.target.error);this.At.reject(new $u(e,n))}}static open(e,t,n,r){try{return new Bu(t,e.transaction(r,n))}catch(e){throw new $u(t,e)}}get Rt(){return this.At.promise}abort(e){e&&this.At.reject(e),this.aborted||(ps("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}bt(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new zu(t)}}class ju{constructor(e,t,n){this.name=e,this.version=t,this.Pt=n,12.2===ju.Vt(k())&&ms("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return ps("SimpleDb","Removing database:",e),Wu(window.indexedDB.deleteDatabase(e)).toPromise()}static vt(){if(!x())return!1;if(ju.St())return!0;const e=k(),t=ju.Vt(e),n=0<t&&t<10,r=ju.Dt(e),i=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||i)}static St(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.Ct)}static xt(e,t){return e.store(t)}static Vt(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Dt(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Nt(e){return this.db||(ps("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new $u(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new _s(Is.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new _s(Is.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new $u(e,r))},r.onupgradeneeded=e=>{ps("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.Pt.kt(t,r.transaction,e.oldVersion,this.version).next((()=>{ps("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.Mt&&(this.db.onversionchange=e=>this.Mt(e)),this.db}Ot(e){this.Mt=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const i="readonly"===t;let s=0;for(;;){++s;try{this.db=await this.Nt(e);const t=Bu.open(this.db,e,i?"readonly":"readwrite",n),s=r(t).next((e=>(t.bt(),e))).catch((e=>(t.abort(e),qu.reject(e)))).toPromise();return s.catch((()=>{})),await t.Rt,s}catch(e){const t="FirebaseError"!==e.name&&s<3;if(ps("SimpleDb","Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Ku{constructor(e){this.Ft=e,this.$t=!1,this.Bt=null}get isDone(){return this.$t}get Lt(){return this.Bt}set cursor(e){this.Ft=e}done(){this.$t=!0}Ut(e){this.Bt=e}delete(){return Wu(this.Ft.delete())}}class $u extends _s{constructor(e,t){super(Is.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Gu(e){return"IndexedDbTransactionError"===e.name}class zu{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(ps("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(ps("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Wu(n)}add(e){return ps("SimpleDb","ADD",this.store.name,e,e),Wu(this.store.add(e))}get(e){return Wu(this.store.get(e)).next((t=>(void 0===t&&(t=null),ps("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return ps("SimpleDb","DELETE",this.store.name,e),Wu(this.store.delete(e))}count(){return ps("SimpleDb","COUNT",this.store.name),Wu(this.store.count())}qt(e,t){const n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){const e=this.cursor(n),t=[];return this.Kt(e,((e,n)=>{t.push(n)})).next((()=>t))}{const e=this.store.getAll(n.range);return new qu(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}}Gt(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new qu(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}Qt(e,t){ps("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.jt=!1;const r=this.cursor(n);return this.Kt(r,((e,t,n)=>n.delete()))}Wt(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.Kt(r,t)}zt(e){const t=this.cursor({});return new qu(((n,r)=>{t.onerror=e=>{const t=Qu(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}Kt(e,t){const n=[];return new qu(((r,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{const i=e.target.result;if(!i)return void r();const s=new Ku(i),o=t(i.primaryKey,i.value,s);if(o instanceof qu){const e=o.catch((e=>(s.done(),qu.reject(e))));n.push(e)}s.isDone?r():null===s.Lt?i.continue():i.continue(s.Lt)}})).next((()=>qu.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.jt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Wu(e){return new qu(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=Qu(e.target.error);n(t)}}))}let Hu=!1;function Qu(e){const t=ju.Vt(k());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new _s("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Hu||(Hu=!0,setTimeout((()=>{throw e}),0)),e}}return e}class Yu extends Uu{constructor(e,t){super(),this.Ht=e,this.currentSequenceNumber=t}}function Ju(e,t){const n=bs(e);return ju.xt(n.Ht,t)}class Xu{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Xa(r,e,n[t])}}applyToLocalView(e){for(const t of this.baseMutations)t.key.isEqual(e.key)&&Za(t,e,this.localWriteTime);for(const t of this.mutations)t.key.isEqual(e.key)&&Za(t,e,this.localWriteTime)}applyToLocalDocumentSet(e){this.mutations.forEach((t=>{const n=e.get(t.key),r=n;this.applyToLocalView(r),n.isValidDocument()||r.convertToNoDocument(Us.min())}))}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Tc())}isEqual(e){return this.batchId===e.batchId&&Ms(this.mutations,e.mutations,((e,t)=>tc(e,t)))&&Ms(this.baseMutations,e.baseMutations,((e,t)=>tc(e,t)))}}class Zu{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){ws(e.mutations.length===n.length);let r=Ic;const i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new Zu(e,t,n,r)}}class el{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class tl{constructor(e,t,n,r,i=Us.min(),s=Us.min(),o=Hs.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o}withSequenceNumber(e){return new tl(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new tl(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new tl(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class nl{constructor(e){this.Jt=e}}function rl(e,t){const n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:il(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:$c(e,t.key),fields:t.data.value.mapValue.fields,updateTime:Vc(e,t.version.toTimestamp())}}(e.Jt,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:sl(t.version)};else{if(!t.isUnknownDocument())return vs();r.unknownDocument={path:n.path.toArray(),version:sl(t.version)}}return r}function il(e){const t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function sl(e){const t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function ol(e){const t=new Vs(e.seconds,e.nanoseconds);return Us.fromTimestamp(t)}function al(e,t){const n=(t.baseMutations||[]).map((t=>Zc(e.Jt,t)));for(let e=0;e<t.mutations.length-1;++e){const n=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){const r=t.mutations[e+1];n.updateTransforms=r.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}const r=t.mutations.map((t=>Zc(e.Jt,t))),i=Vs.fromMillis(t.localWriteTimeMs);return new Xu(t.batchId,i,n,r)}function cl(e){const t=ol(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?ol(e.lastLimboFreeSnapshotVersion):Us.min();let r;var i;return void 0!==e.query.documents?(ws(1===(i=e.query).documents.length),r=Ta(va(Wc(i.documents[0])))):r=function(e){return Ta(nu(e))}(e.query),new tl(r,e.targetId,0,e.lastListenSequenceNumber,t,n,Hs.fromBase64String(e.resumeToken))}function ul(e,t){const n=sl(t.snapshotVersion),r=sl(t.lastLimboFreeSnapshotVersion);let i;i=Xo(t.target)?eu(e.Jt,t.target):tu(e.Jt,t.target);const s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:Yo(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function ll(e){const t=nu({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Ea(t,t.limit,"L"):t}function hl(e,t){return new el(t.largestBatchId,Zc(e.Jt,t.overlayMutation))}function dl(e,t){const n=t.path.lastSegment();return[e,du(t.path.popLast()),n]}class fl{getBundleMetadata(e,t){return pl(e).get(t).next((e=>{if(e)return{id:(t=e).bundleId,createTime:ol(t.createTime),version:t.version};var t}))}saveBundleMetadata(e,t){return pl(e).put({bundleId:(n=t).id,createTime:sl(Bc(n.createTime)),version:n.version});var n}getNamedQuery(e,t){return ml(e).get(t).next((e=>{if(e)return{name:(t=e).name,query:ll(t.bundledQuery),readTime:ol(t.readTime)};var t}))}saveNamedQuery(e,t){return ml(e).put(function(e){return{name:e.name,readTime:sl(Bc(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}function pl(e){return Ju(e,"bundles")}function ml(e){return Ju(e,"namedQueries")}class gl{constructor(e,t){this.M=e,this.userId=t}static Yt(e,t){const n=t.uid||"";return new gl(e,n)}getOverlay(e,t){return yl(e).get(dl(this.userId,t)).next((e=>e?hl(this.M,e):null))}saveOverlays(e,t,n){const r=[];return n.forEach(((n,i)=>{const s=new el(t,i);r.push(this.Xt(e,s))})),qu.waitFor(r)}removeOverlaysForBatchId(e,t,n){const r=new Set;t.forEach((e=>r.add(du(e.getCollectionPath()))));const i=[];return r.forEach((t=>{const r=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,n+1],!1,!0);i.push(yl(e).Qt("collectionPathOverlayIndex",r))})),qu.waitFor(i)}getOverlaysForCollection(e,t,n){const r=bc(),i=du(t),s=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return yl(e).qt("collectionPathOverlayIndex",s).next((e=>{for(const t of e){const e=hl(this.M,t);r.set(e.getKey(),e)}return r}))}getOverlaysForCollectionGroup(e,t,n,r){const i=bc();let s;const o=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return yl(e).Wt({index:"collectionGroupOverlayIndex",range:o},((e,t,n)=>{const o=hl(this.M,t);i.size()<r||o.largestBatchId===s?(i.set(o.getKey(),o),s=o.largestBatchId):n.done()})).next((()=>i))}Xt(e,t){return yl(e).put(function(e,t,n){const[r,i,s]=dl(t,n.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Xc(e.Jt,n.mutation)}}(this.M,this.userId,t))}}function yl(e){return Ju(e,"documentOverlays")}class vl{constructor(){}Zt(e,t){this.te(e,t),t.ee()}te(e,t){if("nullValue"in e)this.ne(t,5);else if("booleanValue"in e)this.ne(t,10),t.se(e.booleanValue?1:0);else if("integerValue"in e)this.ne(t,15),t.se(Js(e.integerValue));else if("doubleValue"in e){const n=Js(e.doubleValue);isNaN(n)?this.ne(t,13):(this.ne(t,15),so(n)?t.se(0):t.se(n))}else if("timestampValue"in e){const n=e.timestampValue;this.ne(t,20),"string"==typeof n?t.ie(n):(t.ie(`${n.seconds||""}`),t.se(n.nanos||0))}else if("stringValue"in e)this.re(e.stringValue,t),this.oe(t);else if("bytesValue"in e)this.ne(t,30),t.ue(Xs(e.bytesValue)),this.oe(t);else if("referenceValue"in e)this.ae(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.ne(t,45),t.se(n.latitude||0),t.se(n.longitude||0)}else"mapValue"in e?So(e)?this.ne(t,Number.MAX_SAFE_INTEGER):(this.ce(e.mapValue,t),this.oe(t)):"arrayValue"in e?(this.he(e.arrayValue,t),this.oe(t)):vs()}re(e,t){this.ne(t,25),this.le(e,t)}le(e,t){t.ie(e)}ce(e,t){const n=e.fields||{};this.ne(t,55);for(const e of Object.keys(n))this.re(e,t),this.te(n[e],t)}he(e,t){const n=e.values||[];this.ne(t,50);for(const e of n)this.te(e,t)}ae(e,t){this.ne(t,37),ao.fromName(e).path.forEach((e=>{this.ne(t,60),this.le(e,t)}))}ne(e,t){e.se(t)}oe(e){e.se(2)}}function wl(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function bl(e){const t=64-function(e){let t=0;for(let n=0;n<8;++n){const r=wl(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}vl.fe=new vl;class Il{constructor(){this.buffer=new Uint8Array(1024),this.position=0}de(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this._e(n.value),n=t.next();this.we()}me(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.ge(n.value),n=t.next();this.ye()}pe(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this._e(e);else if(e<2048)this._e(960|e>>>6),this._e(128|63&e);else if(t<"\ud800"||"\udbff"<t)this._e(480|e>>>12),this._e(128|63&e>>>6),this._e(128|63&e);else{const e=t.codePointAt(0);this._e(240|e>>>18),this._e(128|63&e>>>12),this._e(128|63&e>>>6),this._e(128|63&e)}}this.we()}Ie(e){for(const t of e){const e=t.charCodeAt(0);if(e<128)this.ge(e);else if(e<2048)this.ge(960|e>>>6),this.ge(128|63&e);else if(t<"\ud800"||"\udbff"<t)this.ge(480|e>>>12),this.ge(128|63&e>>>6),this.ge(128|63&e);else{const e=t.codePointAt(0);this.ge(240|e>>>18),this.ge(128|63&e>>>12),this.ge(128|63&e>>>6),this.ge(128|63&e)}}this.ye()}Te(e){const t=this.Ee(e),n=bl(t);this.Ae(1+n),this.buffer[this.position++]=255&n;for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=255&t[e]}Re(e){const t=this.Ee(e),n=bl(t);this.Ae(1+n),this.buffer[this.position++]=~(255&n);for(let e=t.length-n;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}be(){this.Pe(255),this.Pe(255)}Ve(){this.ve(255),this.ve(255)}reset(){this.position=0}seed(e){this.Ae(e.length),this.buffer.set(e,this.position),this.position+=e.length}Se(){return this.buffer.slice(0,this.position)}Ee(e){const t=function(e){const t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(let e=1;e<t.length;++e)t[e]^=n?255:0;return t}_e(e){const t=255&e;0===t?(this.Pe(0),this.Pe(255)):255===t?(this.Pe(255),this.Pe(0)):this.Pe(t)}ge(e){const t=255&e;0===t?(this.ve(0),this.ve(255)):255===t?(this.ve(255),this.ve(0)):this.ve(e)}we(){this.Pe(0),this.Pe(1)}ye(){this.ve(0),this.ve(1)}Pe(e){this.Ae(1),this.buffer[this.position++]=e}ve(e){this.Ae(1),this.buffer[this.position++]=~e}Ae(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}class _l{constructor(e){this.De=e}ue(e){this.De.de(e)}ie(e){this.De.pe(e)}se(e){this.De.Te(e)}ee(){this.De.be()}}class Tl{constructor(e){this.De=e}ue(e){this.De.me(e)}ie(e){this.De.Ie(e)}se(e){this.De.Re(e)}ee(){this.De.Ve()}}class El{constructor(){this.De=new Il,this.Ce=new _l(this.De),this.xe=new Tl(this.De)}seed(e){this.De.seed(e)}Ne(e){return 0===e?this.Ce:this.xe}Se(){return this.De.Se()}reset(){this.De.reset()}}class Sl{constructor(e,t,n,r){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=r}ke(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new Sl(this.indexId,this.documentKey,this.arrayValue,n)}}function kl(e,t){let n=e.indexId-t.indexId;return 0!==n?n:(n=Al(e.arrayValue,t.arrayValue),0!==n?n:(n=Al(e.directionalValue,t.directionalValue),0!==n?n:ao.comparator(e.documentKey,t.documentKey)))}function Al(e,t){for(let n=0;n<e.length&&n<t.length;++n){const r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}class Nl{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Me=e.orderBy,this.Oe=[];for(const t of e.filters){const e=t;e.S()?this.Fe=e:this.Oe.push(e)}}$e(e){const t=Oo(e);if(void 0!==t&&!this.Be(t))return!1;const n=Lo(e);let r=0,i=0;for(;r<n.length&&this.Be(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.Fe){const e=n[r];if(!this.Le(this.Fe,e)||!this.Ue(this.Me[i++],e))return!1;++r}for(;r<n.length;++r){const e=n[r];if(i>=this.Me.length||!this.Ue(this.Me[i++],e))return!1}return!0}Be(e){for(const t of this.Oe)if(this.Le(t,e))return!0;return!1}Le(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;const n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}Ue(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}class Cl{constructor(){this.qe=new Dl}addToCollectionParentIndex(e,t){return this.qe.add(t),qu.resolve()}getCollectionParents(e,t){return qu.resolve(this.qe.getEntries(t))}addFieldIndex(e,t){return qu.resolve()}deleteFieldIndex(e,t){return qu.resolve()}getDocumentsMatchingTarget(e,t){return qu.resolve(null)}getIndexType(e,t){return qu.resolve(0)}getFieldIndexes(e,t){return qu.resolve([])}getNextCollectionGroupToUpdate(e){return qu.resolve(null)}getMinOffset(e,t){return qu.resolve(qo.min())}updateCollectionGroup(e,t,n){return qu.resolve()}updateIndexEntries(e,t){return qu.resolve()}}class Dl{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Go($s.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Go($s.comparator)).toArray()}}const Rl=new Uint8Array(0);class xl{constructor(e,t){this.user=e,this.databaseId=t,this.Ke=new Dl,this.Ge=new mc((e=>Yo(e)),((e,t)=>Jo(e,t))),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Ke.has(t)){const n=t.lastSegment(),r=t.popLast();e.addOnCommittedListener((()=>{this.Ke.add(t)}));const i={collectionId:n,parent:du(r)};return Pl(e).put(i)}return qu.resolve()}getCollectionParents(e,t){const n=[],r=IDBKeyRange.bound([t,""],[Fs(t),""],!1,!0);return Pl(e).qt(r).next((e=>{for(const r of e){if(r.collectionId!==t)break;n.push(mu(r.parent))}return n}))}addFieldIndex(e,t){const n=Ll(e),r=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((e=>[e.fieldPath.canonicalString(),e.kind]))}}(t);return delete r.indexId,n.add(r).next()}deleteFieldIndex(e,t){const n=Ll(e),r=Ml(e),i=Ol(e);return n.delete(t.indexId).next((()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))).next((()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))))}getDocumentsMatchingTarget(e,t){const n=Ol(e);let r=!0;const i=new Map;return qu.forEach(this.Qe(t),(t=>this.je(e,t).next((e=>{r&&(r=!!e),i.set(t,e)})))).next((()=>{if(r){let e=Tc();const r=[];return qu.forEach(i,((i,s)=>{var o;ps("IndexedDbIndexManager",`Using index ${o=i,`id=${o.indexId}|cg=${o.collectionGroup}|f=${o.fields.map((e=>`${e.fieldPath}:${e.kind}`)).join(",")}`} to execute ${Yo(t)}`);const a=function(e,t){const n=Oo(t);if(void 0===n)return null;for(const t of Zo(e,n.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}(s,i),c=function(e,t){const n=new Map;for(const r of Lo(t))for(const t of Zo(e,r.fieldPath))switch(t.op){case"==":case"in":n.set(r.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return n.set(r.fieldPath.canonicalString(),t.value),Array.from(n.values())}return null}(s,i),u=function(e,t){const n=[];let r=!0;for(const i of Lo(t)){const t=0===i.kind?ea(e,i.fieldPath,e.startAt):ta(e,i.fieldPath,e.startAt);n.push(t.value),r&&(r=t.inclusive)}return new ha(n,r)}(s,i),l=function(e,t){const n=[];let r=!0;for(const i of Lo(t)){const t=0===i.kind?ta(e,i.fieldPath,e.endAt):ea(e,i.fieldPath,e.endAt);n.push(t.value),r&&(r=t.inclusive)}return new ha(n,r)}(s,i),h=this.We(i,s,u),d=this.We(i,s,l),f=this.ze(i,s,c),p=this.He(i.indexId,a,h,u.inclusive,d,l.inclusive,f);return qu.forEach(p,(i=>n.Gt(i,t.limit).next((t=>{t.forEach((t=>{const n=ao.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),r.push(n))}))}))))})).next((()=>r))}return qu.resolve(null)}))}Qe(e){let t=this.Ge.get(e);return t||(t=[e],this.Ge.set(e,t),t)}He(e,t,n,r,i,s,o){const a=(null!=t?t.length:1)*Math.max(n.length,i.length),c=a/(null!=t?t.length:1),u=[];for(let l=0;l<a;++l){const a=t?this.Je(t[l/c]):Rl,h=this.Ye(e,a,n[l%c],r),d=this.Xe(e,a,i[l%c],s),f=o.map((t=>this.Ye(e,a,t,!0)));u.push(...this.createRange(h,d,f))}return u}Ye(e,t,n,r){const i=new Sl(e,ao.empty(),t,n);return r?i:i.ke()}Xe(e,t,n,r){const i=new Sl(e,ao.empty(),t,n);return r?i.ke():i}je(e,t){const n=new Nl(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((e=>{let t=null;for(const r of e)n.$e(r)&&(!t||r.fields.length>t.fields.length)&&(t=r);return t}))}getIndexType(e,t){let n=2;return qu.forEach(this.Qe(t),(t=>this.je(e,t).next((e=>{e?0!==n&&e.fields.length<function(e){let t=new Go(zs.comparator),n=!1;for(const r of e.filters){const e=r;e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?n=!0:t=t.add(e.field))}for(const n of e.orderBy)n.field.isKeyField()||(t=t.add(n.field));return t.size+(n?1:0)}(t)&&(n=1):n=0})))).next((()=>n))}Ze(e,t){const n=new El;for(const r of Lo(e)){const e=t.data.field(r.fieldPath);if(null==e)return null;const i=n.Ne(r.kind);vl.fe.Zt(e,i)}return n.Se()}Je(e){const t=new El;return vl.fe.Zt(e,t.Ne(0)),t.Se()}tn(e,t){const n=new El;return vl.fe.Zt(vo(this.databaseId,t),n.Ne(function(e){const t=Lo(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.Se()}ze(e,t,n){if(null===n)return[];let r=[];r.push(new El);let i=0;for(const s of Lo(e)){const e=n[i++];for(const n of r)if(this.en(t,s.fieldPath)&&bo(e))r=this.nn(r,s,e);else{const t=n.Ne(s.kind);vl.fe.Zt(e,t)}}return this.sn(r)}We(e,t,n){return this.ze(e,t,n.position)}sn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].Se();return t}nn(e,t,n){const r=[...e],i=[];for(const e of n.arrayValue.values||[])for(const n of r){const r=new El;r.seed(n.Se()),vl.fe.Zt(e,r.Ne(t.kind)),i.push(r)}return i}en(e,t){return!!e.filters.find((e=>e instanceof na&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)))}getFieldIndexes(e,t){const n=Ll(e),r=Ml(e);return(t?n.qt("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.qt()).next((e=>{const t=[];return qu.forEach(e,(e=>r.get([e.indexId,this.uid]).next((n=>{t.push(function(e,t){const n=t?new Fo(t.sequenceNumber,new qo(ol(t.readTime),new ao(mu(t.documentKey)),t.largestBatchId)):Fo.empty(),r=e.fields.map((([e,t])=>new Mo(zs.fromServerFormat(e),t)));return new Po(e.indexId,e.collectionGroup,r,n)}(e,n))})))).next((()=>t))}))}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next((e=>0===e.length?null:(e.sort(((e,t)=>{const n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:Ls(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)))}updateCollectionGroup(e,t,n){const r=Ll(e),i=Ml(e);return this.rn(e).next((e=>r.qt("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((t=>qu.forEach(t,(t=>i.put(function(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:sl(r.readTime),documentKey:du(r.documentKey.path),largestBatchId:r.largestBatchId}}(t.indexId,this.user,e,n))))))))}updateIndexEntries(e,t){const n=new Map;return qu.forEach(t,((t,r)=>{const i=n.get(t.collectionGroup);return(i?qu.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next((i=>(n.set(t.collectionGroup,i),qu.forEach(i,(n=>this.on(e,t,n).next((t=>{const i=this.un(r,n);return t.isEqual(i)?qu.resolve():this.an(e,r,n,t,i)})))))))}))}cn(e,t,n,r){return Ol(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.tn(n,t.key),documentKey:t.key.path.toArray()})}hn(e,t,n,r){return Ol(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.tn(n,t.key),t.key.path.toArray()])}on(e,t,n){const r=Ol(e);let i=new Go(kl);return r.Wt({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.tn(n,t)])},((e,r)=>{i=i.add(new Sl(n.indexId,t,r.arrayValue,r.directionalValue))})).next((()=>i))}un(e,t){let n=new Go(kl);const r=this.Ze(t,e);if(null==r)return n;const i=Oo(t);if(null!=i){const s=e.data.field(i.fieldPath);if(bo(s))for(const i of s.arrayValue.values||[])n=n.add(new Sl(t.indexId,e.key,this.Je(i),r))}else n=n.add(new Sl(t.indexId,e.key,Rl,r));return n}an(e,t,n,r,i){ps("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const s=[];return function(e,t,n,r,i){const s=e.getIterator(),o=t.getIterator();let a=Wo(s),c=Wo(o);for(;a||c;){let e=!1,t=!1;if(a&&c){const r=n(a,c);r<0?t=!0:r>0&&(e=!0)}else null!=a?t=!0:e=!0;e?(r(c),c=Wo(o)):t?(i(a),a=Wo(s)):(a=Wo(s),c=Wo(o))}}(r,i,kl,(r=>{s.push(this.cn(e,t,n,r))}),(r=>{s.push(this.hn(e,t,n,r))})),qu.waitFor(s)}rn(e){let t=1;return Ml(e).Wt({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((e,n,r)=>{r.done(),t=n.sequenceNumber+1})).next((()=>t))}createRange(e,t,n){n=n.sort(((e,t)=>kl(e,t))).filter(((e,t,n)=>!t||0!==kl(e,n[t-1])));const r=[];r.push(e);for(const i of n){const n=kl(i,e),s=kl(i,t);if(0===n)r[0]=e.ke();else if(n>0&&s<0)r.push(i),r.push(i.ke());else if(s>0)break}r.push(t);const i=[];for(let e=0;e<r.length;e+=2)i.push(IDBKeyRange.bound([r[e].indexId,this.uid,r[e].arrayValue,r[e].directionalValue,Rl,[]],[r[e+1].indexId,this.uid,r[e+1].arrayValue,r[e+1].directionalValue,Rl,[]]));return i}getMinOffset(e,t){let n;return qu.forEach(this.Qe(t),(t=>this.je(e,t).next((e=>{e?(!n||Bo(e.indexState.offset,n)<0)&&(n=e.indexState.offset):n=qo.min()})))).next((()=>n))}}function Pl(e){return Ju(e,"collectionParents")}function Ol(e){return Ju(e,"indexEntries")}function Ll(e){return Ju(e,"indexConfiguration")}function Ml(e){return Ju(e,"indexState")}const Fl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Vl{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new Vl(e,Vl.DEFAULT_COLLECTION_PERCENTILE,Vl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Ul(e,t,n){const r=e.store("mutations"),i=e.store("documentMutations"),s=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=r.Wt({range:o},((e,t,n)=>(a++,n.delete())));s.push(c.next((()=>{ws(1===a)})));const u=[];for(const e of n.mutations){const r=vu(t,e.key.path,n.batchId);s.push(i.delete(r)),u.push(e.key)}return qu.waitFor(s).next((()=>u))}function ql(e){if(!e)return 0;let t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw vs();t=e.noDocument}return JSON.stringify(t).length}Vl.DEFAULT_COLLECTION_PERCENTILE=10,Vl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Vl.DEFAULT=new Vl(41943040,Vl.DEFAULT_COLLECTION_PERCENTILE,Vl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Vl.DISABLED=new Vl(-1,0,0);class Bl{constructor(e,t,n,r){this.userId=e,this.M=t,this.indexManager=n,this.referenceDelegate=r,this.ln={}}static Yt(e,t,n,r){ws(""!==e.uid);const i=e.isAuthenticated()?e.uid:"";return new Bl(i,t,n,r)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Kl(e).Wt({index:"userMutationsIndex",range:n},((e,n,r)=>{t=!1,r.done()})).next((()=>t))}addMutationBatch(e,t,n,r){const i=$l(e),s=Kl(e);return s.add({}).next((o=>{ws("number"==typeof o);const a=new Xu(o,t,n,r),c=function(e,t,n){const r=n.baseMutations.map((t=>Xc(e.Jt,t))),i=n.mutations.map((t=>Xc(e.Jt,t)));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:i}}(this.M,this.userId,a),u=[];let l=new Go(((e,t)=>Ls(e.canonicalString(),t.canonicalString())));for(const e of r){const t=vu(this.userId,e.key.path,o);l=l.add(e.key.path.popLast()),u.push(s.put(c)),u.push(i.put(t,wu))}return l.forEach((t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((()=>{this.ln[o]=a.keys()})),qu.waitFor(u).next((()=>a))}))}lookupMutationBatch(e,t){return Kl(e).get(t).next((e=>e?(ws(e.userId===this.userId),al(this.M,e)):null))}fn(e,t){return this.ln[t]?qu.resolve(this.ln[t]):this.lookupMutationBatch(e,t).next((e=>{if(e){const n=e.keys();return this.ln[t]=n,n}return null}))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return Kl(e).Wt({index:"userMutationsIndex",range:r},((e,t,r)=>{t.userId===this.userId&&(ws(t.batchId>=n),i=al(this.M,t)),r.done()})).next((()=>i))}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Kl(e).Wt({index:"userMutationsIndex",range:t,reverse:!0},((e,t,r)=>{n=t.batchId,r.done()})).next((()=>n))}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Kl(e).qt("userMutationsIndex",t).next((e=>e.map((e=>al(this.M,e)))))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=yu(this.userId,t.path),r=IDBKeyRange.lowerBound(n),i=[];return $l(e).Wt({range:r},((n,r,s)=>{const[o,a,c]=n,u=mu(a);if(o===this.userId&&t.path.isEqual(u))return Kl(e).get(c).next((e=>{if(!e)throw vs();ws(e.userId===this.userId),i.push(al(this.M,e))}));s.done()})).next((()=>i))}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Go(Ls);const r=[];return t.forEach((t=>{const i=yu(this.userId,t.path),s=IDBKeyRange.lowerBound(i),o=$l(e).Wt({range:s},((e,r,i)=>{const[s,o,a]=e,c=mu(o);s===this.userId&&t.path.isEqual(c)?n=n.add(a):i.done()}));r.push(o)})),qu.waitFor(r).next((()=>this.dn(e,n)))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1,i=yu(this.userId,n),s=IDBKeyRange.lowerBound(i);let o=new Go(Ls);return $l(e).Wt({range:s},((e,t,i)=>{const[s,a,c]=e,u=mu(a);s===this.userId&&n.isPrefixOf(u)?u.length===r&&(o=o.add(c)):i.done()})).next((()=>this.dn(e,o)))}dn(e,t){const n=[],r=[];return t.forEach((t=>{r.push(Kl(e).get(t).next((e=>{if(null===e)throw vs();ws(e.userId===this.userId),n.push(al(this.M,e))})))})),qu.waitFor(r).next((()=>n))}removeMutationBatch(e,t){return Ul(e.Ht,this.userId,t).next((n=>(e.addOnCommittedListener((()=>{this._n(t.batchId)})),qu.forEach(n,(t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))))}_n(e){delete this.ln[e]}performConsistencyCheck(e){return this.checkEmpty(e).next((t=>{if(!t)return qu.resolve();const n=IDBKeyRange.lowerBound([this.userId]),r=[];return $l(e).Wt({range:n},((e,t,n)=>{if(e[0]===this.userId){const t=mu(e[1]);r.push(t)}else n.done()})).next((()=>{ws(0===r.length)}))}))}containsKey(e,t){return jl(e,this.userId,t)}wn(e){return Gl(e).get(this.userId).next((e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}))}}function jl(e,t,n){const r=yu(t,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return $l(e).Wt({range:s,jt:!0},((e,n,r)=>{const[s,a,c]=e;s===t&&a===i&&(o=!0),r.done()})).next((()=>o))}function Kl(e){return Ju(e,"mutations")}function $l(e){return Ju(e,"documentMutations")}function Gl(e){return Ju(e,"mutationQueues")}class zl{constructor(e){this.mn=e}next(){return this.mn+=2,this.mn}static gn(){return new zl(0)}static yn(){return new zl(-1)}}class Wl{constructor(e,t){this.referenceDelegate=e,this.M=t}allocateTargetId(e){return this.pn(e).next((t=>{const n=new zl(t.highestTargetId);return t.highestTargetId=n.next(),this.In(e,t).next((()=>t.highestTargetId))}))}getLastRemoteSnapshotVersion(e){return this.pn(e).next((e=>Us.fromTimestamp(new Vs(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(e){return this.pn(e).next((e=>e.highestListenSequenceNumber))}setTargetsMetadata(e,t,n){return this.pn(e).next((r=>(r.highestListenSequenceNumber=t,n&&(r.lastRemoteSnapshotVersion=n.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.In(e,r))))}addTargetData(e,t){return this.Tn(e,t).next((()=>this.pn(e).next((n=>(n.targetCount+=1,this.En(t,n),this.In(e,n))))))}updateTargetData(e,t){return this.Tn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next((()=>Hl(e).delete(t.targetId))).next((()=>this.pn(e))).next((t=>(ws(t.targetCount>0),t.targetCount-=1,this.In(e,t))))}removeTargets(e,t,n){let r=0;const i=[];return Hl(e).Wt(((s,o)=>{const a=cl(o);a.sequenceNumber<=t&&null===n.get(a.targetId)&&(r++,i.push(this.removeTargetData(e,a)))})).next((()=>qu.waitFor(i))).next((()=>r))}forEachTarget(e,t){return Hl(e).Wt(((e,n)=>{const r=cl(n);t(r)}))}pn(e){return Ql(e).get("targetGlobalKey").next((e=>(ws(null!==e),e)))}In(e,t){return Ql(e).put("targetGlobalKey",t)}Tn(e,t){return Hl(e).put(ul(this.M,t))}En(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.pn(e).next((e=>e.targetCount))}getTargetData(e,t){const n=Yo(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return Hl(e).Wt({range:r,index:"queryTargetsIndex"},((e,n,r)=>{const s=cl(n);Jo(t,s.target)&&(i=s,r.done())})).next((()=>i))}addMatchingKeys(e,t,n){const r=[],i=Yl(e);return t.forEach((t=>{const s=du(t.path);r.push(i.put({targetId:n,path:s})),r.push(this.referenceDelegate.addReference(e,n,t))})),qu.waitFor(r)}removeMatchingKeys(e,t,n){const r=Yl(e);return qu.forEach(t,(t=>{const i=du(t.path);return qu.waitFor([r.delete([n,i]),this.referenceDelegate.removeReference(e,n,t)])}))}removeMatchingKeysForTargetId(e,t){const n=Yl(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Yl(e);let i=Tc();return r.Wt({range:n,jt:!0},((e,t,n)=>{const r=mu(e[1]),s=new ao(r);i=i.add(s)})).next((()=>i))}containsKey(e,t){const n=du(t.path),r=IDBKeyRange.bound([n],[Fs(n)],!1,!0);let i=0;return Yl(e).Wt({index:"documentTargetsIndex",jt:!0,range:r},(([e,t],n,r)=>{0!==e&&(i++,r.done())})).next((()=>i>0))}Et(e,t){return Hl(e).get(t).next((e=>e?cl(e):null))}}function Hl(e){return Ju(e,"targets")}function Ql(e){return Ju(e,"targetGlobal")}function Yl(e){return Ju(e,"targetDocuments")}async function Jl(e){if(e.code!==Is.FAILED_PRECONDITION||e.message!==Vu)throw e;ps("LocalStore","Unexpectedly lost primary lease")}function Xl([e,t],[n,r]){const i=Ls(e,n);return 0===i?Ls(t,r):i}class Zl{constructor(e){this.An=e,this.buffer=new Go(Xl),this.Rn=0}bn(){return++this.Rn}Pn(e){const t=[e,this.bn()];if(this.buffer.size<this.An)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Xl(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class eh{constructor(e,t){this.garbageCollector=e,this.asyncQueue=t,this.Vn=!1,this.vn=null}start(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Sn(e)}stop(){this.vn&&(this.vn.cancel(),this.vn=null)}get started(){return null!==this.vn}Sn(e){const t=this.Vn?3e5:6e4;ps("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.vn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.vn=null,this.Vn=!0;try{await e.collectGarbage(this.garbageCollector)}catch(e){Gu(e)?ps("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):await Jl(e)}await this.Sn(e)}))}}class th{constructor(e,t){this.Dn=e,this.params=t}calculateTargetCount(e,t){return this.Dn.Cn(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return qu.resolve(xs.A);const n=new Zl(t);return this.Dn.forEachTarget(e,(e=>n.Pn(e.sequenceNumber))).next((()=>this.Dn.xn(e,(e=>n.Pn(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.Dn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Dn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(ps("LruGarbageCollector","Garbage collection skipped; disabled"),qu.resolve(Fl)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(ps("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Fl):this.Nn(e,t)))}getCacheSize(e){return this.Dn.getCacheSize(e)}Nn(e,t){let n,r,i,s,o,a,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(ps("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r)))).next((r=>(n=r,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(c=Date.now(),fs()<=J.DEBUG&&ps("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-u}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),qu.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e}))))}}class nh{constructor(e,t){this.db=e,this.garbageCollector=function(e,t){return new th(e,t)}(this,t)}Cn(e){const t=this.kn(e);return this.db.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}kn(e){let t=0;return this.xn(e,(e=>{t++})).next((()=>t))}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}xn(e,t){return this.Mn(e,((e,n)=>t(n)))}addReference(e,t,n){return rh(e,n)}removeReference(e,t,n){return rh(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return rh(e,t)}On(e,t){return function(e,t){let n=!1;return Gl(e).zt((r=>jl(e,r,t).next((e=>(e&&(n=!0),qu.resolve(!e)))))).next((()=>n))}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let i=0;return this.Mn(e,((s,o)=>{if(o<=t){const t=this.On(e,s).next((t=>{if(!t)return i++,n.getEntry(e,s).next((()=>(n.removeEntry(s,Us.min()),Yl(e).delete([0,du(s.path)]))))}));r.push(t)}})).next((()=>qu.waitFor(r))).next((()=>n.apply(e))).next((()=>i))}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return rh(e,t)}Mn(e,t){const n=Yl(e);let r,i=xs.A;return n.Wt({index:"documentTargetsIndex"},(([e,n],{path:s,sequenceNumber:o})=>{0===e?(i!==xs.A&&t(new ao(mu(r)),i),i=o,r=s):i=xs.A})).next((()=>{i!==xs.A&&t(new ao(mu(r)),i)}))}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function rh(e,t){return Yl(e).put(function(e,t){return{targetId:0,path:du(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}class ih{constructor(){this.changes=new mc((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,xo.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?qu.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class sh{constructor(e){this.M=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return ch(e).put(n)}removeEntry(e,t,n){return ch(e).delete(function(e,t){const n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],il(t),n[n.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next((n=>(n.byteSize+=t,this.Fn(e,n))))}getEntry(e,t){let n=xo.newInvalidDocument(t);return ch(e).Wt({index:"documentKeyIndex",range:IDBKeyRange.only(uh(t))},((e,r)=>{n=this.$n(t,r)})).next((()=>n))}Bn(e,t){let n={size:0,document:xo.newInvalidDocument(t)};return ch(e).Wt({index:"documentKeyIndex",range:IDBKeyRange.only(uh(t))},((e,r)=>{n={document:this.$n(t,r),size:ql(r)}})).next((()=>n))}getEntries(e,t){let n=yc();return this.Ln(e,t,((e,t)=>{const r=this.$n(e,t);n=n.insert(e,r)})).next((()=>n))}Un(e,t){let n=yc(),r=new jo(ao.comparator);return this.Ln(e,t,((e,t)=>{const i=this.$n(e,t);n=n.insert(e,i),r=r.insert(e,ql(t))})).next((()=>({documents:n,qn:r})))}Ln(e,t,n){if(t.isEmpty())return qu.resolve();let r=new Go(hh);t.forEach((e=>r=r.add(e)));const i=IDBKeyRange.bound(uh(r.first()),uh(r.last())),s=r.getIterator();let o=s.getNext();return ch(e).Wt({index:"documentKeyIndex",range:i},((e,t,r)=>{const i=ao.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;o&&hh(o,i)<0;)n(o,null),o=s.getNext();o&&o.isEqual(i)&&(n(o,t),o=s.hasNext()?s.getNext():null),o?r.Ut(uh(o)):r.done()})).next((()=>{for(;o;)n(o,null),o=s.hasNext()?s.getNext():null}))}getAllFromCollection(e,t,n){const r=[t.popLast().toArray(),t.lastSegment(),il(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],i=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ch(e).qt(IDBKeyRange.bound(r,i,!0)).next((e=>{let t=yc();for(const n of e){const e=this.$n(ao.fromSegments(n.prefixPath.concat(n.collectionGroup,n.documentId)),n);t=t.insert(e.key,e)}return t}))}getAllFromCollectionGroup(e,t,n,r){let i=yc();const s=lh(t,n),o=lh(t,qo.max());return ch(e).Wt({index:"collectionGroupIndex",range:IDBKeyRange.bound(s,o,!0)},((e,t,n)=>{const s=this.$n(ao.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);i=i.insert(s.key,s),i.size===r&&n.done()})).next((()=>i))}newChangeBuffer(e){return new oh(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next((e=>e.byteSize))}getMetadata(e){return ah(e).get("remoteDocumentGlobalKey").next((e=>(ws(!!e),e)))}Fn(e,t){return ah(e).put("remoteDocumentGlobalKey",t)}$n(e,t){if(t){const e=function(e,t){let n;if(t.document)n=Jc(e.Jt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){const e=ao.fromSegments(t.noDocument.path),r=ol(t.noDocument.readTime);n=xo.newNoDocument(e,r),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return vs();{const e=ao.fromSegments(t.unknownDocument.path),r=ol(t.unknownDocument.version);n=xo.newUnknownDocument(e,r)}}return t.readTime&&n.setReadTime(function(e){const t=new Vs(e[0],e[1]);return Us.fromTimestamp(t)}(t.readTime)),n}(this.M,t);if(!e.isNoDocument()||!e.version.isEqual(Us.min()))return e}return xo.newInvalidDocument(e)}}class oh extends ih{constructor(e,t){super(),this.Kn=e,this.trackRemovals=t,this.Gn=new mc((e=>e.toString()),((e,t)=>e.isEqual(t)))}applyChanges(e){const t=[];let n=0,r=new Go(((e,t)=>Ls(e.canonicalString(),t.canonicalString())));return this.changes.forEach(((i,s)=>{const o=this.Gn.get(i);if(t.push(this.Kn.removeEntry(e,i,o.readTime)),s.isValidDocument()){const a=rl(this.Kn.M,s);r=r.add(i.path.popLast());const c=ql(a);n+=c-o.size,t.push(this.Kn.addEntry(e,i,a))}else if(n-=o.size,this.trackRemovals){const n=rl(this.Kn.M,s.convertToNoDocument(Us.min()));t.push(this.Kn.addEntry(e,i,n))}})),r.forEach((n=>{t.push(this.Kn.indexManager.addToCollectionParentIndex(e,n))})),t.push(this.Kn.updateMetadata(e,n)),qu.waitFor(t)}getFromCache(e,t){return this.Kn.Bn(e,t).next((e=>(this.Gn.set(t,{size:e.size,readTime:e.document.readTime}),e.document)))}getAllFromCache(e,t){return this.Kn.Un(e,t).next((({documents:e,qn:t})=>(t.forEach(((t,n)=>{this.Gn.set(t,{size:n,readTime:e.get(t).readTime})})),e)))}}function ah(e){return Ju(e,"remoteDocumentGlobal")}function ch(e){return Ju(e,"remoteDocumentsV14")}function uh(e){const t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function lh(e,t){const n=t.documentKey.path.toArray();return[e,il(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function hh(e,t){const n=e.path.toArray(),r=t.path.toArray();let i=0;for(let e=0;e<n.length-2&&e<r.length-2;++e)if(i=Ls(n[e],r[e]),i)return i;return i=Ls(n.length,r.length),i||(i=Ls(n[n.length-2],r[r.length-2]),i||Ls(n[n.length-1],r[r.length-1]))}class dh{constructor(e){this.M=e}kt(e,t,n,r){const i=new Bu("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",gu,{unique:!0}),e.createObjectStore("documentMutations")}(e),fh(e),function(e){e.createObjectStore("remoteDocuments")}(e));let s=qu.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),fh(e)),s=s.next((()=>function(e){const t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Us.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i)))),n<4&&r>=4&&(0!==n&&(s=s.next((()=>function(e,t){return t.store("mutations").qt().next((n=>{e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",gu,{unique:!0});const r=t.store("mutations"),i=n.map((e=>r.put(e)));return qu.waitFor(i)}))}(e,i)))),s=s.next((()=>{!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(s=s.next((()=>this.Qn(i)))),n<6&&r>=6&&(s=s.next((()=>(function(e){e.createObjectStore("remoteDocumentGlobal")}(e),this.jn(i))))),n<7&&r>=7&&(s=s.next((()=>this.Wn(i)))),n<8&&r>=8&&(s=s.next((()=>this.zn(e,i)))),n<9&&r>=9&&(s=s.next((()=>{!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(s=s.next((()=>this.Hn(i)))),n<11&&r>=11&&(s=s.next((()=>{!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&r>=12&&(s=s.next((()=>{!function(e){const t=e.createObjectStore("documentOverlays",{keyPath:Ru});t.createIndex("collectionPathOverlayIndex",xu,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",Pu,{unique:!1})}(e)}))),n<13&&r>=13&&(s=s.next((()=>function(e){const t=e.createObjectStore("remoteDocumentsV14",{keyPath:bu});t.createIndex("documentKeyIndex",Iu),t.createIndex("collectionGroupIndex",_u)}(e))).next((()=>this.Jn(e,i))).next((()=>e.deleteObjectStore("remoteDocuments")))),n<14&&r>=14&&(s=s.next((()=>{!function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:Au}).createIndex("sequenceNumberIndex",Nu,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:Cu}).createIndex("documentKeyIndex",Du,{unique:!1})}(e)}))),s}jn(e){let t=0;return e.store("remoteDocuments").Wt(((e,n)=>{t+=ql(n)})).next((()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}Qn(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.qt().next((t=>qu.forEach(t,(t=>{const r=IDBKeyRange.bound([t.userId,-1],[t.userId,t.lastAcknowledgedBatchId]);return n.qt("userMutationsIndex",r).next((n=>qu.forEach(n,(n=>{ws(n.userId===t.userId);const r=al(this.M,n);return Ul(e,t.userId,r).next((()=>{}))}))))}))))}Wn(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((e=>{const r=[];return n.Wt(((n,i)=>{const s=new $s(n),o=function(e){return[0,du(e)]}(s);r.push(t.get(o).next((n=>n?qu.resolve():(n=>t.put({targetId:0,path:du(n),sequenceNumber:e.highestListenSequenceNumber}))(s))))})).next((()=>qu.waitFor(r)))}))}zn(e,t){e.createObjectStore("collectionParents",{keyPath:ku});const n=t.store("collectionParents"),r=new Dl,i=e=>{if(r.add(e)){const t=e.lastSegment(),r=e.popLast();return n.put({collectionId:t,parent:du(r)})}};return t.store("remoteDocuments").Wt({jt:!0},((e,t)=>{const n=new $s(e);return i(n.popLast())})).next((()=>t.store("documentMutations").Wt({jt:!0},(([e,t,n],r)=>{const s=mu(t);return i(s.popLast())}))))}Hn(e){const t=e.store("targets");return t.Wt(((e,n)=>{const r=cl(n),i=ul(this.M,r);return t.put(i)}))}Jn(e,t){const n=t.store("remoteDocuments"),r=[];return n.Wt(((e,n)=>{const i=t.store("remoteDocumentsV14"),s=(o=n,o.document?new ao($s.fromString(o.document.name).popFirst(5)):o.noDocument?ao.fromSegments(o.noDocument.path):o.unknownDocument?ao.fromSegments(o.unknownDocument.path):vs()).path.toArray();var o;const a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(a))})).next((()=>qu.waitFor(r)))}}function fh(e){e.createObjectStore("targetDocuments",{keyPath:Eu}).createIndex("documentTargetsIndex",Su,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Tu,{unique:!0}),e.createObjectStore("targetGlobal")}const ph="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class mh{constructor(e,t,n,r,i,s,o,a,c,u,l=13){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Yn=i,this.window=s,this.document=o,this.Xn=c,this.Zn=u,this.ts=l,this.es=null,this.ns=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ss=null,this.inForeground=!1,this.rs=null,this.os=null,this.us=Number.NEGATIVE_INFINITY,this.cs=e=>Promise.resolve(),!mh.vt())throw new _s(Is.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new nh(this,r),this.hs=t+"main",this.M=new nl(a),this.ls=new ju(this.hs,this.ts,new dh(this.M)),this.fs=new Wl(this.referenceDelegate,this.M),this.ds=function(e){return new sh(e)}(this.M),this._s=new fl,this.window&&this.window.localStorage?this.ws=this.window.localStorage:(this.ws=null,!1===u&&ms("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.gs().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new _s(Is.FAILED_PRECONDITION,ph);return this.ys(),this.ps(),this.Is(),this.runTransaction("getHighestListenSequenceNumber","readonly",(e=>this.fs.getHighestSequenceNumber(e)))})).then((e=>{this.es=new xs(e,this.Xn)})).then((()=>{this.ns=!0})).catch((e=>(this.ls&&this.ls.close(),Promise.reject(e))))}Ts(e){return this.cs=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.ls.Ot((async t=>{null===t.newVersion&&await e()}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Yn.enqueueAndForget((async()=>{this.started&&await this.gs()})))}gs(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(e=>yh(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next((()=>{if(this.isPrimary)return this.Es(e).next((e=>{e||(this.isPrimary=!1,this.Yn.enqueueRetryable((()=>this.cs(!1))))}))})).next((()=>this.As(e))).next((t=>this.isPrimary&&!t?this.Rs(e).next((()=>!1)):!!t&&this.bs(e).next((()=>!0)))))).catch((e=>{if(Gu(e))return ps("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ps("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1})).then((e=>{this.isPrimary!==e&&this.Yn.enqueueRetryable((()=>this.cs(e))),this.isPrimary=e}))}Es(e){return gh(e).get("owner").next((e=>qu.resolve(this.Ps(e))))}Vs(e){return yh(e).delete(this.clientId)}async vs(){if(this.isPrimary&&!this.Ss(this.us,18e5)){this.us=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(e=>{const t=Ju(e,"clientMetadata");return t.qt().next((e=>{const n=this.Ds(e,18e5),r=e.filter((e=>-1===n.indexOf(e)));return qu.forEach(r,(e=>t.delete(e.clientId))).next((()=>r))}))})).catch((()=>[]));if(this.ws)for(const t of e)this.ws.removeItem(this.Cs(t.clientId))}}Is(){this.os=this.Yn.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.gs().then((()=>this.vs())).then((()=>this.Is()))))}Ps(e){return!!e&&e.ownerId===this.clientId}As(e){return this.Zn?qu.resolve(!0):gh(e).get("owner").next((t=>{if(null!==t&&this.Ss(t.leaseTimestampMs,5e3)&&!this.xs(t.ownerId)){if(this.Ps(t)&&this.networkEnabled)return!0;if(!this.Ps(t)){if(!t.allowTabSynchronization)throw new _s(Is.FAILED_PRECONDITION,ph);return!1}}return!(!this.networkEnabled||!this.inForeground)||yh(e).qt().next((e=>void 0===this.Ds(e,5e3).find((e=>{if(this.clientId!==e.clientId){const t=!this.networkEnabled&&e.networkEnabled,n=!this.inForeground&&e.inForeground,r=this.networkEnabled===e.networkEnabled;if(t||n&&r)return!0}return!1}))))})).next((e=>(this.isPrimary!==e&&ps("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e)))}async shutdown(){this.ns=!1,this.Ns(),this.os&&(this.os.cancel(),this.os=null),this.ks(),this.Ms(),await this.ls.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(e=>{const t=new Yu(e,xs.A);return this.Rs(t).next((()=>this.Vs(t)))})),this.ls.close(),this.Os()}Ds(e,t){return e.filter((e=>this.Ss(e.updateTimeMs,t)&&!this.xs(e.clientId)))}Fs(){return this.runTransaction("getActiveClients","readonly",(e=>yh(e).qt().next((e=>this.Ds(e,18e5).map((e=>e.clientId))))))}get started(){return this.ns}getMutationQueue(e,t){return Bl.Yt(e,this.M,t,this.referenceDelegate)}getTargetCache(){return this.fs}getRemoteDocumentCache(){return this.ds}getIndexManager(e){return new xl(e,this.M.Jt.databaseId)}getDocumentOverlayCache(e){return gl.Yt(this.M,e)}getBundleCache(){return this._s}runTransaction(e,t,n){ps("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",i=14===(s=this.ts)?Fu:13===s?Mu:12===s?Lu:11===s?Ou:void vs();var s;let o;return this.ls.runTransaction(e,r,i,(r=>(o=new Yu(r,this.es?this.es.next():xs.A),"readwrite-primary"===t?this.Es(o).next((e=>!!e||this.As(o))).next((t=>{if(!t)throw ms(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Yn.enqueueRetryable((()=>this.cs(!1))),new _s(Is.FAILED_PRECONDITION,Vu);return n(o)})).next((e=>this.bs(o).next((()=>e)))):this.$s(o).next((()=>n(o)))))).then((e=>(o.raiseOnCommittedEvent(),e)))}$s(e){return gh(e).get("owner").next((e=>{if(null!==e&&this.Ss(e.leaseTimestampMs,5e3)&&!this.xs(e.ownerId)&&!this.Ps(e)&&!(this.Zn||this.allowTabSynchronization&&e.allowTabSynchronization))throw new _s(Is.FAILED_PRECONDITION,ph)}))}bs(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return gh(e).put("owner",t)}static vt(){return ju.vt()}Rs(e){const t=gh(e);return t.get("owner").next((e=>this.Ps(e)?(ps("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):qu.resolve()))}Ss(e,t){const n=Date.now();return!(e<n-t||e>n&&(ms(`Detected an update time that is in the future: ${e} > ${n}`),1))}ys(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.rs=()=>{this.Yn.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.gs())))},this.document.addEventListener("visibilitychange",this.rs),this.inForeground="visible"===this.document.visibilityState)}ks(){this.rs&&(this.document.removeEventListener("visibilitychange",this.rs),this.rs=null)}ps(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.ss=()=>{this.Ns(),!N()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")&&navigator.appVersion.match(/Version\/1[45]/)&&this.Yn.enterRestrictedMode(!0),this.Yn.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.ss))}Ms(){this.ss&&(this.window.removeEventListener("pagehide",this.ss),this.ss=null)}xs(e){var t;try{const n=null!==(null===(t=this.ws)||void 0===t?void 0:t.getItem(this.Cs(e)));return ps("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(e){return ms("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}Ns(){if(this.ws)try{this.ws.setItem(this.Cs(this.clientId),String(Date.now()))}catch(e){ms("Failed to set zombie client id.",e)}}Os(){if(this.ws)try{this.ws.removeItem(this.Cs(this.clientId))}catch(e){}}Cs(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function gh(e){return Ju(e,"owner")}function yh(e){return Ju(e,"clientMetadata")}function vh(e,t){let n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}class wh{constructor(e,t,n){this.ds=e,this.Bs=t,this.indexManager=n}Ls(e,t){return this.Bs.getAllMutationBatchesAffectingDocumentKey(e,t).next((n=>this.Us(e,t,n)))}Us(e,t,n){return this.ds.getEntry(e,t).next((e=>{for(const t of n)t.applyToLocalView(e);return e}))}qs(e,t){e.forEach(((e,n)=>{for(const e of t)e.applyToLocalView(n)}))}Ks(e,t){return this.ds.getEntries(e,t).next((t=>this.Gs(e,t).next((()=>t))))}Gs(e,t){return this.Bs.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>this.qs(t,e)))}Qs(e,t,n){return function(e){return ao.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.js(e,t.path):Ia(t)?this.Ws(e,t,n):this.zs(e,t,n)}js(e,t){return this.Ls(e,new ao(t)).next((e=>{let t=wc();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}Ws(e,t,n){const r=t.collectionGroup;let i=wc();return this.indexManager.getCollectionParents(e,r).next((s=>qu.forEach(s,(s=>{const o=function(e,t){return new ga(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,s.child(r));return this.zs(e,o,n).next((e=>{e.forEach(((e,t)=>{i=i.insert(e,t)}))}))})).next((()=>i))))}zs(e,t,n){let r;return this.ds.getAllFromCollection(e,t.path,n).next((n=>(r=n,this.Bs.getAllMutationBatchesAffectingQuery(e,t)))).next((e=>{for(const t of e)for(const e of t.mutations){const n=e.key;let i=r.get(n);null==i&&(i=xo.newInvalidDocument(n),r=r.insert(n,i)),Za(e,i,t.localWriteTime),i.isFoundDocument()||(r=r.remove(n))}})).next((()=>(r.forEach(((e,n)=>{Na(t,n)||(r=r.remove(e))})),r)))}}class bh{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Hs=n,this.Js=r}static Ys(e,t){let n=Tc(),r=Tc();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new bh(e,t.fromCache,n,r)}}class Ih{constructor(){this.Xs=!1}initialize(e,t){this.Zs=e,this.indexManager=t,this.Xs=!0}Qs(e,t,n,r){return this.ti(e,t).next((i=>i||this.ei(e,t,r,n))).next((n=>n||this.ni(e,t)))}ti(e,t){return qu.resolve(null)}ei(e,t,n,r){return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||r.isEqual(Us.min())?this.ni(e,t):this.Zs.Ks(e,n).next((i=>{const s=this.si(t,i);return this.ii(t,s,n,r)?this.ni(e,t):(fs()<=J.DEBUG&&ps("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Aa(t)),this.ri(e,s,t,Vo(r,-1)))}))}si(e,t){let n=new Go(Da(e));return t.forEach(((t,r)=>{Na(e,r)&&(n=n.add(r))})),n}ii(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}ni(e,t){return fs()<=J.DEBUG&&ps("QueryEngine","Using full collection scan to execute query:",Aa(t)),this.Zs.Qs(e,t,qo.min())}ri(e,t,n,r){return this.Zs.Qs(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class _h{constructor(e,t,n,r){this.persistence=e,this.oi=t,this.M=r,this.ui=new jo(Ls),this.ai=new mc((e=>Yo(e)),Jo),this.ci=new Map,this.hi=e.getRemoteDocumentCache(),this.fs=e.getTargetCache(),this._s=e.getBundleCache(),this.li(n)}li(e){this.indexManager=this.persistence.getIndexManager(e),this.Bs=this.persistence.getMutationQueue(e,this.indexManager),this.fi=new wh(this.hi,this.Bs,this.indexManager),this.hi.setIndexManager(this.indexManager),this.oi.initialize(this.fi,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.ui)))}}function Th(e,t,n,r){return new _h(e,t,n,r)}async function Eh(e,t){const n=bs(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.Bs.getAllMutationBatches(e).next((i=>(r=i,n.li(t),n.Bs.getAllMutationBatches(e)))).next((t=>{const i=[],s=[];let o=Tc();for(const e of r){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.fi.Ks(e,o).next((e=>({di:e,removedBatchIds:i,addedBatchIds:s})))}))}))}function Sh(e){const t=bs(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.fs.getLastRemoteSnapshotVersion(e)))}function kh(e,t,n){let r=Tc();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=yc();return n.forEach(((n,i)=>{const s=e.get(n);i.isNoDocument()&&i.version.isEqual(Us.min())?(t.removeEntry(n,i.readTime),r=r.insert(n,i)):!s.isValidDocument()||i.version.compareTo(s.version)>0||0===i.version.compareTo(s.version)&&s.hasPendingWrites?(t.addEntry(i),r=r.insert(n,i)):ps("LocalStore","Ignoring outdated watch update for ",n,". Current version:",s.version," Watch version:",i.version)})),r}))}function Ah(e,t){const n=bs(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.Bs.getNextMutationBatchAfterBatchId(e,t))))}function Nh(e,t){const n=bs(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.fs.getTargetData(e,t).next((i=>i?(r=i,qu.resolve(r)):n.fs.allocateTargetId(e).next((i=>(r=new tl(t,i,0,e.currentSequenceNumber),n.fs.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.ui.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ui=n.ui.insert(e.targetId,e),n.ai.set(t,e.targetId)),e}))}async function Ch(e,t,n){const r=bs(e),i=r.ui.get(t),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(e=>r.persistence.referenceDelegate.removeTarget(e,i)))}catch(e){if(!Gu(e))throw e;ps("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.ui=r.ui.remove(t),r.ai.delete(i.target)}function Dh(e,t,n){const r=bs(e);let i=Us.min(),s=Tc();return r.persistence.runTransaction("Execute query","readonly",(e=>function(e,t,n){const r=bs(e),i=r.ai.get(n);return void 0!==i?qu.resolve(r.ui.get(i)):r.fs.getTargetData(t,n)}(r,e,Ta(t)).next((t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,r.fs.getMatchingKeysForTargetId(e,t.targetId).next((e=>{s=e}))})).next((()=>r.oi.Qs(e,t,n?i:Us.min(),n?s:Tc()))).next((e=>(Ph(r,Ca(t),e),{documents:e,_i:s})))))}function Rh(e,t){const n=bs(e),r=bs(n.fs),i=n.ui.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(e=>r.Et(e,t).next((e=>e?e.target:null))))}function xh(e,t){const n=bs(e),r=n.ci.get(t)||Us.min();return n.persistence.runTransaction("Get new document changes","readonly",(e=>n.hi.getAllFromCollectionGroup(e,t,Vo(r,-1),Number.MAX_SAFE_INTEGER))).then((e=>(Ph(n,t,e),e)))}function Ph(e,t,n){let r=Us.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.ci.set(t,r)}async function Oh(e,t,n=Tc()){const r=await Nh(e,Ta(ll(t.bundledQuery))),i=bs(e);return i.persistence.runTransaction("Save named query","readwrite",(e=>{const s=Bc(t.readTime);if(r.snapshotVersion.compareTo(s)>=0)return i._s.saveNamedQuery(e,t);const o=r.withResumeToken(Hs.EMPTY_BYTE_STRING,s);return i.ui=i.ui.insert(o.targetId,o),i.fs.updateTargetData(e,o).next((()=>i.fs.removeMatchingKeysForTargetId(e,r.targetId))).next((()=>i.fs.addMatchingKeys(e,n,r.targetId))).next((()=>i._s.saveNamedQuery(e,t)))}))}class Lh{constructor(e){this.M=e,this.yi=new Map,this.pi=new Map}getBundleMetadata(e,t){return qu.resolve(this.yi.get(t))}saveBundleMetadata(e,t){var n;return this.yi.set(t.id,{id:(n=t).id,version:n.version,createTime:Bc(n.createTime)}),qu.resolve()}getNamedQuery(e,t){return qu.resolve(this.pi.get(t))}saveNamedQuery(e,t){return this.pi.set(t.name,function(e){return{name:e.name,query:ll(e.bundledQuery),readTime:Bc(e.readTime)}}(t)),qu.resolve()}}class Mh{constructor(){this.overlays=new jo(ao.comparator),this.Ii=new Map}getOverlay(e,t){return qu.resolve(this.overlays.get(t))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.Xt(e,t,r)})),qu.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.Ii.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.Ii.delete(n)),qu.resolve()}getOverlaysForCollection(e,t,n){const r=bc(),i=t.length+1,s=new ao(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return qu.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new jo(((e,t)=>e-t));const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=bc(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=bc(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return qu.resolve(o)}Xt(e,t,n){if(null===n)return;const r=this.overlays.get(n.key);if(null!==r){const e=this.Ii.get(r.largestBatchId).delete(n.key);this.Ii.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new el(t,n));let i=this.Ii.get(t);void 0===i&&(i=Tc(),this.Ii.set(t,i)),this.Ii.set(t,i.add(n.key))}}class Fh{constructor(){this.Ti=new Go(Vh.Ei),this.Ai=new Go(Vh.Ri)}isEmpty(){return this.Ti.isEmpty()}addReference(e,t){const n=new Vh(e,t);this.Ti=this.Ti.add(n),this.Ai=this.Ai.add(n)}bi(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Pi(new Vh(e,t))}Vi(e,t){e.forEach((e=>this.removeReference(e,t)))}vi(e){const t=new ao(new $s([])),n=new Vh(t,e),r=new Vh(t,e+1),i=[];return this.Ai.forEachInRange([n,r],(e=>{this.Pi(e),i.push(e.key)})),i}Si(){this.Ti.forEach((e=>this.Pi(e)))}Pi(e){this.Ti=this.Ti.delete(e),this.Ai=this.Ai.delete(e)}Di(e){const t=new ao(new $s([])),n=new Vh(t,e),r=new Vh(t,e+1);let i=Tc();return this.Ai.forEachInRange([n,r],(e=>{i=i.add(e.key)})),i}containsKey(e){const t=new Vh(e,0),n=this.Ti.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Vh{constructor(e,t){this.key=e,this.Ci=t}static Ei(e,t){return ao.comparator(e.key,t.key)||Ls(e.Ci,t.Ci)}static Ri(e,t){return Ls(e.Ci,t.Ci)||ao.comparator(e.key,t.key)}}class Uh{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.Bs=[],this.xi=1,this.Ni=new Go(Vh.Ei)}checkEmpty(e){return qu.resolve(0===this.Bs.length)}addMutationBatch(e,t,n,r){const i=this.xi;this.xi++,this.Bs.length>0&&this.Bs[this.Bs.length-1];const s=new Xu(i,t,n,r);this.Bs.push(s);for(const t of r)this.Ni=this.Ni.add(new Vh(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return qu.resolve(s)}lookupMutationBatch(e,t){return qu.resolve(this.ki(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.Mi(n),i=r<0?0:r;return qu.resolve(this.Bs.length>i?this.Bs[i]:null)}getHighestUnacknowledgedBatchId(){return qu.resolve(0===this.Bs.length?-1:this.xi-1)}getAllMutationBatches(e){return qu.resolve(this.Bs.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Vh(t,0),r=new Vh(t,Number.POSITIVE_INFINITY),i=[];return this.Ni.forEachInRange([n,r],(e=>{const t=this.ki(e.Ci);i.push(t)})),qu.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Go(Ls);return t.forEach((e=>{const t=new Vh(e,0),r=new Vh(e,Number.POSITIVE_INFINITY);this.Ni.forEachInRange([t,r],(e=>{n=n.add(e.Ci)}))})),qu.resolve(this.Oi(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let i=n;ao.isDocumentKey(i)||(i=i.child(""));const s=new Vh(new ao(i),0);let o=new Go(Ls);return this.Ni.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.Ci)),!0)}),s),qu.resolve(this.Oi(o))}Oi(e){const t=[];return e.forEach((e=>{const n=this.ki(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){ws(0===this.Fi(t.batchId,"removed")),this.Bs.shift();let n=this.Ni;return qu.forEach(t.mutations,(r=>{const i=new Vh(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.Ni=n}))}_n(e){}containsKey(e,t){const n=new Vh(t,0),r=this.Ni.firstAfterOrEqual(n);return qu.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.Bs.length,qu.resolve()}Fi(e,t){return this.Mi(e)}Mi(e){return 0===this.Bs.length?0:e-this.Bs[0].batchId}ki(e){const t=this.Mi(e);return t<0||t>=this.Bs.length?null:this.Bs[t]}}class qh{constructor(e){this.$i=e,this.docs=new jo(ao.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.$i(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return qu.resolve(n?n.document.mutableCopy():xo.newInvalidDocument(t))}getEntries(e,t){let n=yc();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():xo.newInvalidDocument(e))})),qu.resolve(n)}getAllFromCollection(e,t,n){let r=yc();const i=new ao(t.child("")),s=this.docs.getIteratorFrom(i);for(;s.hasNext();){const{key:e,value:{document:i}}=s.getNext();if(!t.isPrefixOf(e.path))break;e.path.length>t.length+1||Bo(Uo(i),n)<=0||(r=r.insert(i.key,i.mutableCopy()))}return qu.resolve(r)}getAllFromCollectionGroup(e,t,n,r){vs()}Bi(e,t){return qu.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Bh(this)}getSize(e){return qu.resolve(this.size)}}class Bh extends ih{constructor(e){super(),this.Kn=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.Kn.addEntry(e,r)):this.Kn.removeEntry(n)})),qu.waitFor(t)}getFromCache(e,t){return this.Kn.getEntry(e,t)}getAllFromCache(e,t){return this.Kn.getEntries(e,t)}}class jh{constructor(e){this.persistence=e,this.Li=new mc((e=>Yo(e)),Jo),this.lastRemoteSnapshotVersion=Us.min(),this.highestTargetId=0,this.Ui=0,this.qi=new Fh,this.targetCount=0,this.Ki=zl.gn()}forEachTarget(e,t){return this.Li.forEach(((e,n)=>t(n))),qu.resolve()}getLastRemoteSnapshotVersion(e){return qu.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return qu.resolve(this.Ui)}allocateTargetId(e){return this.highestTargetId=this.Ki.next(),qu.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Ui&&(this.Ui=t),qu.resolve()}Tn(e){this.Li.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Ki=new zl(t),this.highestTargetId=t),e.sequenceNumber>this.Ui&&(this.Ui=e.sequenceNumber)}addTargetData(e,t){return this.Tn(t),this.targetCount+=1,qu.resolve()}updateTargetData(e,t){return this.Tn(t),qu.resolve()}removeTargetData(e,t){return this.Li.delete(t.target),this.qi.vi(t.targetId),this.targetCount-=1,qu.resolve()}removeTargets(e,t,n){let r=0;const i=[];return this.Li.forEach(((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Li.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),qu.waitFor(i).next((()=>r))}getTargetCount(e){return qu.resolve(this.targetCount)}getTargetData(e,t){const n=this.Li.get(t)||null;return qu.resolve(n)}addMatchingKeys(e,t,n){return this.qi.bi(t,n),qu.resolve()}removeMatchingKeys(e,t,n){this.qi.Vi(t,n);const r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((t=>{i.push(r.markPotentiallyOrphaned(e,t))})),qu.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.qi.vi(t),qu.resolve()}getMatchingKeysForTargetId(e,t){const n=this.qi.Di(t);return qu.resolve(n)}containsKey(e,t){return qu.resolve(this.qi.containsKey(t))}}class Kh{constructor(e,t){this.Gi={},this.overlays={},this.es=new xs(0),this.ns=!1,this.ns=!0,this.referenceDelegate=e(this),this.fs=new jh(this),this.indexManager=new Cl,this.ds=function(e){return new qh(e)}((e=>this.referenceDelegate.Qi(e))),this.M=new nl(t),this._s=new Lh(this.M)}start(){return Promise.resolve()}shutdown(){return this.ns=!1,Promise.resolve()}get started(){return this.ns}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Mh,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Gi[e.toKey()];return n||(n=new Uh(t,this.referenceDelegate),this.Gi[e.toKey()]=n),n}getTargetCache(){return this.fs}getRemoteDocumentCache(){return this.ds}getBundleCache(){return this._s}runTransaction(e,t,n){ps("MemoryPersistence","Starting transaction:",e);const r=new $h(this.es.next());return this.referenceDelegate.ji(),n(r).next((e=>this.referenceDelegate.Wi(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}zi(e,t){return qu.or(Object.values(this.Gi).map((n=>()=>n.containsKey(e,t))))}}class $h extends Uu{constructor(e){super(),this.currentSequenceNumber=e}}class Gh{constructor(e){this.persistence=e,this.Hi=new Fh,this.Ji=null}static Yi(e){return new Gh(e)}get Xi(){if(this.Ji)return this.Ji;throw vs()}addReference(e,t,n){return this.Hi.addReference(n,t),this.Xi.delete(n.toString()),qu.resolve()}removeReference(e,t,n){return this.Hi.removeReference(n,t),this.Xi.add(n.toString()),qu.resolve()}markPotentiallyOrphaned(e,t){return this.Xi.add(t.toString()),qu.resolve()}removeTarget(e,t){this.Hi.vi(t.targetId).forEach((e=>this.Xi.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Xi.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}ji(){this.Ji=new Set}Wi(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return qu.forEach(this.Xi,(n=>{const r=ao.fromPath(n);return this.Zi(e,r).next((e=>{e||t.removeEntry(r,Us.min())}))})).next((()=>(this.Ji=null,t.apply(e))))}updateLimboDocument(e,t){return this.Zi(e,t).next((e=>{e?this.Xi.delete(t.toString()):this.Xi.add(t.toString())}))}Qi(e){return 0}Zi(e,t){return qu.or([()=>qu.resolve(this.Hi.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.zi(e,t)])}}function zh(e,t){return`firestore_clients_${e}_${t}`}function Wh(e,t,n){let r=`firestore_mutations_${e}_${n}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}function Hh(e,t){return`firestore_targets_${e}_${t}`}class Qh{constructor(e,t,n,r){this.user=e,this.batchId=t,this.state=n,this.error=r}static tr(e,t,n){const r=JSON.parse(n);let i,s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new _s(r.error.code,r.error.message))),s?new Qh(e,t,r.state,i):(ms("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}er(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Yh{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static tr(e,t){const n=JSON.parse(t);let r,i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code,i&&(r=new _s(n.error.code,n.error.message))),i?new Yh(e,n.state,r):(ms("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}er(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Jh{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static tr(e,t){const n=JSON.parse(t);let r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Sc();for(let e=0;r&&e<n.activeTargetIds.length;++e)r=oo(n.activeTargetIds[e]),i=i.add(n.activeTargetIds[e]);return r?new Jh(e,i):(ms("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Xh{constructor(e,t){this.clientId=e,this.onlineState=t}static tr(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Xh(t.clientId,t.onlineState):(ms("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Zh{constructor(){this.activeTargetIds=Sc()}nr(e){this.activeTargetIds=this.activeTargetIds.add(e)}sr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}er(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class ed{constructor(e,t,n,r,i){this.window=e,this.Yn=t,this.persistenceKey=n,this.ir=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.rr=this.ur.bind(this),this.ar=new jo(Ls),this.started=!1,this.cr=[];const s=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.hr=zh(this.persistenceKey,this.ir),this.lr=function(e){return`firestore_sequence_number_${e}`}(this.persistenceKey),this.ar=this.ar.insert(this.ir,new Zh),this.dr=new RegExp(`^firestore_clients_${s}_([^_]*)$`),this._r=new RegExp(`^firestore_mutations_${s}_(\\d+)(?:_(.*))?$`),this.wr=new RegExp(`^firestore_targets_${s}_(\\d+)$`),this.mr=function(e){return`firestore_online_state_${e}`}(this.persistenceKey),this.gr=function(e){return`firestore_bundle_loaded_v2_${e}`}(this.persistenceKey),this.window.addEventListener("storage",this.rr)}static vt(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Fs();for(const t of e){if(t===this.ir)continue;const e=this.getItem(zh(this.persistenceKey,t));if(e){const n=Jh.tr(t,e);n&&(this.ar=this.ar.insert(n.clientId,n))}}this.yr();const t=this.storage.getItem(this.mr);if(t){const e=this.pr(t);e&&this.Ir(e)}for(const e of this.cr)this.ur(e);this.cr=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(e){this.setItem(this.lr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Tr(this.ar)}isActiveQueryTarget(e){let t=!1;return this.ar.forEach(((n,r)=>{r.activeTargetIds.has(e)&&(t=!0)})),t}addPendingMutation(e){this.Er(e,"pending")}updateMutationState(e,t,n){this.Er(e,t,n),this.Ar(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const n=this.storage.getItem(Hh(this.persistenceKey,e));if(n){const r=Yh.tr(e,n);r&&(t=r.state)}}return this.Rr.nr(e),this.yr(),t}removeLocalQueryTarget(e){this.Rr.sr(e),this.yr()}isLocalQueryTarget(e){return this.Rr.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Hh(this.persistenceKey,e))}updateQueryState(e,t,n){this.br(e,t,n)}handleUserChange(e,t,n){t.forEach((e=>{this.Ar(e)})),this.currentUser=e,n.forEach((e=>{this.addPendingMutation(e)}))}setOnlineState(e){this.Pr(e)}notifyBundleLoaded(e){this.Vr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.rr),this.removeItem(this.hr),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return ps("SharedClientState","READ",e,t),t}setItem(e,t){ps("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){ps("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ur(e){const t=e;if(t.storageArea===this.storage){if(ps("SharedClientState","EVENT",t.key,t.newValue),t.key===this.hr)return void ms("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Yn.enqueueRetryable((async()=>{if(this.started){if(null!==t.key)if(this.dr.test(t.key)){if(null==t.newValue){const e=this.vr(t.key);return this.Sr(e,null)}{const e=this.Dr(t.key,t.newValue);if(e)return this.Sr(e.clientId,e)}}else if(this._r.test(t.key)){if(null!==t.newValue){const e=this.Cr(t.key,t.newValue);if(e)return this.Nr(e)}}else if(this.wr.test(t.key)){if(null!==t.newValue){const e=this.kr(t.key,t.newValue);if(e)return this.Mr(e)}}else if(t.key===this.mr){if(null!==t.newValue){const e=this.pr(t.newValue);if(e)return this.Ir(e)}}else if(t.key===this.lr){const e=function(e){let t=xs.A;if(null!=e)try{const n=JSON.parse(e);ws("number"==typeof n),t=n}catch(e){ms("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(t.newValue);e!==xs.A&&this.sequenceNumberHandler(e)}else if(t.key===this.gr){const e=this.Or(t.newValue);await Promise.all(e.map((e=>this.syncEngine.Fr(e))))}}else this.cr.push(t)}))}}get Rr(){return this.ar.get(this.ir)}yr(){this.setItem(this.hr,this.Rr.er())}Er(e,t,n){const r=new Qh(this.currentUser,e,t,n),i=Wh(this.persistenceKey,this.currentUser,e);this.setItem(i,r.er())}Ar(e){const t=Wh(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Pr(e){const t={clientId:this.ir,onlineState:e};this.storage.setItem(this.mr,JSON.stringify(t))}br(e,t,n){const r=Hh(this.persistenceKey,e),i=new Yh(e,t,n);this.setItem(r,i.er())}Vr(e){const t=JSON.stringify(Array.from(e));this.setItem(this.gr,t)}vr(e){const t=this.dr.exec(e);return t?t[1]:null}Dr(e,t){const n=this.vr(e);return Jh.tr(n,t)}Cr(e,t){const n=this._r.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Qh.tr(new ls(i),r,t)}kr(e,t){const n=this.wr.exec(e),r=Number(n[1]);return Yh.tr(r,t)}pr(e){return Xh.tr(e)}Or(e){return JSON.parse(e)}async Nr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.$r(e.batchId,e.state,e.error);ps("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Mr(e){return this.syncEngine.Br(e.targetId,e.state,e.error)}Sr(e,t){const n=t?this.ar.insert(e,t):this.ar.remove(e),r=this.Tr(this.ar),i=this.Tr(n),s=[],o=[];return i.forEach((e=>{r.has(e)||s.push(e)})),r.forEach((e=>{i.has(e)||o.push(e)})),this.syncEngine.Lr(s,o).then((()=>{this.ar=n}))}Ir(e){this.ar.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Tr(e){let t=Sc();return e.forEach(((e,n)=>{t=t.unionWith(n.activeTargetIds)})),t}}class td{constructor(){this.Ur=new Zh,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.Ur.nr(e),this.qr[e]||"not-current"}updateQueryState(e,t,n){this.qr[e]=t}removeLocalQueryTarget(e){this.Ur.sr(e)}isLocalQueryTarget(e){return this.Ur.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Ur.activeTargetIds}isActiveQueryTarget(e){return this.Ur.activeTargetIds.has(e)}start(){return this.Ur=new Zh,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class nd{Kr(e){}shutdown(){}}class rd{constructor(){this.Gr=()=>this.Qr(),this.jr=()=>this.Wr(),this.zr=[],this.Hr()}Kr(e){this.zr.push(e)}shutdown(){window.removeEventListener("online",this.Gr),window.removeEventListener("offline",this.jr)}Hr(){window.addEventListener("online",this.Gr),window.addEventListener("offline",this.jr)}Qr(){ps("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.zr)e(0)}Wr(){ps("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.zr)e(1)}static vt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const id={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class sd{constructor(e){this.Jr=e.Jr,this.Yr=e.Yr}Xr(e){this.Zr=e}eo(e){this.no=e}onMessage(e){this.so=e}close(){this.Yr()}send(e){this.Jr(e)}io(){this.Zr()}ro(e){this.no(e)}oo(e){this.so(e)}}class od extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.uo=t+"://"+e.host,this.ao="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}co(e,t,n,r,i){const s=this.ho(e,t);ps("RestConnection","Sending: ",s,n);const o={};return this.lo(o,r,i),this.fo(e,s,o,n).then((e=>(ps("RestConnection","Received: ",e),e)),(t=>{throw gs("RestConnection",`${e} failed with error: `,t,"url: ",s,"request:",n),t}))}_o(e,t,n,r,i){return this.co(e,t,n,r,i)}lo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+hs,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}ho(e,t){const n=id[e];return`${this.uo}/v1/${t}:${n}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,n,r){return new Promise(((i,s)=>{const o=new cs;o.listenOnce(rs.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case ns.NO_ERROR:const t=o.getResponseJson();ps("Connection","XHR received:",JSON.stringify(t)),i(t);break;case ns.TIMEOUT:ps("Connection",'RPC "'+e+'" timed out'),s(new _s(Is.DEADLINE_EXCEEDED,"Request time out"));break;case ns.HTTP_ERROR:const n=o.getStatus();if(ps("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const e=o.getResponseJson().error;if(e&&e.status&&e.message){const t=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Is).indexOf(t)>=0?t:Is.UNKNOWN}(e.status);s(new _s(t,e.message))}else s(new _s(Is.UNKNOWN,"Server responded with status "+o.getStatus()))}else s(new _s(Is.UNAVAILABLE,"Connection failed."));break;default:vs()}}finally{ps("Connection",'RPC "'+e+'" completed.')}}));const a=JSON.stringify(r);o.send(t,"POST",a,n,15)}))}wo(e,t,n){const r=[this.uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=es(),s=ts(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new os({})),this.lo(o.initMessageHeaders,t,n),A()||D()||k().indexOf("Electron/")>=0||R()||k().indexOf("MSAppHost/")>=0||C()||(o.httpHeadersOverwriteParam="$httpHeaders");const a=r.join("");ps("Connection","Creating WebChannel: "+a,o);const c=i.createWebChannel(a,o);let u=!1,l=!1;const h=new sd({Jr:e=>{l?ps("Connection","Not sending because WebChannel is closed:",e):(u||(ps("Connection","Opening WebChannel transport."),c.open(),u=!0),ps("Connection","WebChannel sending:",e),c.send(e))},Yr:()=>c.close()}),d=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return d(c,as.EventType.OPEN,(()=>{l||ps("Connection","WebChannel transport opened.")})),d(c,as.EventType.CLOSE,(()=>{l||(l=!0,ps("Connection","WebChannel transport closed"),h.ro())})),d(c,as.EventType.ERROR,(e=>{l||(l=!0,gs("Connection","WebChannel transport errored:",e),h.ro(new _s(Is.UNAVAILABLE,"The operation could not be completed")))})),d(c,as.EventType.MESSAGE,(e=>{var t;if(!l){const n=e.data[0];ws(!!n);const r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){ps("Connection","WebChannel received error:",i);const e=i.status;let t=function(e){const t=hc[e];if(void 0!==t)return pc(t)}(e),n=i.message;void 0===t&&(t=Is.INTERNAL,n="Unknown error status: "+e+" with message "+i.message),l=!0,h.ro(new _s(t,n)),c.close()}else ps("Connection","WebChannel received:",n),h.oo(n)}})),d(s,is.STAT_EVENT,(e=>{e.stat===ss.PROXY?ps("Connection","Detected buffering proxy"):e.stat===ss.NOPROXY&&ps("Connection","Detected no buffering proxy")})),setTimeout((()=>{h.io()}),0),h}}function ad(){return"undefined"!=typeof window?window:null}function cd(){return"undefined"!=typeof document?document:null}function ud(e){return new Fc(e,!0)}class ld{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Yn=e,this.timerId=t,this.mo=n,this.yo=r,this.po=i,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),n=Math.max(0,Date.now()-this.Eo),r=Math.max(0,t-n);r>0&&ps("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.To=this.Yn.enqueueAfterDelay(this.timerId,r,(()=>(this.Eo=Date.now(),e()))),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class hd{constructor(e,t,n,r,i,s,o,a){this.Yn=e,this.Vo=n,this.vo=r,this.So=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Do=0,this.Co=null,this.xo=null,this.stream=null,this.No=new ld(e,t)}ko(){return 1===this.state||5===this.state||this.Mo()}Mo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}async stop(){this.ko()&&await this.close(0)}Fo(){this.state=0,this.No.reset()}$o(){this.Mo()&&null===this.Co&&(this.Co=this.Yn.enqueueAfterDelay(this.Vo,6e4,(()=>this.Bo())))}Lo(e){this.Uo(),this.stream.send(e)}async Bo(){if(this.Mo())return this.close(0)}Uo(){this.Co&&(this.Co.cancel(),this.Co=null)}qo(){this.xo&&(this.xo.cancel(),this.xo=null)}async close(e,t){this.Uo(),this.qo(),this.No.cancel(),this.Do++,4!==e?this.No.reset():t&&t.code===Is.RESOURCE_EXHAUSTED?(ms(t.toString()),ms("Using maximum backoff delay to prevent overloading the backend."),this.No.Ao()):t&&t.code===Is.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Ko(),this.stream.close(),this.stream=null),this.state=e,await this.listener.eo(t)}Ko(){}auth(){this.state=1;const e=this.Go(this.Do),t=this.Do;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Do===t&&this.Qo(e,n)}),(t=>{e((()=>{const e=new _s(Is.UNKNOWN,"Fetching auth token failed: "+t.message);return this.jo(e)}))}))}Qo(e,t){const n=this.Go(this.Do);this.stream=this.Wo(e,t),this.stream.Xr((()=>{n((()=>(this.state=2,this.xo=this.Yn.enqueueAfterDelay(this.vo,1e4,(()=>(this.Mo()&&(this.state=3),Promise.resolve()))),this.listener.Xr())))})),this.stream.eo((e=>{n((()=>this.jo(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Oo(){this.state=5,this.No.Ro((async()=>{this.state=0,this.start()}))}jo(e){return ps("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Go(e){return t=>{this.Yn.enqueueAndForget((()=>this.Do===e?t():(ps("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class dd extends hd{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.M=i}Wo(e,t){return this.So.wo("Listen",e,t)}onMessage(e){this.No.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:vs()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.N?(ws(void 0===t||"string"==typeof t),Hs.fromBase64String(t||"")):(ws(void 0===t||t instanceof Uint8Array),Hs.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Is.UNKNOWN:pc(e.code);return new _s(t,e.message||"")}(o);n=new Dc(r,i,s,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const i=Gc(e,r.document.name),s=Bc(r.document.updateTime),o=new Do({mapValue:{fields:r.document.fields}}),a=xo.newFoundDocument(i,s,o),c=r.targetIds||[],u=r.removedTargetIds||[];n=new Nc(c,u,a.key,a)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const i=Gc(e,r.document),s=r.readTime?Bc(r.readTime):Us.min(),o=xo.newNoDocument(i,s),a=r.removedTargetIds||[];n=new Nc([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const i=Gc(e,r.document),s=r.removedTargetIds||[];n=new Nc([],s,i,null)}else{if(!("filter"in t))return vs();{t.filter;const e=t.filter;e.targetId;const r=e.count||0,i=new lc(r),s=e.targetId;n=new Cc(s,i)}}return n}(this.M,e),n=function(e){if(!("targetChange"in e))return Us.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Us.min():t.readTime?Bc(t.readTime):Us.min()}(e);return this.listener.zo(t,n)}Ho(e){const t={};t.database=Hc(this.M),t.addTarget=function(e,t){let n;const r=t.target;return n=Xo(r)?{documents:eu(e,r)}:{query:tu(e,r)},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=Uc(e,t.resumeToken):t.snapshotVersion.compareTo(Us.min())>0&&(n.readTime=Vc(e,t.snapshotVersion.toTimestamp())),n}(this.M,e);const n=function(e,t){const n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return vs()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.M,e);n&&(t.labels=n),this.Lo(t)}Jo(e){const t={};t.database=Hc(this.M),t.removeTarget=e,this.Lo(t)}}class fd extends hd{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.M=i,this.Yo=!1}get Xo(){return this.Yo}start(){this.Yo=!1,this.lastStreamToken=void 0,super.start()}Ko(){this.Yo&&this.Zo([])}Wo(e,t){return this.So.wo("Write",e,t)}onMessage(e){if(ws(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Yo){this.No.reset();const t=function(e,t){return e&&e.length>0?(ws(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?Bc(e.updateTime):Bc(t);return n.isEqual(Us.min())&&(n=Bc(t)),new Ha(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Bc(e.commitTime);return this.listener.tu(n,t)}return ws(!e.writeResults||0===e.writeResults.length),this.Yo=!0,this.listener.eu()}nu(){const e={};e.database=Hc(this.M),this.Lo(e)}Zo(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>Xc(this.M,e)))};this.Lo(t)}}class pd extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.So=n,this.M=r,this.su=!1}iu(){if(this.su)throw new _s(Is.FAILED_PRECONDITION,"The client has already been terminated.")}co(e,t,n){return this.iu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.So.co(e,t,n,r,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Is.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new _s(Is.UNKNOWN,e.toString())}))}_o(e,t,n){return this.iu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.So._o(e,t,n,r,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===Is.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new _s(Is.UNKNOWN,e.toString())}))}terminate(){this.su=!0}}class md{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.ru=0,this.ou=null,this.uu=!0}au(){0===this.ru&&(this.cu("Unknown"),this.ou=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.ou=null,this.hu("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve()))))}lu(e){"Online"===this.state?this.cu("Unknown"):(this.ru++,this.ru>=1&&(this.fu(),this.hu(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.fu(),this.ru=0,"Online"===e&&(this.uu=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}hu(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.uu?(ms(t),this.uu=!1):ps("OnlineStateTracker",t)}fu(){null!==this.ou&&(this.ou.cancel(),this.ou=null)}}class gd{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.du=[],this._u=new Map,this.wu=new Set,this.mu=[],this.gu=i,this.gu.Kr((e=>{n.enqueueAndForget((async()=>{Sd(this)&&(ps("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=bs(e);t.wu.add(4),await vd(t),t.yu.set("Unknown"),t.wu.delete(4),await yd(t)}(this))}))})),this.yu=new md(n,r)}}async function yd(e){if(Sd(e))for(const t of e.mu)await t(!0)}async function vd(e){for(const t of e.mu)await t(!1)}function wd(e,t){const n=bs(e);n._u.has(t.targetId)||(n._u.set(t.targetId,t),Ed(n)?Td(n):Kd(n).Mo()&&Id(n,t))}function bd(e,t){const n=bs(e),r=Kd(n);n._u.delete(t),r.Mo()&&_d(n,t),0===n._u.size&&(r.Mo()?r.$o():Sd(n)&&n.yu.set("Unknown"))}function Id(e,t){e.pu.Z(t.targetId),Kd(e).Ho(t)}function _d(e,t){e.pu.Z(t),Kd(e).Jo(t)}function Td(e){e.pu=new xc({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>e._u.get(t)||null}),Kd(e).start(),e.yu.au()}function Ed(e){return Sd(e)&&!Kd(e).ko()&&e._u.size>0}function Sd(e){return 0===bs(e).wu.size}function kd(e){e.pu=void 0}async function Ad(e){e._u.forEach(((t,n)=>{Id(e,t)}))}async function Nd(e,t){kd(e),Ed(e)?(e.yu.lu(t),Td(e)):e.yu.set("Unknown")}async function Cd(e,t,n){if(e.yu.set("Online"),t instanceof Dc&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e._u.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e._u.delete(r),e.pu.removeTarget(r))}(e,t)}catch(n){ps("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Dd(e,n)}else if(t instanceof Nc?e.pu.ut(t):t instanceof Cc?e.pu._t(t):e.pu.ht(t),!n.isEqual(Us.min()))try{const t=await Sh(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.pu.yt(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=e._u.get(r);i&&e._u.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((t=>{const n=e._u.get(t);if(!n)return;e._u.set(t,n.withResumeToken(Hs.EMPTY_BYTE_STRING,n.snapshotVersion)),_d(e,t);const r=new tl(n.target,t,1,n.sequenceNumber);Id(e,r)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){ps("RemoteStore","Failed to raise snapshot:",t),await Dd(e,t)}}async function Dd(e,t,n){if(!Gu(t))throw t;e.wu.add(1),await vd(e),e.yu.set("Offline"),n||(n=()=>Sh(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{ps("RemoteStore","Retrying IndexedDB access"),await n(),e.wu.delete(1),await yd(e)}))}function Rd(e,t){return t().catch((n=>Dd(e,n,t)))}async function xd(e){const t=bs(e),n=$d(t);let r=t.du.length>0?t.du[t.du.length-1].batchId:-1;for(;Pd(t);)try{const e=await Ah(t.localStore,r);if(null===e){0===t.du.length&&n.$o();break}r=e.batchId,Od(t,e)}catch(e){await Dd(t,e)}Ld(t)&&Md(t)}function Pd(e){return Sd(e)&&e.du.length<10}function Od(e,t){e.du.push(t);const n=$d(e);n.Mo()&&n.Xo&&n.Zo(t.mutations)}function Ld(e){return Sd(e)&&!$d(e).ko()&&e.du.length>0}function Md(e){$d(e).start()}async function Fd(e){$d(e).nu()}async function Vd(e){const t=$d(e);for(const n of e.du)t.Zo(n.mutations)}async function Ud(e,t,n){const r=e.du.shift(),i=Zu.from(r,t,n);await Rd(e,(()=>e.remoteSyncer.applySuccessfulWrite(i))),await xd(e)}async function qd(e,t){t&&$d(e).Xo&&await async function(e,t){if(fc(n=t.code)&&n!==Is.ABORTED){const n=e.du.shift();$d(e).Fo(),await Rd(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await xd(e)}var n}(e,t),Ld(e)&&Md(e)}async function Bd(e,t){const n=bs(e);n.asyncQueue.verifyOperationInProgress(),ps("RemoteStore","RemoteStore received new credentials");const r=Sd(n);n.wu.add(3),await vd(n),r&&n.yu.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.wu.delete(3),await yd(n)}async function jd(e,t){const n=bs(e);t?(n.wu.delete(2),await yd(n)):t||(n.wu.add(2),await vd(n),n.yu.set("Unknown"))}function Kd(e){return e.Iu||(e.Iu=function(e,t,n){const r=bs(e);return r.iu(),new dd(t,r.So,r.authCredentials,r.appCheckCredentials,r.M,n)}(e.datastore,e.asyncQueue,{Xr:Ad.bind(null,e),eo:Nd.bind(null,e),zo:Cd.bind(null,e)}),e.mu.push((async t=>{t?(e.Iu.Fo(),Ed(e)?Td(e):e.yu.set("Unknown")):(await e.Iu.stop(),kd(e))}))),e.Iu}function $d(e){return e.Tu||(e.Tu=function(e,t,n){const r=bs(e);return r.iu(),new fd(t,r.So,r.authCredentials,r.appCheckCredentials,r.M,n)}(e.datastore,e.asyncQueue,{Xr:Fd.bind(null,e),eo:qd.bind(null,e),eu:Vd.bind(null,e),tu:Ud.bind(null,e)}),e.mu.push((async t=>{t?(e.Tu.Fo(),await xd(e)):(await e.Tu.stop(),e.du.length>0&&(ps("RemoteStore",`Stopping write stream with ${e.du.length} pending writes`),e.du=[]))}))),e.Tu}class Gd{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ts,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}static createAndSchedule(e,t,n,r,i){const s=Date.now()+n,o=new Gd(e,t,s,r,i);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new _s(Is.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function zd(e,t){if(ms("AsyncQueue",`${t}: ${e}`),Gu(e))return new _s(Is.UNAVAILABLE,`${t}: ${e}`);throw e}class Wd{constructor(e){this.comparator=e?(t,n)=>e(t,n)||ao.comparator(t.key,n.key):(e,t)=>ao.comparator(e.key,t.key),this.keyedMap=wc(),this.sortedSet=new jo(this.comparator)}static emptySet(e){return new Wd(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Wd))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Wd;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Hd{constructor(){this.Eu=new jo(ao.comparator)}track(e){const t=e.doc.key,n=this.Eu.get(t);n?0!==e.type&&3===n.type?this.Eu=this.Eu.insert(t,e):3===e.type&&1!==n.type?this.Eu=this.Eu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Eu=this.Eu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Eu=this.Eu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Eu=this.Eu.remove(t):1===e.type&&2===n.type?this.Eu=this.Eu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Eu=this.Eu.insert(t,{type:2,doc:e.doc}):vs():this.Eu=this.Eu.insert(t,e)}Au(){const e=[];return this.Eu.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Qd{constructor(e,t,n,r,i,s,o,a){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(e,t,n,r){const i=[];return t.forEach((e=>{i.push({type:0,doc:e})})),new Qd(e,t,Wd.emptySet(t),i,n,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Sa(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Yd{constructor(){this.Ru=void 0,this.listeners=[]}}class Jd{constructor(){this.queries=new mc((e=>ka(e)),Sa),this.onlineState="Unknown",this.bu=new Set}}async function Xd(e,t){const n=bs(e),r=t.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Yd),i)try{s.Ru=await n.onListen(r)}catch(e){const n=zd(e,`Initialization of query '${Aa(t.query)}' failed`);return void t.onError(n)}n.queries.set(r,s),s.listeners.push(t),t.Pu(n.onlineState),s.Ru&&t.Vu(s.Ru)&&nf(n)}async function Zd(e,t){const n=bs(e),r=t.query;let i=!1;const s=n.queries.get(r);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function ef(e,t){const n=bs(e);let r=!1;for(const e of t){const t=e.query,i=n.queries.get(t);if(i){for(const t of i.listeners)t.Vu(e)&&(r=!0);i.Ru=e}}r&&nf(n)}function tf(e,t,n){const r=bs(e),i=r.queries.get(t);if(i)for(const e of i.listeners)e.onError(n);r.queries.delete(t)}function nf(e){e.bu.forEach((e=>{e.next()}))}class rf{constructor(e,t,n){this.query=e,this.vu=t,this.Su=!1,this.Du=null,this.onlineState="Unknown",this.options=n||{}}Vu(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Qd(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.Su?this.Cu(e)&&(this.vu.next(e),t=!0):this.xu(e,this.onlineState)&&(this.Nu(e),t=!0),this.Du=e,t}onError(e){this.vu.error(e)}Pu(e){this.onlineState=e;let t=!1;return this.Du&&!this.Su&&this.xu(this.Du,e)&&(this.Nu(this.Du),t=!0),t}xu(e,t){if(!e.fromCache)return!0;const n="Offline"!==t;return!(this.options.ku&&n||e.docs.isEmpty()&&"Offline"!==t)}Cu(e){if(e.docChanges.length>0)return!0;const t=this.Du&&this.Du.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}Nu(e){e=Qd.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.Su=!0,this.vu.next(e)}}class sf{constructor(e,t){this.payload=e,this.byteLength=t}Mu(){return"metadata"in this.payload}}class of{constructor(e){this.M=e}wi(e){return Gc(this.M,e)}mi(e){return e.metadata.exists?Jc(this.M,e.document,!1):xo.newNoDocument(this.wi(e.metadata.name),this.gi(e.metadata.readTime))}gi(e){return Bc(e)}}class af{constructor(e,t,n){this.Ou=e,this.localStore=t,this.M=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=cf(e)}Fu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;const n=$s.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}$u(e){const t=new Map,n=new of(this.M);for(const r of e)if(r.metadata.queries){const e=n.wi(r.metadata.name);for(const n of r.metadata.queries){const r=(t.get(n)||Tc()).add(e);t.set(n,r)}}return t}async complete(){const e=await async function(e,t,n,r){const i=bs(e);let s=Tc(),o=yc();for(const e of n){const n=t.wi(e.metadata.name);e.document&&(s=s.add(n));const r=t.mi(e);r.setReadTime(t.gi(e.metadata.readTime)),o=o.insert(n,r)}const a=i.hi.newChangeBuffer({trackRemovals:!0}),c=await Nh(i,function(e){return Ta(va($s.fromString(`__bundle__/docs/${e}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",(e=>kh(e,a,o).next((t=>(a.apply(e),t))).next((t=>i.fs.removeMatchingKeysForTargetId(e,c.targetId).next((()=>i.fs.addMatchingKeys(e,s,c.targetId))).next((()=>i.fi.Gs(e,t))).next((()=>t))))))}(this.localStore,new of(this.M),this.documents,this.Ou.id),t=this.$u(this.documents);for(const e of this.queries)await Oh(this.localStore,e,t.get(e.name));return this.progress.taskState="Success",{progress:this.progress,Bu:this.collectionGroups,Lu:e}}}function cf(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class uf{constructor(e){this.key=e}}class lf{constructor(e){this.key=e}}class hf{constructor(e,t){this.query=e,this.Uu=t,this.qu=null,this.current=!1,this.Ku=Tc(),this.mutatedKeys=Tc(),this.Gu=Da(e),this.Qu=new Wd(this.Gu)}get ju(){return this.Uu}Wu(e,t){const n=t?t.zu:new Hd,r=t?t.Qu:this.Qu;let i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),l=Na(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;u&&l?u.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.Hu(u,l)||(n.track({type:2,doc:l}),f=!0,(a&&this.Gu(l,a)>0||c&&this.Gu(l,c)<0)&&(o=!0)):!u&&l?(n.track({type:0,doc:l}),f=!0):u&&!l&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{Qu:s,zu:n,ii:o,mutatedKeys:i}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n){const r=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const i=e.zu.Au();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return vs()}};return n(e)-n(t)}(e.type,t.type)||this.Gu(e.doc,t.doc))),this.Ju(n);const s=t?this.Yu():[],o=0===this.Ku.size&&this.current?1:0,a=o!==this.qu;return this.qu=o,0!==i.length||a?{snapshot:new Qd(this.query,e.Qu,r,i,e.mutatedKeys,0===o,a,!1),Xu:s}:{Xu:s}}Pu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new Hd,mutatedKeys:this.mutatedKeys,ii:!1},!1)):{Xu:[]}}Zu(e){return!this.Uu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach((e=>this.Uu=this.Uu.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Uu=this.Uu.delete(e))),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=Tc(),this.Qu.forEach((e=>{this.Zu(e.key)&&(this.Ku=this.Ku.add(e.key))}));const t=[];return e.forEach((e=>{this.Ku.has(e)||t.push(new lf(e))})),this.Ku.forEach((n=>{e.has(n)||t.push(new uf(n))})),t}ta(e){this.Uu=e._i,this.Ku=Tc();const t=this.Wu(e.documents);return this.applyChanges(t,!0)}ea(){return Qd.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.qu)}}class df{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class ff{constructor(e){this.key=e,this.na=!1}}class pf{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.sa={},this.ia=new mc((e=>ka(e)),Sa),this.ra=new Map,this.oa=new Set,this.ua=new jo(ao.comparator),this.aa=new Map,this.ca=new Fh,this.ha={},this.la=new Map,this.fa=zl.yn(),this.onlineState="Unknown",this.da=void 0}get isPrimaryClient(){return!0===this.da}}async function mf(e,t){const n=Bf(e);let r,i;const s=n.ia.get(t);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.ea();else{const e=await Nh(n.localStore,Ta(t));n.isPrimaryClient&&wd(n.remoteStore,e);const s=n.sharedClientState.addLocalQueryTarget(e.targetId);r=e.targetId,i=await gf(n,t,r,"current"===s)}return i}async function gf(e,t,n,r){e._a=(t,n,r)=>async function(e,t,n,r){let i=t.view.Wu(n);i.ii&&(i=await Dh(e.localStore,t.query,!1).then((({documents:e})=>t.view.Wu(e,i))));const s=r&&r.targetChanges.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s);return Af(e,t.targetId,o.Xu),o.snapshot}(e,t,n,r);const i=await Dh(e.localStore,t,!0),s=new hf(t,i._i),o=s.Wu(i.documents),a=Ac.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState),c=s.applyChanges(o,e.isPrimaryClient,a);Af(e,n,c.Xu);const u=new df(t,n,s);return e.ia.set(t,u),e.ra.has(n)?e.ra.get(n).push(t):e.ra.set(n,[t]),c.snapshot}async function yf(e,t){const n=bs(e),r=n.ia.get(t),i=n.ra.get(r.targetId);if(i.length>1)return n.ra.set(r.targetId,i.filter((e=>!Sa(e,t)))),void n.ia.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Ch(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),bd(n.remoteStore,r.targetId),Sf(n,r.targetId)})).catch(Jl)):(Sf(n,r.targetId),await Ch(n.localStore,r.targetId,!0))}async function vf(e,t){const n=bs(e);try{const e=await function(e,t){const n=bs(e),r=t.snapshotVersion;let i=n.ui;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const s=n.hi.newChangeBuffer({trackRemovals:!0});i=n.ui;const o=[];t.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.fs.removeMatchingKeys(e,s.removedDocuments,a).next((()=>n.fs.addMatchingKeys(e,s.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(a)?u=u.withResumeToken(Hs.EMPTY_BYTE_STRING,Us.min()).withLastLimboFreeSnapshotVersion(Us.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.fs.updateTargetData(e,u))}));let a=yc();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(kh(e,s,t.documentUpdates).next((e=>{a=e}))),!r.isEqual(Us.min())){const t=n.fs.getLastRemoteSnapshotVersion(e).next((t=>n.fs.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return qu.waitFor(o).next((()=>s.apply(e))).next((()=>n.fi.Gs(e,a))).next((()=>a))})).then((e=>(n.ui=i,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.aa.get(t);r&&(ws(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.na=!0:e.modifiedDocuments.size>0?ws(r.na):e.removedDocuments.size>0&&(ws(r.na),r.na=!1))})),await Df(n,e,t)}catch(e){await Jl(e)}}function wf(e,t,n){const r=bs(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.ia.forEach(((n,r)=>{const i=r.view.Pu(t);i.snapshot&&e.push(i.snapshot)})),function(e,t){const n=bs(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.listeners)e.Pu(t)&&(r=!0)})),r&&nf(n)}(r.eventManager,t),e.length&&r.sa.zo(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function bf(e,t,n){const r=bs(e);r.sharedClientState.updateQueryState(t,"rejected",n);const i=r.aa.get(t),s=i&&i.key;if(s){let e=new jo(ao.comparator);e=e.insert(s,xo.newNoDocument(s,Us.min()));const n=Tc().add(s),i=new kc(Us.min(),new Map,new Go(Ls),e,n);await vf(r,i),r.ua=r.ua.remove(s),r.aa.delete(t),Cf(r)}else await Ch(r.localStore,t,!1).then((()=>Sf(r,t,n))).catch(Jl)}async function If(e,t){const n=bs(e),r=t.batch.batchId;try{const e=await function(e,t){const n=bs(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),i=n.hi.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const i=n.batch,s=i.keys();let o=qu.resolve();return s.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const s=n.docVersions.get(e);ws(null!==s),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.Bs.removeMutationBatch(t,i)))}(n,e,t,i).next((()=>i.apply(e))).next((()=>n.Bs.performConsistencyCheck(e))).next((()=>n.fi.Ks(e,r)))}))}(n.localStore,t);Ef(n,r,null),Tf(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Df(n,e)}catch(e){await Jl(e)}}async function _f(e,t,n){const r=bs(e);try{const e=await function(e,t){const n=bs(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.Bs.lookupMutationBatch(e,t).next((t=>(ws(null!==t),r=t.keys(),n.Bs.removeMutationBatch(e,t)))).next((()=>n.Bs.performConsistencyCheck(e))).next((()=>n.fi.Ks(e,r)))}))}(r.localStore,t);Ef(r,t,n),Tf(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await Df(r,e)}catch(n){await Jl(n)}}function Tf(e,t){(e.la.get(t)||[]).forEach((e=>{e.resolve()})),e.la.delete(t)}function Ef(e,t,n){const r=bs(e);let i=r.ha[r.currentUser.toKey()];if(i){const e=i.get(t);e&&(n?e.reject(n):e.resolve(),i=i.remove(t)),r.ha[r.currentUser.toKey()]=i}}function Sf(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.ra.get(t))e.ia.delete(r),n&&e.sa.wa(r,n);e.ra.delete(t),e.isPrimaryClient&&e.ca.vi(t).forEach((t=>{e.ca.containsKey(t)||kf(e,t)}))}function kf(e,t){e.oa.delete(t.path.canonicalString());const n=e.ua.get(t);null!==n&&(bd(e.remoteStore,n),e.ua=e.ua.remove(t),e.aa.delete(n),Cf(e))}function Af(e,t,n){for(const r of n)r instanceof uf?(e.ca.addReference(r.key,t),Nf(e,r)):r instanceof lf?(ps("SyncEngine","Document no longer in limbo: "+r.key),e.ca.removeReference(r.key,t),e.ca.containsKey(r.key)||kf(e,r.key)):vs()}function Nf(e,t){const n=t.key,r=n.path.canonicalString();e.ua.get(n)||e.oa.has(r)||(ps("SyncEngine","New document in limbo: "+n),e.oa.add(r),Cf(e))}function Cf(e){for(;e.oa.size>0&&e.ua.size<e.maxConcurrentLimboResolutions;){const t=e.oa.values().next().value;e.oa.delete(t);const n=new ao($s.fromString(t)),r=e.fa.next();e.aa.set(r,new ff(n)),e.ua=e.ua.insert(n,r),wd(e.remoteStore,new tl(Ta(va(n.path)),r,2,xs.A))}}async function Df(e,t,n){const r=bs(e),i=[],s=[],o=[];r.ia.isEmpty()||(r.ia.forEach(((e,a)=>{o.push(r._a(a,t,n).then((e=>{if(e){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,e.fromCache?"not-current":"current"),i.push(e);const t=bh.Ys(a.targetId,e);s.push(t)}})))})),await Promise.all(o),r.sa.zo(i),await async function(e,t){const n=bs(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>qu.forEach(t,(t=>qu.forEach(t.Hs,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>qu.forEach(t.Js,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!Gu(e))throw e;ps("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.ui.get(t),r=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(r);n.ui=n.ui.insert(t,i)}}}(r.localStore,s))}async function Rf(e,t){const n=bs(e);if(!n.currentUser.isEqual(t)){ps("SyncEngine","User change. New user:",t.toKey());const e=await Eh(n.localStore,t);n.currentUser=t,function(e,t){e.la.forEach((e=>{e.forEach((e=>{e.reject(new _s(Is.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.la.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Df(n,e.di)}}function xf(e,t){const n=bs(e),r=n.aa.get(t);if(r&&r.na)return Tc().add(r.key);{let e=Tc();const r=n.ra.get(t);if(!r)return e;for(const t of r){const r=n.ia.get(t);e=e.unionWith(r.view.ju)}return e}}async function Pf(e,t){const n=bs(e),r=await Dh(n.localStore,t.query,!0),i=t.view.ta(r);return n.isPrimaryClient&&Af(n,t.targetId,i.Xu),i}async function Of(e,t){const n=bs(e);return xh(n.localStore,t).then((e=>Df(n,e)))}async function Lf(e,t,n,r){const i=bs(e),s=await function(e,t){const n=bs(e),r=bs(n.Bs);return n.persistence.runTransaction("Lookup mutation documents","readonly",(e=>r.fn(e,t).next((t=>t?n.fi.Ks(e,t):qu.resolve(null)))))}(i.localStore,t);null!==s?("pending"===n?await xd(i.remoteStore):"acknowledged"===n||"rejected"===n?(Ef(i,t,r||null),Tf(i,t),function(e,t){bs(bs(e).Bs)._n(t)}(i.localStore,t)):vs(),await Df(i,s)):ps("SyncEngine","Cannot apply mutation batch with id: "+t)}async function Mf(e,t,n){const r=bs(e),i=[],s=[];for(const e of t){let t;const n=r.ra.get(e);if(n&&0!==n.length){t=await Nh(r.localStore,Ta(n[0]));for(const e of n){const t=r.ia.get(e),n=await Pf(r,t);n.snapshot&&s.push(n.snapshot)}}else{const n=await Rh(r.localStore,e);t=await Nh(r.localStore,n),await gf(r,Ff(n),e,!1)}i.push(t)}return r.sa.zo(s),i}function Ff(e){return ya(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function Vf(e){const t=bs(e);return bs(bs(t.localStore).persistence).Fs()}async function Uf(e,t,n,r){const i=bs(e);if(i.da)return void ps("SyncEngine","Ignoring unexpected query state notification.");const s=i.ra.get(t);if(s&&s.length>0)switch(n){case"current":case"not-current":{const e=await xh(i.localStore,Ca(s[0])),r=kc.createSynthesizedRemoteEventForCurrentChange(t,"current"===n);await Df(i,e,r);break}case"rejected":await Ch(i.localStore,t,!0),Sf(i,t,r);break;default:vs()}}async function qf(e,t,n){const r=Bf(e);if(r.da){for(const e of t){if(r.ra.has(e)){ps("SyncEngine","Adding an already active target "+e);continue}const t=await Rh(r.localStore,e),n=await Nh(r.localStore,t);await gf(r,Ff(t),n.targetId,!1),wd(r.remoteStore,n)}for(const e of n)r.ra.has(e)&&await Ch(r.localStore,e,!1).then((()=>{bd(r.remoteStore,e),Sf(r,e)})).catch(Jl)}}function Bf(e){const t=bs(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=vf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=xf.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=bf.bind(null,t),t.sa.zo=ef.bind(null,t.eventManager),t.sa.wa=tf.bind(null,t.eventManager),t}function jf(e){const t=bs(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=If.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=_f.bind(null,t),t}class Kf{constructor(){this.synchronizeTabs=!1}async initialize(e){this.M=ud(e.databaseInfo.databaseId),this.sharedClientState=this.ga(e),this.persistence=this.ya(e),await this.persistence.start(),this.gcScheduler=this.pa(e),this.localStore=this.Ia(e)}pa(e){return null}Ia(e){return Th(this.persistence,new Ih,e.initialUser,this.M)}ya(e){return new Kh(Gh.Yi,this.M)}ga(e){return new td}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class $f extends Kf{constructor(e,t,n){super(),this.Ta=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ta.initialize(this,e),await jf(this.Ta.syncEngine),await xd(this.Ta.remoteStore),await this.persistence.Ts((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve())))}Ia(e){return Th(this.persistence,new Ih,e.initialUser,this.M)}pa(e){const t=this.persistence.referenceDelegate.garbageCollector;return new eh(t,e.asyncQueue)}ya(e){const t=vh(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Vl.withCacheSize(this.cacheSizeBytes):Vl.DEFAULT;return new mh(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,ad(),cd(),this.M,this.sharedClientState,!!this.forceOwnership)}ga(e){return new td}}class Gf extends $f{constructor(e,t){super(e,t,!1),this.Ta=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ta.syncEngine;this.sharedClientState instanceof ed&&(this.sharedClientState.syncEngine={$r:Lf.bind(null,t),Br:Uf.bind(null,t),Lr:qf.bind(null,t),Fs:Vf.bind(null,t),Fr:Of.bind(null,t)},await this.sharedClientState.start()),await this.persistence.Ts((async e=>{await async function(e,t){const n=bs(e);if(Bf(n),jf(n),!0===t&&!0!==n.da){const e=n.sharedClientState.getAllActiveQueryTargets(),t=await Mf(n,e.toArray());n.da=!0,await jd(n.remoteStore,!0);for(const e of t)wd(n.remoteStore,e)}else if(!1===t&&!1!==n.da){const e=[];let t=Promise.resolve();n.ra.forEach(((r,i)=>{n.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then((()=>(Sf(n,i),Ch(n.localStore,i,!0)))),bd(n.remoteStore,i)})),await t,await Mf(n,e),function(e){const t=bs(e);t.aa.forEach(((e,n)=>{bd(t.remoteStore,n)})),t.ca.Si(),t.aa=new Map,t.ua=new jo(ao.comparator)}(n),n.da=!1,await jd(n.remoteStore,!1)}}(this.Ta.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):e||this.gcScheduler.stop())}))}ga(e){const t=ad();if(!ed.vt(t))throw new _s(Is.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=vh(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new ed(t,e.asyncQueue,n,e.clientId,e.initialUser)}}class zf{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>wf(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=Rf.bind(null,this.syncEngine),await jd(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Jd}createDatastore(e){const t=ud(e.databaseInfo.databaseId),n=(r=e.databaseInfo,new od(r));var r;return function(e,t,n,r){return new pd(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=e=>wf(this.syncEngine,e,0),s=rd.vt()?new rd:new nd,new gd(t,n,r,i,s);var t,n,r,i,s}createSyncEngine(e,t){return function(e,t,n,r,i,s,o){const a=new pf(e,t,n,r,i,s);return o&&(a.da=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=bs(e);ps("RemoteStore","RemoteStore shutting down."),t.wu.add(5),await vd(t),t.gu.shutdown(),t.yu.set("Unknown")}(this.remoteStore)}}function Wf(e,t=10240){let n=0;return{async read(){if(n<e.byteLength){const r={value:e.slice(n,n+t),done:!1};return n+=t,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class Hf{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ea(this.observer.next,e)}error(e){this.observer.error?this.Ea(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Aa(){this.muted=!0}Ea(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class Qf{constructor(e,t){this.Ra=e,this.M=t,this.metadata=new Ts,this.buffer=new Uint8Array,this.ba=new TextDecoder("utf-8"),this.Pa().then((e=>{e&&e.Mu()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==e?void 0:e.payload)}`))}),(e=>this.metadata.reject(e)))}close(){return this.Ra.cancel()}async getMetadata(){return this.metadata.promise}async ma(){return await this.getMetadata(),this.Pa()}async Pa(){const e=await this.Va();if(null===e)return null;const t=this.ba.decode(e),n=Number(t);isNaN(n)&&this.va(`length string (${t}) is not valid number`);const r=await this.Sa(n);return new sf(JSON.parse(r),e.length+n)}Da(){return this.buffer.findIndex((e=>e==="{".charCodeAt(0)))}async Va(){for(;this.Da()<0&&!await this.Ca(););if(0===this.buffer.length)return null;const e=this.Da();e<0&&this.va("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Sa(e){for(;this.buffer.length<e;)await this.Ca()&&this.va("Reached the end of bundle when more is expected.");const t=this.ba.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}va(e){throw this.Ra.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ca(){const e=await this.Ra.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class Yf{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new _s(Is.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(e,t){const n=bs(e),r=Hc(n.M)+"/documents",i={documents:t.map((e=>$c(n.M,e)))},s=await n._o("BatchGetDocuments",r,i),o=new Map;s.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){ws(!!t.found),t.found.name,t.found.updateTime;const n=Gc(e,t.found.name),r=Bc(t.found.updateTime),i=new Do({mapValue:{fields:t.found.fields}});return xo.newFoundDocument(n,r,i)}(e,t):"missing"in t?function(e,t){ws(!!t.missing),ws(!!t.readTime);const n=Gc(e,t.missing),r=Bc(t.readTime);return xo.newNoDocument(n,r)}(e,t):vs()}(n.M,e);o.set(t.key.toString(),t)}));const a=[];return t.forEach((e=>{const t=o.get(e.toString());ws(!!t),a.push(t)})),a}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new cc(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=ao.fromPath(t);this.mutations.push(new uc(n,this.precondition(n)))})),await async function(e,t){const n=bs(e),r=Hc(n.M)+"/documents",i={writes:t.map((e=>Xc(n.M,e)))};await n.co("Commit",r,i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw vs();t=Us.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new _s(Is.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?Qa.updateTime(t):Qa.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Us.min()))throw new _s(Is.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Qa.updateTime(t)}return Qa.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Jf{constructor(e,t,n,r,i){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=r,this.deferred=i,this.xa=n.maxAttempts,this.No=new ld(this.asyncQueue,"transaction_retry")}run(){this.xa-=1,this.Na()}Na(){this.No.Ro((async()=>{const e=new Yf(this.datastore),t=this.ka(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.Ma(e)}))))})).catch((e=>{this.Ma(e)}))}))}ka(e){try{const t=this.updateFunction(e);return!io(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Ma(e){this.xa>0&&this.Oa(e)?(this.xa-=1,this.asyncQueue.enqueueAndForget((()=>(this.Na(),Promise.resolve())))):this.deferred.reject(e)}Oa(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||!fc(t)}return!1}}class Xf{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=ls.UNAUTHENTICATED,this.clientId=Os.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{ps("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(ps("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new _s(Is.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ts;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=zd(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function Zf(e,t){e.asyncQueue.verifyOperationInProgress(),ps("FirestoreClient","Initializing OfflineComponentProvider");const n=await e.getConfiguration();await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await Eh(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e.offlineComponents=t}async function ep(e,t){e.asyncQueue.verifyOperationInProgress();const n=await tp(e);ps("FirestoreClient","Initializing OnlineComponentProvider");const r=await e.getConfiguration();await t.initialize(n,r),e.setCredentialChangeListener((e=>Bd(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Bd(t.remoteStore,n))),e.onlineComponents=t}async function tp(e){return e.offlineComponents||(ps("FirestoreClient","Using default OfflineComponentProvider"),await Zf(e,new Kf)),e.offlineComponents}async function np(e){return e.onlineComponents||(ps("FirestoreClient","Using default OnlineComponentProvider"),await ep(e,new zf)),e.onlineComponents}function rp(e){return tp(e).then((e=>e.persistence))}function ip(e){return tp(e).then((e=>e.localStore))}function sp(e){return np(e).then((e=>e.remoteStore))}function op(e){return np(e).then((e=>e.syncEngine))}async function ap(e){const t=await np(e),n=t.eventManager;return n.onListen=mf.bind(null,t.syncEngine),n.onUnlisten=yf.bind(null,t.syncEngine),n}function cp(e,t,n={}){const r=new Ts;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new Hf({next:s=>{t.enqueueAndForget((()=>Zd(e,o)));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new _s(Is.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new _s(Is.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:e=>i.reject(e)}),o=new rf(va(n.path),s,{includeMetadataChanges:!0,ku:!0});return Xd(e,o)}(await ap(e),e.asyncQueue,t,n,r))),r.promise}function up(e,t,n={}){const r=new Ts;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,i){const s=new Hf({next:n=>{t.enqueueAndForget((()=>Zd(e,o))),n.fromCache&&"server"===r.source?i.reject(new _s(Is.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:e=>i.reject(e)}),o=new rf(n,s,{includeMetadataChanges:!0,ku:!0});return Xd(e,o)}(await ap(e),e.asyncQueue,t,n,r))),r.promise}const lp=new Map;function hp(e,t,n){if(!n)throw new _s(Is.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function dp(e,t,n,r){if(!0===t&&!0===r)throw new _s(Is.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)}function fp(e){if(!ao.isDocumentKey(e))throw new _s(Is.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function pp(e){if(ao.isDocumentKey(e))throw new _s(Is.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function mp(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":vs()}function gp(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new _s(Is.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=mp(e);throw new _s(Is.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function yp(e,t){if(t<=0)throw new _s(Is.INVALID_ARGUMENT,`Function ${e}() requires a positive number, but it was: ${t}.`)}class vp{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new _s(Is.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new _s(Is.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,dp("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class wp{constructor(e,t,n){this._authCredentials=t,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new vp({}),this._settingsFrozen=!1,e instanceof ro?this._databaseId=e:(this._app=e,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new _s(Is.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ro(e.options.projectId)}(e))}get app(){if(!this._app)throw new _s(Is.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new _s(Is.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new vp(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Ss;switch(e.type){case"gapi":const t=e.client;return ws(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new Cs(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new _s(Is.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=lp.get(e);t&&(ps("ComponentProvider","Removing Datastore"),lp.delete(e),t.terminate())}(this),Promise.resolve()}}class bp{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new _p(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new bp(this.firestore,e,this._key)}}class Ip{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Ip(this.firestore,e,this._query)}}class _p extends Ip{constructor(e,t,n){super(e,t,va(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new bp(this.firestore,null,new ao(e))}withConverter(e){return new _p(this.firestore,e,this._path)}}function Tp(e,t,...n){if(e=G(e),hp("collection","path",t),e instanceof wp){const r=$s.fromString(t,...n);return pp(r),new _p(e,null,r)}{if(!(e instanceof bp||e instanceof _p))throw new _s(Is.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child($s.fromString(t,...n));return pp(r),new _p(e.firestore,null,r)}}function Ep(e,t,...n){if(e=G(e),1===arguments.length&&(t=Os.R()),hp("doc","path",t),e instanceof wp){const r=$s.fromString(t,...n);return fp(r),new bp(e,null,new ao(r))}{if(!(e instanceof bp||e instanceof _p))throw new _s(Is.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child($s.fromString(t,...n));return fp(r),new bp(e.firestore,e instanceof _p?e.converter:null,new ao(r))}}function Sp(e,t){return e=G(e),t=G(t),(e instanceof bp||e instanceof _p)&&(t instanceof bp||t instanceof _p)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function kp(e,t){return e=G(e),t=G(t),e instanceof Ip&&t instanceof Ip&&e.firestore===t.firestore&&Sa(e._query,t._query)&&e.converter===t.converter}class Ap{constructor(){this.Fa=Promise.resolve(),this.$a=[],this.Ba=!1,this.La=[],this.Ua=null,this.qa=!1,this.Ka=!1,this.Ga=[],this.No=new ld(this,"async_queue_retry"),this.Qa=()=>{const e=cd();e&&ps("AsyncQueue","Visibility state changed to "+e.visibilityState),this.No.Po()};const e=cd();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Qa)}get isShuttingDown(){return this.Ba}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ja(),this.Wa(e)}enterRestrictedMode(e){if(!this.Ba){this.Ba=!0,this.Ka=e||!1;const t=cd();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Qa)}}enqueue(e){if(this.ja(),this.Ba)return new Promise((()=>{}));const t=new Ts;return this.Wa((()=>this.Ba&&this.Ka?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.$a.push(e),this.za())))}async za(){if(0!==this.$a.length){try{await this.$a[0](),this.$a.shift(),this.No.reset()}catch(e){if(!Gu(e))throw e;ps("AsyncQueue","Operation failed with retryable error: "+e)}this.$a.length>0&&this.No.Ro((()=>this.za()))}}Wa(e){const t=this.Fa.then((()=>(this.qa=!0,e().catch((e=>{this.Ua=e,this.qa=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw ms("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this.qa=!1,e))))));return this.Fa=t,t}enqueueAfterDelay(e,t,n){this.ja(),this.Ga.indexOf(e)>-1&&(t=0);const r=Gd.createAndSchedule(this,e,t,n,(e=>this.Ha(e)));return this.La.push(r),r}ja(){this.Ua&&vs()}verifyOperationInProgress(){}async Ja(){let e;do{e=this.Fa,await e}while(e!==this.Fa)}Ya(e){for(const t of this.La)if(t.timerId===e)return!0;return!1}Xa(e){return this.Ja().then((()=>{this.La.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.La)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Ja()}))}Za(e){this.Ga.push(e)}Ha(e){const t=this.La.indexOf(e);this.La.splice(t,1)}}function Np(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class Cp{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ts,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Dp extends wp{constructor(e,t,n){super(e,t,n),this.type="firestore",this._queue=new Ap,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||xp(this),this._firestoreClient.terminate()}}function Rp(e){return e._firestoreClient||xp(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function xp(e){var t;const n=e._freezeSettings(),r=function(e,t,n,r){return new no(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new Xf(e._authCredentials,e._appCheckCredentials,e._queue,r)}function Pp(e,t,n){const r=new Ts;return e.asyncQueue.enqueue((async()=>{try{await Zf(e,n),await ep(e,t),r.resolve()}catch(e){if(!function(e){return"FirebaseError"===e.name?e.code===Is.FAILED_PRECONDITION||e.code===Is.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(e))throw e;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+e),r.reject(e)}})).then((()=>r.promise))}function Op(e){if(e._initialized||e._terminated)throw new _s(Is.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Lp{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new _s(Is.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new zs(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Mp{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Mp(Hs.fromBase64String(e))}catch(e){throw new _s(Is.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Mp(Hs.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Fp{constructor(e){this._methodName=e}}class Vp{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new _s(Is.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new _s(Is.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Ls(this._lat,e._lat)||Ls(this._long,e._long)}}const Up=/^__.*__$/;class qp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new ic(e,this.data,this.fieldMask,t,this.fieldTransforms):new rc(e,this.data,t,this.fieldTransforms)}}class Bp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new ic(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function jp(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw vs()}}class Kp{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.M=n,this.ignoreUndefinedProperties=r,void 0===i&&this.tc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get ec(){return this.settings.ec}nc(e){return new Kp(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.M,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}sc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.nc({path:n,ic:!1});return r.rc(e),r}oc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.nc({path:n,ic:!1});return r.tc(),r}uc(e){return this.nc({path:void 0,ic:!0})}ac(e){return um(e,this.settings.methodName,this.settings.cc||!1,this.path,this.settings.hc)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}tc(){if(this.path)for(let e=0;e<this.path.length;e++)this.rc(this.path.get(e))}rc(e){if(0===e.length)throw this.ac("Document fields must not be empty");if(jp(this.ec)&&Up.test(e))throw this.ac('Document fields cannot begin and end with "__"')}}class $p{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.M=n||ud(e)}lc(e,t,n,r=!1){return new Kp({ec:e,methodName:t,hc:n,path:zs.emptyPath(),ic:!1,cc:r},this.databaseId,this.M,this.ignoreUndefinedProperties)}}function Gp(e){const t=e._freezeSettings(),n=ud(e._databaseId);return new $p(e._databaseId,!!t.ignoreUndefinedProperties,n)}function zp(e,t,n,r,i,s={}){const o=e.lc(s.merge||s.mergeFields?2:0,t,n,i);sm("Data must be an object, but it was:",o,r);const a=rm(r,o);let c,u;if(s.merge)c=new Ws(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const r of s.mergeFields){const i=om(t,r,n);if(!o.contains(i))throw new _s(Is.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);lm(e,i)||e.push(i)}c=new Ws(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new qp(new Do(a),c,u)}class Wp extends Fp{_toFieldTransform(e){if(2!==e.ec)throw 1===e.ec?e.ac(`${this._methodName}() can only appear at the top level of your update data`):e.ac(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Wp}}function Hp(e,t,n){return new Kp({ec:3,hc:t.settings.hc,methodName:e._methodName,ic:n},t.databaseId,t.M,t.ignoreUndefinedProperties)}class Qp extends Fp{_toFieldTransform(e){return new Wa(e.path,new Ua)}isEqual(e){return e instanceof Qp}}class Yp extends Fp{constructor(e,t){super(e),this.fc=t}_toFieldTransform(e){const t=Hp(this,e,!0),n=this.fc.map((e=>nm(e,t))),r=new qa(n);return new Wa(e.path,r)}isEqual(e){return this===e}}class Jp extends Fp{constructor(e,t){super(e),this.fc=t}_toFieldTransform(e){const t=Hp(this,e,!0),n=this.fc.map((e=>nm(e,t))),r=new ja(n);return new Wa(e.path,r)}isEqual(e){return this===e}}class Xp extends Fp{constructor(e,t){super(e),this.dc=t}_toFieldTransform(e){const t=new $a(e.M,Oa(e.M,this.dc));return new Wa(e.path,t)}isEqual(e){return this===e}}function Zp(e,t,n,r){const i=e.lc(1,t,n);sm("Data must be an object, but it was:",i,r);const s=[],o=Do.empty();Bs(r,((e,r)=>{const a=cm(t,e,n);r=G(r);const c=i.oc(a);if(r instanceof Wp)s.push(a);else{const e=nm(r,c);null!=e&&(s.push(a),o.set(a,e))}}));const a=new Ws(s);return new Bp(o,a,i.fieldTransforms)}function em(e,t,n,r,i,s){const o=e.lc(1,t,n),a=[om(t,r,n)],c=[i];if(s.length%2!=0)throw new _s(Is.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(om(t,s[e])),c.push(s[e+1]);const u=[],l=Do.empty();for(let e=a.length-1;e>=0;--e)if(!lm(u,a[e])){const t=a[e];let n=c[e];n=G(n);const r=o.oc(t);if(n instanceof Wp)u.push(t);else{const e=nm(n,r);null!=e&&(u.push(t),l.set(t,e))}}const h=new Ws(u);return new Bp(l,h,o.fieldTransforms)}function tm(e,t,n,r=!1){return nm(n,e.lc(r?4:3,t))}function nm(e,t){if(im(e=G(e)))return sm("Unsupported field value:",t,e),rm(e,t);if(e instanceof Fp)return function(e,t){if(!jp(t.ec))throw t.ac(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.ac(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.ic&&4!==t.ec)throw t.ac("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const i of e){let e=nm(i,t.uc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=G(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Oa(t.M,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=Vs.fromDate(e);return{timestampValue:Vc(t.M,n)}}if(e instanceof Vs){const n=new Vs(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Vc(t.M,n)}}if(e instanceof Vp)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Mp)return{bytesValue:Uc(t.M,e._byteString)};if(e instanceof bp){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.ac(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:jc(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.ac(`Unsupported field value: ${mp(e)}`)}(e,t)}function rm(e,t){const n={};return js(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Bs(e,((e,r)=>{const i=nm(r,t.sc(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function im(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof Vs||e instanceof Vp||e instanceof Mp||e instanceof bp||e instanceof Fp)}function sm(e,t,n){if(!im(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=mp(n);throw"an object"===r?t.ac(e+" a custom object"):t.ac(e+" "+r)}}function om(e,t,n){if((t=G(t))instanceof Lp)return t._internalPath;if("string"==typeof t)return cm(e,t);throw um("Field path arguments must be of type string or ",e,!1,void 0,n)}const am=new RegExp("[~\\*/\\[\\]]");function cm(e,t,n){if(t.search(am)>=0)throw um(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Lp(...t.split("."))._internalPath}catch(r){throw um(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function um(e,t,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new _s(Is.INVALID_ARGUMENT,a+e+c)}function lm(e,t){return e.some((e=>e.isEqual(t)))}class hm{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new bp(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new dm(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(fm("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class dm extends hm{data(){return super.data()}}function fm(e,t){return"string"==typeof t?cm(e,t):t instanceof Lp?t._internalPath:t._delegate._internalPath}class pm{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class mm extends hm{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new gm(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(fm("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class gm extends mm{data(e={}){return super.data(e)}}class ym{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new pm(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new gm(this._firestore,this._userDataWriter,n.key,n,new pm(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new _s(Is.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>({type:"added",doc:new gm(e._firestore,e._userDataWriter,n.doc.key,n.doc,new pm(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:t++})))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new gm(e._firestore,e._userDataWriter,t.doc.key,t.doc,new pm(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),s=n.indexOf(t.doc.key)),{type:vm(t.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function vm(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return vs()}}function wm(e,t){return e instanceof mm&&t instanceof mm?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof ym&&t instanceof ym&&e._firestore===t._firestore&&kp(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function bm(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new _s(Is.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Im{}function _m(e,...t){for(const n of t)e=n._apply(e);return e}class Tm extends Im{constructor(e,t,n){super(),this._c=e,this.wc=t,this.mc=n,this.type="where"}_apply(e){const t=Gp(e.firestore),n=function(e,t,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new _s(Is.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){Rm(o,s);const t=[];for(const n of o)t.push(Dm(r,e,n));a={arrayValue:{values:t}}}else a=Dm(r,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Rm(o,s),a=tm(n,"where",o,"in"===s||"not-in"===s);const c=na.create(i,s,a);return function(e,t){if(t.S()){const n=ba(e);if(null!==n&&!n.isEqual(t.field))throw new _s(Is.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${t.field.toString()}'`);const r=wa(e);null!==r&&xm(0,t.field,r)}const n=function(e,t){for(const n of e.filters)if(t.indexOf(n.op)>=0)return n.op;return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new _s(Is.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new _s(Is.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}(e,c),c}(e._query,0,t,e.firestore._databaseId,this._c,this.wc,this.mc);return new Ip(e.firestore,e.converter,function(e,t){const n=e.filters.concat([t]);return new ga(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}function Em(e,t,n){const r=t,i=fm("where",e);return new Tm(i,r,n)}class Sm extends Im{constructor(e,t){super(),this._c=e,this.gc=t,this.type="orderBy"}_apply(e){const t=function(e,t,n){if(null!==e.startAt)throw new _s(Is.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new _s(Is.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new da(t,n);return function(e,t){if(null===wa(e)){const n=ba(e);null!==n&&xm(0,n,t.field)}}(e,r),r}(e._query,this._c,this.gc);return new Ip(e.firestore,e.converter,function(e,t){const n=e.explicitOrderBy.concat([t]);return new ga(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}class km extends Im{constructor(e,t,n){super(),this.type=e,this.yc=t,this.Ic=n}_apply(e){return new Ip(e.firestore,e.converter,Ea(e._query,this.yc,this.Ic))}}class Am extends Im{constructor(e,t,n){super(),this.type=e,this.Tc=t,this.Ec=n}_apply(e){const t=Cm(e,this.type,this.Tc,this.Ec);return new Ip(e.firestore,e.converter,function(e,t){return new ga(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}class Nm extends Im{constructor(e,t,n){super(),this.type=e,this.Tc=t,this.Ec=n}_apply(e){const t=Cm(e,this.type,this.Tc,this.Ec);return new Ip(e.firestore,e.converter,function(e,t){return new ga(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}function Cm(e,t,n,r){if(n[0]=G(n[0]),n[0]instanceof hm)return function(e,t,n,r,i){if(!r)throw new _s(Is.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of _a(e))if(n.field.isKeyField())s.push(vo(t,r.key));else{const e=r.data.field(n.field);if(Zs(e))throw new _s(Is.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===e){const e=n.field.canonicalString();throw new _s(Is.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}s.push(e)}return new ha(s,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);{const i=Gp(e.firestore);return function(e,t,n,r,i,s){const o=e.explicitOrderBy;if(i.length>o.length)throw new _s(Is.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let s=0;s<i.length;s++){const c=i[s];if(o[s].field.isKeyField()){if("string"!=typeof c)throw new _s(Is.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!Ia(e)&&-1!==c.indexOf("/"))throw new _s(Is.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);const n=e.path.child($s.fromString(c));if(!ao.isDocumentKey(n))throw new _s(Is.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new ao(n);a.push(vo(t,i))}else{const e=tm(n,r,c);a.push(e)}}return new ha(a,s)}(e._query,e.firestore._databaseId,i,t,n,r)}}function Dm(e,t,n){if("string"==typeof(n=G(n))){if(""===n)throw new _s(Is.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ia(t)&&-1!==n.indexOf("/"))throw new _s(Is.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child($s.fromString(n));if(!ao.isDocumentKey(r))throw new _s(Is.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return vo(e,new ao(r))}if(n instanceof bp)return vo(e,n._key);throw new _s(Is.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${mp(n)}.`)}function Rm(e,t){if(!Array.isArray(e)||0===e.length)throw new _s(Is.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`);if(e.length>10)throw new _s(Is.INVALID_ARGUMENT,`Invalid Query. '${t.toString()}' filters support a maximum of 10 elements in the value array.`)}function xm(e,t,n){if(!n.isEqual(t))throw new _s(Is.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${t.toString()}' and so you must also use '${t.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}const Pm={maxAttempts:5};class Om{convertValue(e,t="none"){switch(lo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Js(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Xs(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw vs()}}convertObject(e,t){const n={};return Bs(e.fields,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new Vp(Js(e.latitude),Js(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=eo(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(to(e));default:return null}}convertTimestamp(e){const t=Ys(e);return new Vs(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=$s.fromString(e);ws(hu(n));const r=new ro(n.get(1),n.get(3)),i=new ao(n.popFirst(5));return r.isEqual(t)||ms(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Lm(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class Mm extends Om{constructor(e){super(),this.firestore=e}convertBytes(e){return new Mp(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new bp(this.firestore,null,t)}}class Fm{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Gp(e)}set(e,t,n){this._verifyNotCommitted();const r=Vm(e,this._firestore),i=Lm(r.converter,t,n),s=zp(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,Qa.none())),this}update(e,t,n,...r){this._verifyNotCommitted();const i=Vm(e,this._firestore);let s;return s="string"==typeof(t=G(t))||t instanceof Lp?em(this._dataReader,"WriteBatch.update",i._key,t,n,r):Zp(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(s.toMutation(i._key,Qa.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Vm(e,this._firestore);return this._mutations=this._mutations.concat(new cc(t._key,Qa.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new _s(Is.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Vm(e,t){if((e=G(e)).firestore!==t)throw new _s(Is.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class Um extends Om{constructor(e){super(),this.firestore=e}convertBytes(e){return new Mp(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new bp(this.firestore,null,t)}}function qm(e){e=gp(e,Ip);const t=gp(e.firestore,Dp),n=Rp(t),r=new Um(t);return bm(e._query),up(n,e._query).then((n=>new ym(t,r,e,n)))}function Bm(e,t,n){e=gp(e,bp);const r=gp(e.firestore,Dp),i=Lm(e.converter,t,n);return $m(r,[zp(Gp(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Qa.none())])}function jm(e,t,n,...r){e=gp(e,bp);const i=gp(e.firestore,Dp),s=Gp(i);let o;return o="string"==typeof(t=G(t))||t instanceof Lp?em(s,"updateDoc",e._key,t,n,r):Zp(s,"updateDoc",e._key,t),$m(i,[o.toMutation(e._key,Qa.exists(!0))])}function Km(e,...t){var n,r,i;e=G(e);let s={includeMetadataChanges:!1},o=0;"object"!=typeof t[o]||Np(t[o])||(s=t[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(Np(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(r=e.error)||void 0===r?void 0:r.bind(e),t[o+2]=null===(i=e.complete)||void 0===i?void 0:i.bind(e)}let c,u,l;if(e instanceof bp)u=gp(e.firestore,Dp),l=va(e._key.path),c={next:n=>{t[o]&&t[o](Gm(u,e,n))},error:t[o+1],complete:t[o+2]};else{const n=gp(e,Ip);u=gp(n.firestore,Dp),l=n._query;const r=new Um(u);c={next:e=>{t[o]&&t[o](new ym(u,r,n,e))},error:t[o+1],complete:t[o+2]},bm(e._query)}return function(e,t,n,r){const i=new Hf(r),s=new rf(t,i,n);return e.asyncQueue.enqueueAndForget((async()=>Xd(await ap(e),s))),()=>{i.Aa(),e.asyncQueue.enqueueAndForget((async()=>Zd(await ap(e),s)))}}(Rp(u),l,a,c)}function $m(e,t){return function(e,t){const n=new Ts;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=jf(e);try{const e=await function(e,t){const n=bs(e),r=Vs.now(),i=t.reduce(((e,t)=>e.add(t.key)),Tc());let s;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>n.fi.Ks(e,i).next((i=>{s=i;const o=[];for(const e of t){const t=ec(e,s.get(e.key));null!=t&&o.push(new ic(e.key,t,Ro(t.value.mapValue),Qa.exists(!0)))}return n.Bs.addMutationBatch(e,r,o,t)})))).then((e=>(e.applyToLocalDocumentSet(s),{batchId:e.batchId,changes:s})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.ha[e.currentUser.toKey()];r||(r=new jo(Ls)),r=r.insert(t,n),e.ha[e.currentUser.toKey()]=r}(r,e.batchId,n),await Df(r,e.changes),await xd(r.remoteStore)}catch(e){const t=zd(e,"Failed to persist write");n.reject(t)}}(await op(e),t,n))),n.promise}(Rp(e),t)}function Gm(e,t,n){const r=n.docs.get(t._key),i=new Um(e);return new mm(e,i,t._key,r,new pm(n.hasPendingWrites,n.fromCache),t.converter)}class zm extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Gp(e)}get(e){const t=Vm(e,this._firestore),n=new Mm(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return vs();const r=e[0];if(r.isFoundDocument())return new hm(this._firestore,n,r.key,r,t.converter);if(r.isNoDocument())return new hm(this._firestore,n,t._key,null,t.converter);throw vs()}))}set(e,t,n){const r=Vm(e,this._firestore),i=Lm(r.converter,t,n),s=zp(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(e,t,n,...r){const i=Vm(e,this._firestore);let s;return s="string"==typeof(t=G(t))||t instanceof Lp?em(this._dataReader,"Transaction.update",i._key,t,n,r):Zp(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,s),this}delete(e){const t=Vm(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Vm(e,this._firestore),n=new Um(this._firestore);return super.get(e).then((e=>new mm(this._firestore,n,t._key,e._document,new pm(!1,!1),t.converter)))}}!function(e,t=!0){!function(e){hs=e}(Le),Ce(new z("firestore",((e,{options:n})=>{const r=e.getProvider("app").getImmediate(),i=new Dp(r,new As(e.getProvider("auth-internal")),new Rs(e.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:t},n),i._setSettings(n),i}),"PUBLIC")),qe(us,"3.4.9",e),qe(us,"3.4.9","esm2017")}();class Wm{constructor(e,t){this._delegate=e,this.firebase=t,Ae(e,new z("app-compat",(()=>this),"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise((e=>{this._delegate.checkDestroyed(),e()})).then((()=>(this.firebase.INTERNAL.removeApp(this.name),Ue(this._delegate))))}_getService(e,t=Te){var n;this._delegate.checkDestroyed();const r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})}_removeServiceInstance(e,t=Te){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){Ae(this._delegate,e)}_addOrOverwriteComponent(e){Ne(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const Hm=new O("app-compat","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."}),Qm=function e(){const t=function(e){const t={},n={__esModule:!0,initializeApp:function(r,i={}){const s=Me(r,i);if(M(t,s.name))return t[s.name];const o=new e(s,n);return t[s.name]=o,o},app:r,registerVersion:qe,setLogLevel:je,onLog:Be,apps:null,SDK_VERSION:Le,INTERNAL:{registerComponent:function(t){const i=t.name,s=i.replace("-compat","");if(Ce(t)&&"PUBLIC"===t.type){const o=(e=r())=>{if("function"!=typeof e[s])throw Hm.create("invalid-app-argument",{appName:i});return e[s]()};void 0!==t.serviceProps&&E(o,t.serviceProps),n[s]=o,e.prototype[s]=function(...e){return this._getService.bind(this,i).apply(this,t.multipleInstances?e:[])}}return"PUBLIC"===t.type?n[s]:null},removeApp:function(e){delete t[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:s}};function r(e){if(!M(t,e=e||Te))throw Hm.create("no-app",{appName:e});return t[e]}return n.default=n,Object.defineProperty(n,"apps",{get:function(){return Object.keys(t).map((e=>t[e]))}}),r.App=e,n}(Wm);return t.INTERNAL=Object.assign(Object.assign({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){E(t,e)},createSubscribe:j,ErrorFactory:O,deepExtend:E}),t}(),Ym=new ne("@firebase/app-compat");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){Ym.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");const e=self.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&Ym.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}const Jm=Qm;function Xm(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}qe("@firebase/app-compat","0.1.25",void 0),Jm.registerVersion("firebase","9.8.1","app-compat"),Object.create,Object.create;const Zm=function(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},eg=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},tg=new O("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),ng=new ne("@firebase/auth");function rg(e,...t){ng.logLevel<=J.ERROR&&ng.error(`Auth (${Le}): ${e}`,...t)}function ig(e,...t){throw cg(e,...t)}function sg(e,...t){return cg(e,...t)}function og(e,t,n){const r=Object.assign(Object.assign({},eg()),{[t]:n});return new O("auth","Firebase",r).create(t,{appName:e.name})}function ag(e,t,n){if(!(t instanceof n))throw n.name!==t.constructor.name&&ig(e,"argument-error"),og(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function cg(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return tg.create(e,...t)}function ug(e,t,...n){if(!e)throw cg(t,...n)}function lg(e){const t="INTERNAL ASSERTION FAILED: "+e;throw rg(t),new Error(t)}function hg(e,t){e||lg(t)}const dg=new Map;function fg(e){hg(e instanceof Function,"Expected a class definition");let t=dg.get(e);return t?(hg(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,dg.set(e,t),t)}function pg(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function mg(){return"http:"===gg()||"https:"===gg()}function gg(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class yg{constructor(e,t){this.shortDelay=e,this.longDelay=t,hg(t>e,"Short delay should be less than long delay!"),this.isMobile=A()||D()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(mg()||C()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function vg(e,t){hg(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class wg{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void lg("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void lg("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void lg("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const bg={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},Ig=new yg(3e4,6e4);function _g(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Tg(e,t,n,r,i={}){return Eg(e,i,(async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});const o=U(Object.assign({key:e.config.apiKey},s)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),wg.fetch()(kg(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},i))}))}async function Eg(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},bg),t);try{const t=new Ag(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const s=await i.json();if("needConfirmation"in s)throw Ng(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{const t=i.ok?s.errorMessage:s.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Ng(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw Ng(e,"email-already-in-use",s);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw og(e,a,o);ig(e,a)}}catch(t){if(t instanceof P)throw t;ig(e,"network-request-failed")}}async function Sg(e,t,n,r,i={}){const s=await Tg(e,t,n,r,i);return"mfaPendingCredential"in s&&ig(e,"multi-factor-auth-required",{_serverResponse:s}),s}function kg(e,t,n,r){const i=`${t}${n}?${r}`;return e.config.emulator?vg(e.config,i):`${e.config.apiScheme}://${i}`}class Ag{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(sg(this.auth,"network-request-failed"))),Ig.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ng(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const i=sg(e,t,r);return i.customData._tokenResponse=n,i}function Cg(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Dg(e){return 1e3*Number(e)}function Rg(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return rg("JWT malformed, contained fewer than 3 sections"),null;try{const e=function(e){try{return _.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null}(n);return e?JSON.parse(e):(rg("Failed to decode base64 JWT payload"),null)}catch(e){return rg("Caught error parsing JWT payload as JSON",e),null}}async function xg(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof P&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class Pg{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===e.code&&this.schedule(!0))}this.schedule()}}class Og{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Cg(this.lastLoginAt),this.creationTime=Cg(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Lg(e){var t;const n=e.auth,r=await e.getIdToken(),i=await xg(e,async function(e,t){return Tg(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));ug(null==i?void 0:i.users.length,n,"internal-error");const s=i.users[0];e._notifyReloadListener(s);const o=(null===(t=s.providerUserInfo)||void 0===t?void 0:t.length)?s.providerUserInfo.map((e=>{var{providerId:t}=e,n=Xm(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const l=e.isAnonymous,h=!(e.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!l&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Og(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(e,f)}class Mg{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){ug(e.idToken,"internal-error"),ug(void 0!==e.idToken,"internal-error"),ug(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=Rg(e);return ug(t,"internal-error"),ug(void 0!==t.exp,"internal-error"),ug(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return ug(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:i}=await async function(e,t){const n=await Eg(e,{},(async()=>{const n=U({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=kg(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",wg.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new Mg;return n&&(ug("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(ug("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(ug("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Mg,this.toJSON())}_performRefresh(){return lg("not implemented")}}function Fg(e,t){ug("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Vg{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,i=Xm(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Pg(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new Og(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){const t=await xg(this,this.stsTokenManager.getToken(this.auth,e));return ug(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=G(e),r=await n.getIdToken(t),i=Rg(r);ug(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");const s="object"==typeof i.firebase?i.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:Cg(Dg(i.auth_time)),issuedAtTime:Cg(Dg(i.iat)),expirationTime:Cg(Dg(i.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=G(e);await Lg(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(ug(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new Vg(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){ug(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Lg(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await xg(this,async function(e,t){return Tg(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,i,s,o,a,c,u;const l=null!==(n=t.displayName)&&void 0!==n?n:void 0,h=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(i=t.phoneNumber)&&void 0!==i?i:void 0,f=null!==(s=t.photoURL)&&void 0!==s?s:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,m=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:b,providerData:I,stsTokenManager:_}=t;ug(v&&_,e,"internal-error");const T=Mg.fromJSON(this.name,_);ug("string"==typeof v,e,"internal-error"),Fg(l,e.name),Fg(h,e.name),ug("boolean"==typeof w,e,"internal-error"),ug("boolean"==typeof b,e,"internal-error"),Fg(d,e.name),Fg(f,e.name),Fg(p,e.name),Fg(m,e.name),Fg(g,e.name),Fg(y,e.name);const E=new Vg({uid:v,auth:e,email:h,emailVerified:w,displayName:l,isAnonymous:b,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:g,lastLoginAt:y});return I&&Array.isArray(I)&&(E.providerData=I.map((e=>Object.assign({},e)))),m&&(E._redirectEventId=m),E}static async _fromIdTokenResponse(e,t,n=!1){const r=new Mg;r.updateFromServerResponse(t);const i=new Vg({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await Lg(i),i}}class Ug{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Ug.type="NONE";const qg=Ug;function Bg(e,t,n){return`firebase:${e}:${t}:${n}`}class jg{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=Bg(this.userKey,r.apiKey,i),this.fullPersistenceKey=Bg("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Vg._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new jg(fg(qg),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let i=r[0]||fg(qg);const s=Bg(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(s);if(t){const r=Vg._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return i._shouldAllowMigration&&a.length?(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new jg(i,e,n)):new jg(i,e,n)}}function Kg(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Wg(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if($g(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Qg(t))return"Blackberry";if(Yg(t))return"Webos";if(Gg(t))return"Safari";if((t.includes("chrome/")||zg(t))&&!t.includes("edge/"))return"Chrome";if(Hg(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function $g(e=k()){return/firefox\//i.test(e)}function Gg(e=k()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function zg(e=k()){return/crios\//i.test(e)}function Wg(e=k()){return/iemobile/i.test(e)}function Hg(e=k()){return/android/i.test(e)}function Qg(e=k()){return/blackberry/i.test(e)}function Yg(e=k()){return/webos/i.test(e)}function Jg(e=k()){return/iphone|ipad|ipod/i.test(e)}function Xg(e=k()){return Jg(e)||Hg(e)||Yg(e)||Qg(e)||/windows phone/i.test(e)||Wg(e)}function Zg(e,t=[]){let n;switch(e){case"Browser":n=Kg(k());break;case"Worker":n=`${Kg(k())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Le}/${r}`}class ey{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e.message})}}}class ty{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ry(this),this.idTokenSubscription=new ry(this),this.beforeStateQueue=new ey(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=tg,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=fg(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await jg.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let r=n,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,s=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==s||!(null==o?void 0:o.user)||(r=o.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return ug(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Lg(e)}catch(e){if("auth/network-request-failed"!==e.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?G(e):null;return t&&ug(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&ug(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(fg(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new O("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&fg(e)||this._popupRedirectResolver;ug(t,this,"argument-error"),this.redirectPersistenceManager=await jg.create(this,[fg(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const i="function"==typeof t?t:t.next.bind(t),s=this._isInitialized?Promise.resolve():this._initializationPromise;return ug(s,this,"internal-error"),s.then((()=>i(this.currentUser))),"function"==typeof t?e.addObserver(t,n,r):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return ug(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Zg(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());return n&&(t["X-Firebase-Client"]=n),t}}function ny(e){return G(e)}class ry{constructor(e){this.auth=e,this.observer=null,this.addObserver=j((e=>this.observer=e))}get next(){return ug(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function iy(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function sy(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class oy{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return lg("not implemented")}_getIdTokenResponse(e){return lg("not implemented")}_linkToIdToken(e,t){return lg("not implemented")}_getReauthenticationResolver(e){return lg("not implemented")}}async function ay(e,t){return Tg(e,"POST","/v1/accounts:resetPassword",_g(e,t))}async function cy(e,t){return Tg(e,"POST","/v1/accounts:update",t)}async function uy(e,t){return Tg(e,"POST","/v1/accounts:sendOobCode",_g(e,t))}class ly extends oy{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new ly(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new ly(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return Sg(e,"POST","/v1/accounts:signInWithPassword",_g(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Sg(e,"POST","/v1/accounts:signInWithEmailLink",_g(e,t))}(e,{email:this._email,oobCode:this._password});default:ig(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return cy(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return Sg(e,"POST","/v1/accounts:signInWithEmailLink",_g(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:ig(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function hy(e,t){return Sg(e,"POST","/v1/accounts:signInWithIdp",_g(e,t))}class dy extends oy{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new dy(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):ig("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,i=Xm(t,["providerId","signInMethod"]);if(!n||!r)return null;const s=new dy(n,r);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return hy(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,hy(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,hy(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=U(t)}return e}}const fy={USER_NOT_FOUND:"user-not-found"};class py extends oy{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new py({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new py({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Sg(e,"POST","/v1/accounts:signInWithPhoneNumber",_g(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Sg(e,"POST","/v1/accounts:signInWithPhoneNumber",_g(e,t));if(n.temporaryProof)throw Ng(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Sg(e,"POST","/v1/accounts:signInWithPhoneNumber",_g(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),fy)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new py({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class my{constructor(e){var t,n,r,i,s,o;const a=q(B(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,l=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);ug(c&&u&&l,"argument-error"),this.apiKey=c,this.operation=l,this.code=u,this.continueUrl=null!==(i=a.continueUrl)&&void 0!==i?i:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=q(B(e)).link,n=t?q(B(t)).deep_link_id:null,r=q(B(e)).deep_link_id;return(r?q(B(r)).link:null)||r||n||t||e}(e);try{return new my(t)}catch(e){return null}}}class gy{constructor(){this.providerId=gy.PROVIDER_ID}static credential(e,t){return ly._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=my.parseLink(t);return ug(n,"argument-error"),ly._fromEmailAndCode(e,n.code,n.tenantId)}}gy.PROVIDER_ID="password",gy.EMAIL_PASSWORD_SIGN_IN_METHOD="password",gy.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class yy{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class vy extends yy{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class wy extends vy{static credentialFromJSON(e){const t="string"==typeof e?JSON.parse(e):e;return ug("providerId"in t&&"signInMethod"in t,"argument-error"),dy._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return ug(e.idToken||e.accessToken,"argument-error"),dy._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return wy.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return wy.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n,oauthTokenSecret:r,pendingToken:i,nonce:s,providerId:o}=e;if(!(n||r||t||i))return null;if(!o)return null;try{return new wy(o)._credential({idToken:t,accessToken:n,nonce:s,pendingToken:i})}catch(e){return null}}}class by extends vy{constructor(){super("facebook.com")}static credential(e){return dy._fromParams({providerId:by.PROVIDER_ID,signInMethod:by.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return by.credentialFromTaggedObject(e)}static credentialFromError(e){return by.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return by.credential(e.oauthAccessToken)}catch(e){return null}}}by.FACEBOOK_SIGN_IN_METHOD="facebook.com",by.PROVIDER_ID="facebook.com";class Iy extends vy{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return dy._fromParams({providerId:Iy.PROVIDER_ID,signInMethod:Iy.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Iy.credentialFromTaggedObject(e)}static credentialFromError(e){return Iy.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Iy.credential(t,n)}catch(e){return null}}}Iy.GOOGLE_SIGN_IN_METHOD="google.com",Iy.PROVIDER_ID="google.com";class _y extends vy{constructor(){super("github.com")}static credential(e){return dy._fromParams({providerId:_y.PROVIDER_ID,signInMethod:_y.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return _y.credentialFromTaggedObject(e)}static credentialFromError(e){return _y.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return _y.credential(e.oauthAccessToken)}catch(e){return null}}}_y.GITHUB_SIGN_IN_METHOD="github.com",_y.PROVIDER_ID="github.com";class Ty extends oy{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return hy(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,hy(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,hy(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r,pendingToken:i}=t;return n&&r&&i&&n===r?new Ty(n,i):null}static _create(e,t){return new Ty(e,t)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Ey extends yy{constructor(e){ug(e.startsWith("saml."),"argument-error"),super(e)}static credentialFromResult(e){return Ey.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Ey.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Ty.fromJSON(e);return ug(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:n}=e;if(!t||!n)return null;try{return Ty._create(n,t)}catch(e){return null}}}class Sy extends vy{constructor(){super("twitter.com")}static credential(e,t){return dy._fromParams({providerId:Sy.PROVIDER_ID,signInMethod:Sy.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Sy.credentialFromTaggedObject(e)}static credentialFromError(e){return Sy.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return Sy.credential(t,n)}catch(e){return null}}}async function ky(e,t){return Sg(e,"POST","/v1/accounts:signUp",_g(e,t))}Sy.TWITTER_SIGN_IN_METHOD="twitter.com",Sy.PROVIDER_ID="twitter.com";class Ay{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const i=await Vg._fromIdTokenResponse(e,n,r),s=Ny(n);return new Ay({user:i,providerId:s,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=Ny(n);return new Ay({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function Ny(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Cy extends P{constructor(e,t,n,r){var i;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,Cy.prototype),this.customData={appName:e.name,tenantId:null!==(i=e.tenantId)&&void 0!==i?i:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new Cy(e,t,n,r)}}function Dy(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Cy._fromErrorAndOperation(e,n,t,r);throw n}))}function Ry(e){return new Set(e.map((({providerId:e})=>e)).filter((e=>!!e)))}async function xy(e,t,n=!1){const r=await xg(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Ay._forOperation(e,"link",r)}async function Py(e,t,n){await Lg(t);const r=!1===e?"provider-already-linked":"no-such-provider";ug(Ry(t.providerData).has(n)===e,t.auth,r)}async function Oy(e,t,n=!1){const{auth:r}=e,i="reauthenticate";try{const s=await xg(e,Dy(r,i,t,e),n);ug(s.idToken,r,"internal-error");const o=Rg(s.idToken);ug(o,r,"internal-error");const{sub:a}=o;return ug(e.uid===a,r,"user-mismatch"),Ay._forOperation(e,i,s)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&ig(r,"user-mismatch"),e}}async function Ly(e,t,n=!1){const r="signIn",i=await Dy(e,r,t),s=await Ay._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function My(e,t){return Ly(ny(e),t)}async function Fy(e,t){const n=G(e);return await Py(!1,n,t.providerId),xy(n,t)}async function Vy(e,t){return Oy(G(e),t)}class Uy{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?qy._fromServerResponse(e,t):ig(e,"internal-error")}}class qy extends Uy{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new qy(t)}}function By(e,t,n){var r;ug((null===(r=n.url)||void 0===r?void 0:r.length)>0,e,"invalid-continue-uri"),ug(void 0===n.dynamicLinkDomain||n.dynamicLinkDomain.length>0,e,"invalid-dynamic-link-domain"),t.continueUrl=n.url,t.dynamicLinkDomain=n.dynamicLinkDomain,t.canHandleCodeInApp=n.handleCodeInApp,n.iOS&&(ug(n.iOS.bundleId.length>0,e,"missing-ios-bundle-id"),t.iOSBundleId=n.iOS.bundleId),n.android&&(ug(n.android.packageName.length>0,e,"missing-android-pkg-name"),t.androidInstallApp=n.android.installApp,t.androidMinimumVersionCode=n.android.minimumVersion,t.androidPackageName=n.android.packageName)}async function jy(e,t){const n=G(e),r=await ay(n,{oobCode:t}),i=r.requestType;switch(ug(i,n,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":ug(r.newEmail,n,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":ug(r.mfaInfo,n,"internal-error");default:ug(r.email,n,"internal-error")}let s=null;return r.mfaInfo&&(s=Uy._fromServerResponse(ny(n),r.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.newEmail:r.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===r.requestType?r.email:r.newEmail)||null,multiFactorInfo:s},operation:i}}async function Ky(e,t,n){const{auth:r}=e,i={idToken:await e.getIdToken(),returnSecureToken:!0};t&&(i.email=t),n&&(i.password=n);const s=await xg(e,cy(r,i));await e._updateTokensIfNecessary(s,!0)}class $y{constructor(e,t,n={}){this.isNewUser=e,this.providerId=t,this.profile=n}}class Gy extends $y{constructor(e,t,n,r){super(e,t,n),this.username=r}}class zy extends $y{constructor(e,t){super(e,"facebook.com",t)}}class Wy extends Gy{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class Hy extends $y{constructor(e,t){super(e,"google.com",t)}}class Qy extends Gy{constructor(e,t,n){super(e,"twitter.com",t,n)}}function Yy(e){const{user:t,_tokenResponse:n}=e;return t.isAnonymous&&!n?{providerId:null,isNewUser:!1,profile:null}:function(e){var t,n;if(!e)return null;const{providerId:r}=e,i=e.rawUserInfo?JSON.parse(e.rawUserInfo):{},s=e.isNewUser||"identitytoolkit#SignupNewUserResponse"===e.kind;if(!r&&(null==e?void 0:e.idToken)){const r=null===(n=null===(t=Rg(e.idToken))||void 0===t?void 0:t.firebase)||void 0===n?void 0:n.sign_in_provider;if(r)return new $y(s,"anonymous"!==r&&"custom"!==r?r:null)}if(!r)return null;switch(r){case"facebook.com":return new zy(s,i);case"github.com":return new Wy(s,i);case"google.com":return new Hy(s,i);case"twitter.com":return new Qy(s,i,e.screenName||null);case"custom":case"anonymous":return new $y(s,null);default:return new $y(s,r,i)}}(n)}class Jy{constructor(e,t){this.type=e,this.credential=t}static _fromIdtoken(e){return new Jy("enroll",e)}static _fromMfaPendingCredential(e){return new Jy("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,n;if(null==e?void 0:e.multiFactorSession){if(null===(t=e.multiFactorSession)||void 0===t?void 0:t.pendingCredential)return Jy._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(null===(n=e.multiFactorSession)||void 0===n?void 0:n.idToken)return Jy._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Xy{constructor(e,t,n){this.session=e,this.hints=t,this.signInResolver=n}static _fromError(e,t){const n=ny(e),r=t.customData._serverResponse,i=(r.mfaInfo||[]).map((e=>Uy._fromServerResponse(n,e)));ug(r.mfaPendingCredential,n,"internal-error");const s=Jy._fromMfaPendingCredential(r.mfaPendingCredential);return new Xy(s,i,(async e=>{const i=await e._process(n,s);delete r.mfaInfo,delete r.mfaPendingCredential;const o=Object.assign(Object.assign({},r),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":const e=await Ay._fromIdTokenResponse(n,t.operationType,o);return await n._updateCurrentUser(e.user),e;case"reauthenticate":return ug(t.user,n,"internal-error"),Ay._forOperation(t.user,t.operationType,o);default:ig(n,"internal-error")}}))}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}class Zy{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload((t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map((t=>Uy._fromServerResponse(e.auth,t))))}))}static _fromUser(e){return new Zy(e)}async getSession(){return Jy._fromIdtoken(await this.user.getIdToken())}async enroll(e,t){const n=e,r=await this.getSession(),i=await xg(this.user,n._process(this.user.auth,r,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){const t="string"==typeof e?e:e.uid,n=await this.user.getIdToken(),r=await xg(this.user,(i=this.user.auth,s={idToken:n,mfaEnrollmentId:t},Tg(i,"POST","/v2/accounts/mfaEnrollment:withdraw",_g(i,s))));var i,s;this.enrolledFactors=this.enrolledFactors.filter((({uid:e})=>e!==t)),await this.user._updateTokensIfNecessary(r);try{await this.user.reload()}catch(e){if("auth/user-token-expired"!==e.code)throw e}}}const ev=new WeakMap,tv="__sak";class nv{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(tv,"1"),this.storage.removeItem(tv),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class rv extends nv{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=k();return Gg(e)||Jg(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Xg(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},i=this.storage.getItem(n);R()&&10===document.documentMode&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}rv.type="LOCAL";const iv=rv;class sv extends nv{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}sv.type="SESSION";const ov=sv;class av{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new av(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:i}=t.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(s).map((async e=>e(t.origin,i))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function cv(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}av.receivers=[];class uv{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let i,s;return new Promise(((o,a)=>{const c=cv("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),i=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(i),o(t.data.response);break;default:clearTimeout(u),clearTimeout(i),a(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function lv(){return window}function hv(){return void 0!==lv().WorkerGlobalScope&&"function"==typeof lv().importScripts}const dv="firebaseLocalStorageDb",fv="firebaseLocalStorage",pv="fbase_key";class mv{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function gv(e,t){return e.transaction([fv],t?"readwrite":"readonly").objectStore(fv)}function yv(){const e=indexedDB.open(dv,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(fv,{keyPath:pv})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(fv)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(dv);return new mv(e).toPromise()}(),t(await yv()))}))}))}async function vv(e,t,n){const r=gv(e,!0).put({[pv]:t,value:n});return new mv(r).toPromise()}function wv(e,t){const n=gv(e,!0).delete(t);return new mv(n).toPromise()}class bv{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await yv()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return hv()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=av._getInstance(hv()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new uv(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&function(){var e;return(null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await yv();return await vv(e,tv,"1"),await wv(e,tv),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>vv(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=gv(e,!1).get(t),r=await new mv(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>wv(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=gv(e,!1).getAll();return new mv(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}bv.type="LOCAL";const Iv=bv;function _v(e){return new Promise(((t,n)=>{const r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=sg("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",function(){var e,t;return null!==(t=null===(e=document.getElementsByTagName("head"))||void 0===e?void 0:e[0])&&void 0!==t?t:document}().appendChild(r)}))}function Tv(e){return`__${e}${Math.floor(1e6*Math.random())}`}const Ev=1e12;class Sv{constructor(e){this.auth=e,this.counter=Ev,this._widgets=new Map}render(e,t){const n=this.counter;return this._widgets.set(n,new kv(e,this.auth.name,t||{})),this.counter++,n}reset(e){var t;const n=e||Ev;null===(t=this._widgets.get(n))||void 0===t||t.delete(),this._widgets.delete(n)}getResponse(e){var t;const n=e||Ev;return(null===(t=this._widgets.get(n))||void 0===t?void 0:t.getResponse())||""}async execute(e){var t;const n=e||Ev;return null===(t=this._widgets.get(n))||void 0===t||t.execute(),""}}class kv{constructor(e,t,n){this.params=n,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const r="string"==typeof e?document.getElementById(e):e;ug(r,"argument-error",{appName:t}),this.container=r,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),this.timerId||(this.timerId=window.setTimeout((()=>{this.responseToken=function(e){const t=[],n="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let e=0;e<50;e++)t.push(n.charAt(Math.floor(Math.random()*n.length)));return t.join("")}();const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch(e){}this.timerId=window.setTimeout((()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch(e){}this.isVisible&&this.execute()}),6e4)}),500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Av=Tv("rcb"),Nv=new yg(3e4,6e4);class Cv{constructor(){this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!lv().grecaptcha}load(e,t=""){return ug(function(e){return e.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(e)}(t),e,"argument-error"),this.shouldResolveImmediately(t)?Promise.resolve(lv().grecaptcha):new Promise(((n,r)=>{const i=lv().setTimeout((()=>{r(sg(e,"network-request-failed"))}),Nv.get());lv()[Av]=()=>{lv().clearTimeout(i),delete lv()[Av];const s=lv().grecaptcha;if(!s)return void r(sg(e,"internal-error"));const o=s.render;s.render=(e,t)=>{const n=o(e,t);return this.counter++,n},this.hostLanguage=t,n(s)},_v(`https://www.google.com/recaptcha/api.js??${U({onload:Av,render:"explicit",hl:t})}`).catch((()=>{clearTimeout(i),r(sg(e,"internal-error"))}))}))}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){return!!lv().grecaptcha&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Dv{async load(e){return new Sv(e)}clearedOneInstance(){}}const Rv="recaptcha",xv={theme:"light",type:"image"};class Pv{constructor(e,t=Object.assign({},xv),n){this.parameters=t,this.type=Rv,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=ny(n),this.isInvisible="invisible"===this.parameters.size,ug("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const r="string"==typeof e?document.getElementById(e):e;ug(r,this.auth,"argument-error"),this.container=r,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Dv:new Cv,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha();return t.getResponse(e)||new Promise((n=>{const r=e=>{e&&(this.tokenChangeListeners.delete(r),n(e))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)}))}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch((e=>{throw this.renderPromise=null,e}))),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach((e=>{this.container.removeChild(e)}))}validateStartingState(){ug(!this.parameters.sitekey,this.auth,"argument-error"),ug(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),ug("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach((e=>e(t))),"function"==typeof e)e(t);else if("string"==typeof e){const n=lv()[e];"function"==typeof n&&n(t)}}}assertNotDestroyed(){ug(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){ug(mg()&&!hv(),this.auth,"internal-error"),await function(){let e=null;return new Promise((t=>{"complete"!==document.readyState?(e=()=>t(),window.addEventListener("load",e)):t()})).catch((t=>{throw e&&window.removeEventListener("load",e),t}))}(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await async function(e){return(await Tg(e,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}(this.auth);ug(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return ug(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Ov{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=py._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function Lv(e,t,n){var r;const i=await n.verify();try{let s;if(ug("string"==typeof i,e,"argument-error"),ug(n.type===Rv,e,"argument-error"),s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){ug("enroll"===t.type,e,"internal-error");const n=await function(e,t){return Tg(e,"POST","/v2/accounts/mfaEnrollment:start",_g(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}});return n.phoneSessionInfo.sessionInfo}{ug("signin"===t.type,e,"internal-error");const n=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;ug(n,e,"missing-multi-factor-info");const o=await function(e,t){return Tg(e,"POST","/v2/accounts/mfaSignIn:start",_g(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:i}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return Tg(e,"POST","/v1/accounts:sendVerificationCode",_g(e,t))}(e,{phoneNumber:s.phoneNumber,recaptchaToken:i});return t}}finally{n._reset()}}class Mv{constructor(e){this.providerId=Mv.PROVIDER_ID,this.auth=ny(e)}verifyPhoneNumber(e,t){return Lv(this.auth,e,G(t))}static credential(e,t){return py._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Mv.credentialFromTaggedObject(t)}static credentialFromError(e){return Mv.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?py._fromTokenResponse(t,n):null}}function Fv(e,t){return t?fg(t):(ug(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}Mv.PROVIDER_ID="phone",Mv.PHONE_SIGN_IN_METHOD="phone";class Vv extends oy{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return hy(e,this._buildIdpRequest())}_linkToIdToken(e,t){return hy(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return hy(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Uv(e){return Ly(e.auth,new Vv(e),e.bypassAuthState)}function qv(e){const{auth:t,user:n}=e;return ug(n,t,"internal-error"),Oy(n,new Vv(e),e.bypassAuthState)}async function Bv(e){const{auth:t,user:n}=e;return ug(n,t,"internal-error"),xy(n,new Vv(e),e.bypassAuthState)}class jv{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Uv;case"linkViaPopup":case"linkViaRedirect":return Bv;case"reauthViaPopup":case"reauthViaRedirect":return qv;default:ig(this.auth,"internal-error")}}resolve(e){hg(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){hg(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Kv=new yg(2e3,1e4);class $v extends jv{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,$v.currentPopupAction&&$v.currentPopupAction.cancel(),$v.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return ug(e,this.auth,"internal-error"),e}async onExecution(){hg(1===this.filter.length,"Popup operations only handle one event");const e=cv();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(sg(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(sg(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,$v.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(sg(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(e,Kv.get())};e()}}$v.currentPopupAction=null;const Gv=new Map;class zv extends jv{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Gv.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=Yv(t),r=Qv(e);if(!await r._isAvailable())return!1;const i="true"===await r._get(n);return await r._remove(n),i}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Gv.set(this.auth._key(),e)}return this.bypassAuthState||Gv.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function Wv(e,t){return Qv(e)._set(Yv(t),"true")}function Hv(e,t){Gv.set(e._key(),t)}function Qv(e){return fg(e._redirectPersistence)}function Yv(e){return Bg("pendingRedirect",e.config.apiKey,e.name)}async function Jv(e,t,n=!1){const r=ny(e),i=Fv(r,t),s=new zv(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}async function Xv(e){const t=cv(`${e.uid}:::`);return e._redirectEventId=t,await e.auth._setRedirectUser(e),await e.auth._persistUserIfCurrent(e),t}class Zv{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return tw(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!tw(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(sg(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(ew(e))}saveEventToCache(e){this.cachedEventUids.add(ew(e)),this.lastProcessedEventTime=Date.now()}}function ew(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function tw({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}async function nw(e,t={}){return Tg(e,"GET","/v1/projects",t)}const rw=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,iw=/^https?/;function sw(e){const t=pg(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!iw.test(n))return!1;if(rw.test(e))return r===e;const i=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const ow=new yg(3e4,6e4);function aw(){const e=lv().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let cw=null;function uw(e){return cw=cw||function(e){return new Promise(((t,n)=>{var r,i,s;function o(){aw(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{aw(),n(sg(e,"network-request-failed"))},timeout:ow.get()})}if(null===(i=null===(r=lv().gapi)||void 0===r?void 0:r.iframes)||void 0===i?void 0:i.Iframe)t(gapi.iframes.getContext());else{if(!(null===(s=lv().gapi)||void 0===s?void 0:s.load)){const t=Tv("iframefcb");return lv()[t]=()=>{gapi.load?o():n(sg(e,"network-request-failed"))},_v(`https://apis.google.com/js/api.js?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw cw=null,e}))}(e),cw}const lw=new yg(5e3,15e3),hw={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},dw=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function fw(e){const t=e.config;ug(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?vg(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:Le},i=dw.get(e.config.apiHost);i&&(r.eid=i);const s=e._getFrameworks();return s.length&&(r.fw=s.join(",")),`${n}?${U(r).slice(1)}`}const pw={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class mw{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}function gw(e,t,n,r,i,s){ug(e.config.authDomain,e,"auth-domain-config-required"),ug(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:Le,eventId:i};if(t instanceof yy){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(s||{}))o[e]=t}if(t instanceof vy){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];return`${function({config:e}){return e.emulator?vg(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${U(a).slice(1)}`}const yw="webStorageSupport";class vw extends class{constructor(e){this.factorId=e}_process(e,t,n){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,n);case"signin":return this._finalizeSignIn(e,t.credential);default:return lg("unexpected MultiFactorSessionType")}}}{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new vw(e)}_finalizeEnroll(e,t,n){return function(e,t){return Tg(e,"POST","/v2/accounts/mfaEnrollment:finalize",_g(e,t))}(e,{idToken:t,displayName:n,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return function(e,t){return Tg(e,"POST","/v2/accounts/mfaSignIn:finalize",_g(e,t))}(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class ww{constructor(){}static assertion(e){return vw._fromCredential(e)}}ww.FACTOR_ID="phone";var bw,Iw="@firebase/auth",_w="0.20.1";class Tw{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{var n;e((null===(n=t)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){ug(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Ew(){return window}bw="Browser",Ce(new z("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),{apiKey:i,authDomain:s}=n.options;return((e,n)=>{ug(i&&!i.includes(":"),"invalid-api-key",{appName:e.name}),ug(!(null==s?void 0:s.includes(":")),"argument-error",{appName:e.name});const r={apiKey:i,authDomain:s,clientPlatform:bw,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Zg(bw)},o=new ty(e,n,r);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(fg);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(o,t),o})(n,r)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),Ce(new z("auth-internal",(e=>{return t=ny(e.getProvider("auth").getImmediate()),new Tw(t);var t}),"PRIVATE").setInstantiationMode("EXPLICIT")),qe(Iw,_w,void 0),qe(Iw,_w,"esm2017");class Sw extends Zv{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise((e=>{this.resolveInialized=e}))}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach((t=>t(e))),super.onEvent(e)}async initialized(){await this.initPromise}}async function kw(e){const t=await Nw()._get(Cw(e));return t&&await Nw()._remove(Cw(e)),t}function Aw(){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<20;n++){const n=Math.floor(Math.random()*t.length);e.push(t.charAt(n))}return e.join("")}function Nw(){return fg(iv)}function Cw(e){return Bg("authEvent",e.config.apiKey,e.name)}function Dw(e){if(!(null==e?void 0:e.includes("?")))return{};const[t,...n]=e.split("?");return q(n.join("?"))}function Rw(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:sg("no-auth-event")}}function xw(){var e;return(null===(e=null===self||void 0===self?void 0:self.location)||void 0===e?void 0:e.protocol)||null}function Pw(e=k()){return!("file:"!==xw()&&"ionic:"!==xw()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function Ow(){try{const e=self.localStorage,t=cv();if(e)return e.setItem(t,"1"),e.removeItem(t),!function(e=k()){return R()&&11===(null===document||void 0===document?void 0:document.documentMode)||function(e=k()){return/Edge\/\d+/.test(e)}(e)}()||x()}catch(e){return Lw()&&x()}return!1}function Lw(){return void 0!==i.g&&"WorkerGlobalScope"in i.g&&"importScripts"in i.g}function Mw(){return("http:"===xw()||"https:"===xw()||C()||Pw())&&!(D()||N())&&Ow()&&!Lw()}function Fw(){return Pw()&&"undefined"!=typeof document}const Vw={LOCAL:"local",NONE:"none",SESSION:"session"},Uw=ug,qw="persistence";async function Bw(e){await e._initializationPromise;const t=jw(),n=Bg(qw,e.config.apiKey,e.name);t&&t.setItem(n,e._getPersistence())}function jw(){var e;try{return(null===(e="undefined"!=typeof window?window:null)||void 0===e?void 0:e.sessionStorage)||null}catch(e){return null}}const Kw=ug;class $w{constructor(){this.browserResolver=fg(class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ov,this._completeRedirectFn=Jv,this._overrideRedirectResult=Hv}async _openPopup(e,t,n,r){var i;return hg(null===(i=this.eventManagers[e._key()])||void 0===i?void 0:i.manager,"_initialize() not called before _openPopup()"),function(e,t,n,r=500,i=600){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},pw),{width:r.toString(),height:i.toString(),top:s,left:o}),u=k().toLowerCase();n&&(a=zg(u)?"_blank":n),$g(u)&&(t=t||"http://localhost",c.scrollbars="yes");const l=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=k()){var t;return Jg(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new mw(null);const h=window.open(t||"",a,l);ug(h,e,"popup-blocked");try{h.focus()}catch(e){}return new mw(h)}(e,gw(e,t,n,pg(),r),cv())}async _openRedirect(e,t,n,r){var i;return await this._originValidation(e),i=gw(e,t,n,pg(),r),lv().location.href=i,new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(hg(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await uw(e),n=lv().gapi;return ug(n,e,"internal-error"),t.open({where:document.body,url:fw(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:hw,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const i=sg(e,"network-request-failed"),s=lv().setTimeout((()=>{r(i)}),lw.get());function o(){lv().clearTimeout(s),n(t)}t.ping(o).then(o,(()=>{r(i)}))}))))}(e),n=new Zv(e);return t.register("authEvent",(t=>(ug(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(yw,{type:yw},(n=>{var r;const i=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r.webStorageSupport;void 0!==i&&t(!!i),ig(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await nw(e);for(const e of t)try{if(sw(e))return}catch(e){}ig(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Xg()||Gg()||Jg()}}),this.cordovaResolver=fg(class{constructor(){this._redirectPersistence=ov,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Jv,this._overrideRedirectResult=Hv}async _initialize(e){const t=e._key();let n=this.eventManagers.get(t);return n||(n=new Sw(e),this.eventManagers.set(t,n),this.attachCallbackListeners(e,n)),n}_openPopup(e){ig(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,n,r){!function(e){var t,n,r,i,s,o,a,c,u,l;const h=Ew();ug("function"==typeof(null===(t=null==h?void 0:h.universalLinks)||void 0===t?void 0:t.subscribe),e,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),ug(void 0!==(null===(n=null==h?void 0:h.BuildInfo)||void 0===n?void 0:n.packageName),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),ug("function"==typeof(null===(s=null===(i=null===(r=null==h?void 0:h.cordova)||void 0===r?void 0:r.plugins)||void 0===i?void 0:i.browsertab)||void 0===s?void 0:s.openUrl),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),ug("function"==typeof(null===(c=null===(a=null===(o=null==h?void 0:h.cordova)||void 0===o?void 0:o.plugins)||void 0===a?void 0:a.browsertab)||void 0===c?void 0:c.isAvailable),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),ug("function"==typeof(null===(l=null===(u=null==h?void 0:h.cordova)||void 0===u?void 0:u.InAppBrowser)||void 0===l?void 0:l.open),e,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(e);const i=await this._initialize(e);await i.initialized(),i.resetRedirect(),Gv.clear(),await this._originValidation(e);const s=function(e,t,n=null){return{type:t,eventId:n,urlResponse:null,sessionId:Aw(),postBody:null,tenantId:e.tenantId,error:sg(e,"no-auth-event")}}(e,n,r);await function(e,t){return Nw()._set(Cw(e),t)}(e,s);const o=await async function(e,t,n){var r;const{BuildInfo:i}=Ew();hg(t.sessionId,"AuthEvent did not contain a session ID");const s=await async function(e){const t=function(e){if(hg(/[0-9a-zA-Z]+/.test(e),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e);const t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let t=0;t<e.length;t++)n[t]=e.charCodeAt(t);return n}(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}(t.sessionId),o={};return Jg()?o.ibi=i.packageName:Hg()?o.apn=i.packageName:ig(e,"operation-not-supported-in-this-environment"),i.displayName&&(o.appDisplayName=i.displayName),o.sessionId=s,gw(e,n,t.type,void 0,null!==(r=t.eventId)&&void 0!==r?r:void 0,o)}(e,s,t);return async function(e,t,n){const{cordova:r}=Ew();let i=()=>{};try{await new Promise(((s,o)=>{let a=null;function c(){var e;s();const t=null===(e=r.plugins.browsertab)||void 0===e?void 0:e.close;"function"==typeof t&&t(),"function"==typeof(null==n?void 0:n.close)&&n.close()}function u(){a||(a=window.setTimeout((()=>{o(sg(e,"redirect-cancelled-by-user"))}),2e3))}function l(){"visible"===(null===document||void 0===document?void 0:document.visibilityState)&&u()}t.addPassiveListener(c),document.addEventListener("resume",u,!1),Hg()&&document.addEventListener("visibilitychange",l,!1),i=()=>{t.removePassiveListener(c),document.removeEventListener("resume",u,!1),document.removeEventListener("visibilitychange",l,!1),a&&window.clearTimeout(a)}}))}finally{i()}}(e,i,await function(e){const{cordova:t}=Ew();return new Promise((n=>{t.plugins.browsertab.isAvailable((r=>{let i=null;r?t.plugins.browsertab.openUrl(e):i=t.InAppBrowser.open(e,function(e=k()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(e)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(e)}()?"_blank":"_system","location=yes"),n(i)}))}))}(o))}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){const{BuildInfo:t}=Ew(),n={};Jg()?n.iosBundleId=t.packageName:Hg()?n.androidPackageName=t.packageName:ig(e,"operation-not-supported-in-this-environment"),await nw(e,n)}(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:n,handleOpenURL:r,BuildInfo:i}=Ew(),s=setTimeout((async()=>{await kw(e),t.onEvent(Rw())}),500),o=async n=>{clearTimeout(s);const r=await kw(e);let i=null;r&&(null==n?void 0:n.url)&&(i=function(e,t){var n,r;const i=function(e){const t=Dw(e),n=t.link?decodeURIComponent(t.link):void 0,r=Dw(n).link,i=t.deep_link_id?decodeURIComponent(t.deep_link_id):void 0;return Dw(i).link||i||r||n||e}(t);if(i.includes("/__/auth/callback")){const t=Dw(i),s=t.firebaseError?function(e){try{return JSON.parse(e)}catch(e){return null}}(decodeURIComponent(t.firebaseError)):null,o=null===(r=null===(n=null==s?void 0:s.code)||void 0===n?void 0:n.split("auth/"))||void 0===r?void 0:r[1],a=o?sg(o):null;return a?{type:e.type,eventId:e.eventId,tenantId:e.tenantId,error:a,urlResponse:null,sessionId:null,postBody:null}:{type:e.type,eventId:e.eventId,tenantId:e.tenantId,sessionId:e.sessionId,urlResponse:i,postBody:null}}return null}(r,n.url)),t.onEvent(i||Rw())};void 0!==n&&"function"==typeof n.subscribe&&n.subscribe(null,o);const a=r,c=`${i.packageName.toLowerCase()}://`;Ew().handleOpenURL=async e=>{if(e.toLowerCase().startsWith(c)&&o({url:e}),"function"==typeof a)try{a(e)}catch(e){console.error(e)}}}}),this.underlyingResolver=null,this._redirectPersistence=ov,this._completeRedirectFn=Jv,this._overrideRedirectResult=Hv}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,n,r)}async _openRedirect(e,t,n,r){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,n,r)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Fw()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Kw(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await async function(){return!!Fw()&&new Promise((e=>{const t=setTimeout((()=>{e(!1)}),1e3);document.addEventListener("deviceready",(()=>{clearTimeout(t),e(!0)}))}))}();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function Gw(e){return e.unwrap()}function zw(e){const{_tokenResponse:t}=e instanceof P?e.customData:e;if(!t)return null;if(!(e instanceof P)&&"temporaryProof"in t&&"phoneNumber"in t)return Mv.credentialFromResult(e);const n=t.providerId;if(!n||"password"===n)return null;let r;switch(n){case"google.com":r=Iy;break;case"facebook.com":r=by;break;case"github.com":r=_y;break;case"twitter.com":r=Sy;break;default:const{oauthIdToken:e,oauthAccessToken:i,oauthTokenSecret:s,pendingToken:o,nonce:a}=t;return i||s||e||o?o?n.startsWith("saml.")?Ty._create(n,o):dy._fromParams({providerId:n,signInMethod:n,pendingToken:o,idToken:e,accessToken:i}):new wy(n).credential({idToken:e,accessToken:i,rawNonce:a}):null}return e instanceof P?r.credentialFromError(e):r.credentialFromResult(e)}function Ww(e,t){return t.catch((t=>{throw t instanceof P&&function(e,t){var n;const r=null===(n=t.customData)||void 0===n?void 0:n._tokenResponse;if("auth/multi-factor-auth-required"===t.code)t.resolver=new Qw(e,function(e,t){var n;const r=G(e),i=t;return ug(t.customData.operationType,r,"argument-error"),ug(null===(n=i.customData._serverResponse)||void 0===n?void 0:n.mfaPendingCredential,r,"argument-error"),Xy._fromError(r,i)}(e,t));else if(r){const e=zw(t),n=t;e&&(n.credential=e,n.tenantId=r.tenantId||void 0,n.email=r.email||void 0,n.phoneNumber=r.phoneNumber||void 0)}}(e,t),t})).then((e=>{const t=e.operationType,n=e.user;return{operationType:t,credential:(r=e,zw(r)),additionalUserInfo:Yy(e),user:Yw.getOrCreate(n)};var r}))}async function Hw(e,t){const n=await t;return{verificationId:n.verificationId,confirm:t=>Ww(e,n.confirm(t))}}class Qw{constructor(e,t){this.resolver=t,this.auth=e.wrapped()}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Ww(Gw(this.auth),this.resolver.resolveSignIn(e))}}class Yw{constructor(e){this._delegate=e,this.multiFactor=function(e){const t=G(e);return ev.has(t)||ev.set(t,Zy._fromUser(t)),ev.get(t)}(e)}static getOrCreate(e){return Yw.USER_MAP.has(e)||Yw.USER_MAP.set(e,new Yw(e)),Yw.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return Ww(this.auth,Fy(this._delegate,e))}async linkWithPhoneNumber(e,t){return Hw(this.auth,async function(e,t,n){const r=G(e);await Py(!1,r,"phone");const i=await Lv(r.auth,t,G(n));return new Ov(i,(e=>Fy(r,e)))}(this._delegate,e,t))}async linkWithPopup(e){return Ww(this.auth,async function(e,t,n){const r=G(e);ag(r.auth,t,yy);const i=Fv(r.auth,n);return new $v(r.auth,"linkViaPopup",t,i,r).executeNotNull()}(this._delegate,e,$w))}async linkWithRedirect(e){return await Bw(ny(this.auth)),function(e,t,n){return async function(e,t,n){const r=G(e);ag(r.auth,t,yy);const i=Fv(r.auth,n);await Py(!1,r,t.providerId),await Wv(i,r.auth);const s=await Xv(r);return i._openRedirect(r.auth,t,"linkViaRedirect",s)}(e,t,n)}(this._delegate,e,$w)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return Ww(this.auth,Vy(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return Hw(this.auth,async function(e,t,n){const r=G(e),i=await Lv(r.auth,t,G(n));return new Ov(i,(e=>Vy(r,e)))}(this._delegate,e,t))}reauthenticateWithPopup(e){return Ww(this.auth,async function(e,t,n){const r=G(e);ag(r.auth,t,yy);const i=Fv(r.auth,n);return new $v(r.auth,"reauthViaPopup",t,i,r).executeNotNull()}(this._delegate,e,$w))}async reauthenticateWithRedirect(e){return await Bw(ny(this.auth)),function(e,t,n){return async function(e,t,n){const r=G(e);ag(r.auth,t,yy);const i=Fv(r.auth,n);await Wv(i,r.auth);const s=await Xv(r);return i._openRedirect(r.auth,t,"reauthViaRedirect",s)}(e,t,n)}(this._delegate,e,$w)}sendEmailVerification(e){return async function(e,t){const n=G(e),r={requestType:"VERIFY_EMAIL",idToken:await e.getIdToken()};t&&By(n.auth,r,t);const{email:i}=await async function(e,t){return uy(e,t)}(n.auth,r);i!==e.email&&await e.reload()}(this._delegate,e)}async unlink(e){return await async function(e,t){const n=G(e);await Py(!0,n,t);const{providerUserInfo:r}=await async function(e,t){return Tg(e,"POST","/v1/accounts:update",t)}(n.auth,{idToken:await n.getIdToken(),deleteProvider:[t]}),i=Ry(r||[]);return n.providerData=n.providerData.filter((e=>i.has(e.providerId))),i.has("phone")||(n.phoneNumber=null),await n.auth._persistUserIfCurrent(n),n}(this._delegate,e),this}updateEmail(e){return function(e,t){return Ky(G(e),t,null)}(this._delegate,e)}updatePassword(e){return function(e,t){return Ky(G(e),null,t)}(this._delegate,e)}updatePhoneNumber(e){return async function(e,t){await xy(G(e),t)}(this._delegate,e)}updateProfile(e){return async function(e,{displayName:t,photoURL:n}){if(void 0===t&&void 0===n)return;const r=G(e),i={idToken:await r.getIdToken(),displayName:t,photoUrl:n,returnSecureToken:!0},s=await xg(r,async function(e,t){return Tg(e,"POST","/v1/accounts:update",t)}(r.auth,i));r.displayName=s.displayName||null,r.photoURL=s.photoUrl||null;const o=r.providerData.find((({providerId:e})=>"password"===e));o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),await r._updateTokensIfNecessary(s)}(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return async function(e,t,n){const r=G(e),i={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await e.getIdToken(),newEmail:t};n&&By(r.auth,i,n);const{email:s}=await async function(e,t){return uy(e,t)}(r.auth,i);s!==e.email&&await e.reload()}(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Yw.USER_MAP=new WeakMap;const Jw=ug;class Xw{constructor(e,t){if(this.app=e,t.isInitialized())return this._delegate=t.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:n}=e.options;Jw(n,"invalid-api-key",{appName:e.name}),Jw(n,"invalid-api-key",{appName:e.name});const r="undefined"!=typeof window?$w:void 0;this._delegate=t.initialize({options:{persistence:eb(n,e.name),popupRedirectResolver:r}}),this._delegate._updateErrorMap(Zm),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Yw.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){!function(e,t,n){const r=ny(e);ug(r._canInitEmulator,r,"emulator-config-failed"),ug(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const i=!!(null==n?void 0:n.disableWarnings),s=iy(t),{host:o,port:a}=function(e){const t=iy(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const e=i[1];return{host:e,port:sy(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:sy(t)}}}(t),c=null===a?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(this._delegate,e,t)}applyActionCode(e){return async function(e,t){await async function(e,t){return Tg(e,"POST","/v1/accounts:update",_g(e,t))}(G(e),{oobCode:t})}(this._delegate,e)}checkActionCode(e){return jy(this._delegate,e)}confirmPasswordReset(e,t){return async function(e,t,n){await ay(G(e),{oobCode:t,newPassword:n})}(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return Ww(this._delegate,async function(e,t,n){const r=ny(e),i=await ky(r,{returnSecureToken:!0,email:t,password:n}),s=await Ay._fromIdTokenResponse(r,"signIn",i);return await r._updateCurrentUser(s.user),s}(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return async function(e,t){const n={identifier:t,continueUri:mg()?pg():"http://localhost"},{signinMethods:r}=await async function(e,t){return Tg(e,"POST","/v1/accounts:createAuthUri",_g(e,t))}(G(e),n);return r||[]}(this._delegate,e)}isSignInWithEmailLink(e){return function(e,t){const n=my.parseLink(t);return"EMAIL_SIGNIN"===(null==n?void 0:n.operation)}(this._delegate,e)}async getRedirectResult(){Jw(Mw(),this._delegate,"operation-not-supported-in-this-environment");const e=await async function(e,t){return await ny(e)._initializationPromise,Jv(e,t,!1)}(this._delegate,$w);return e?Ww(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){!function(e,t){ny(e)._logFramework(t)}(this._delegate,e)}onAuthStateChanged(e,t,n){const{next:r,error:i,complete:s}=Zw(e,t,n);return this._delegate.onAuthStateChanged(r,i,s)}onIdTokenChanged(e,t,n){const{next:r,error:i,complete:s}=Zw(e,t,n);return this._delegate.onIdTokenChanged(r,i,s)}sendSignInLinkToEmail(e,t){return async function(e,t,n){const r=G(e),i={requestType:"EMAIL_SIGNIN",email:t};ug(n.handleCodeInApp,r,"argument-error"),n&&By(r,i,n),await async function(e,t){return uy(e,t)}(r,i)}(this._delegate,e,t)}sendPasswordResetEmail(e,t){return async function(e,t,n){const r=G(e),i={requestType:"PASSWORD_RESET",email:t};n&&By(r,i,n),await async function(e,t){return uy(e,t)}(r,i)}(this._delegate,e,t||void 0)}async setPersistence(e){let t;switch(function(e,t){Uw(Object.values(Vw).includes(t),e,"invalid-persistence-type"),D()?Uw(t!==Vw.SESSION,e,"unsupported-persistence-type"):N()?Uw(t===Vw.NONE,e,"unsupported-persistence-type"):Lw()?Uw(t===Vw.NONE||t===Vw.LOCAL&&x(),e,"unsupported-persistence-type"):Uw(t===Vw.NONE||Ow(),e,"unsupported-persistence-type")}(this._delegate,e),e){case Vw.SESSION:t=ov;break;case Vw.LOCAL:t=await fg(Iv)._isAvailable()?Iv:iv;break;case Vw.NONE:t=qg;break;default:return ig("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Ww(this._delegate,async function(e){var t;const n=ny(e);if(await n._initializationPromise,null===(t=n.currentUser)||void 0===t?void 0:t.isAnonymous)return new Ay({user:n.currentUser,providerId:null,operationType:"signIn"});const r=await ky(n,{returnSecureToken:!0}),i=await Ay._fromIdTokenResponse(n,"signIn",r,!0);return await n._updateCurrentUser(i.user),i}(this._delegate))}signInWithCredential(e){return Ww(this._delegate,My(this._delegate,e))}signInWithCustomToken(e){return Ww(this._delegate,async function(e,t){const n=ny(e),r=await async function(e,t){return Sg(e,"POST","/v1/accounts:signInWithCustomToken",_g(e,t))}(n,{token:t,returnSecureToken:!0}),i=await Ay._fromIdTokenResponse(n,"signIn",r);return await n._updateCurrentUser(i.user),i}(this._delegate,e))}signInWithEmailAndPassword(e,t){return Ww(this._delegate,function(e,t,n){return My(G(e),gy.credential(t,n))}(this._delegate,e,t))}signInWithEmailLink(e,t){return Ww(this._delegate,async function(e,t,n){const r=G(e),i=gy.credentialWithLink(t,n||pg());return ug(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),My(r,i)}(this._delegate,e,t))}signInWithPhoneNumber(e,t){return Hw(this._delegate,async function(e,t,n){const r=ny(e),i=await Lv(r,t,G(n));return new Ov(i,(e=>My(r,e)))}(this._delegate,e,t))}async signInWithPopup(e){return Jw(Mw(),this._delegate,"operation-not-supported-in-this-environment"),Ww(this._delegate,async function(e,t,n){const r=ny(e);ag(e,t,yy);const i=Fv(r,n);return new $v(r,"signInViaPopup",t,i).executeNotNull()}(this._delegate,e,$w))}async signInWithRedirect(e){return Jw(Mw(),this._delegate,"operation-not-supported-in-this-environment"),await Bw(this._delegate),function(e,t,n){return async function(e,t,n){const r=ny(e);ag(e,t,yy);const i=Fv(r,n);return await Wv(i,r),i._openRedirect(r,t,"signInViaRedirect")}(e,t,n)}(this._delegate,e,$w)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return async function(e,t){const{data:n}=await jy(G(e),t);return n.email}(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}function Zw(e,t,n){let r=e;"function"!=typeof e&&({next:r,error:t,complete:n}=e);const i=r;return{next:e=>i(e&&Yw.getOrCreate(e)),error:t,complete:n}}function eb(e,t){const n=function(e,t){const n=jw();if(!n)return[];const r=Bg(qw,e,t);switch(n.getItem(r)){case Vw.NONE:return[qg];case Vw.LOCAL:return[Iv,ov];case Vw.SESSION:return[ov];default:return[]}}(e,t);if("undefined"==typeof self||n.includes(Iv)||n.push(Iv),"undefined"!=typeof window)for(const e of[iv,ov])n.includes(e)||n.push(e);return n.includes(qg)||n.push(qg),n}Xw.Persistence=Vw;class tb{constructor(){this.providerId="phone",this._delegate=new Mv(Gw(Jm.auth()))}static credential(e,t){return Mv.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}tb.PHONE_SIGN_IN_METHOD=Mv.PHONE_SIGN_IN_METHOD,tb.PROVIDER_ID=Mv.PROVIDER_ID;const nb=ug;var rb;function ib(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new _s("invalid-argument",`Invalid options passed to function ${e}(): You cannot specify both "merge" and "mergeFields".`);return t}function sb(){if("undefined"==typeof Uint8Array)throw new _s("unimplemented","Uint8Arrays are not available in this environment.")}function ob(){if("undefined"==typeof atob)throw new _s("unimplemented","Blobs are unavailable in Firestore in this environment.")}(rb=Jm).INTERNAL.registerComponent(new z("auth-compat",(e=>{const t=e.getProvider("app-compat").getImmediate(),n=e.getProvider("auth");return new Xw(t,n)}),"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:gy,FacebookAuthProvider:by,GithubAuthProvider:_y,GoogleAuthProvider:Iy,OAuthProvider:wy,SAMLAuthProvider:Ey,PhoneAuthProvider:tb,PhoneMultiFactorGenerator:ww,RecaptchaVerifier:class{constructor(e,t,n=Jm.app()){var r;nb(null===(r=n.options)||void 0===r?void 0:r.apiKey,"invalid-api-key",{appName:n.name}),this._delegate=new Pv(e,t,n.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}},TwitterAuthProvider:Sy,Auth:Xw,AuthCredential:oy,Error:P}).setInstantiationMode("LAZY").setMultipleInstances(!1)),rb.registerVersion("@firebase/auth-compat","0.2.14");class ab{constructor(e){this._delegate=e}static fromBase64String(e){return ob(),new ab(Mp.fromBase64String(e))}static fromUint8Array(e){return sb(),new ab(Mp.fromUint8Array(e))}toBase64(){return ob(),this._delegate.toBase64()}toUint8Array(){return sb(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function cb(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class ub{enableIndexedDbPersistence(e,t){return function(e,t){Op(e=gp(e,Dp));const n=Rp(e),r=e._freezeSettings(),i=new zf;return Pp(n,i,new $f(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function(e){Op(e=gp(e,Dp));const t=Rp(e),n=e._freezeSettings(),r=new zf;return Pp(t,r,new Gf(r,n.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function(e){if(e._initialized&&!e._terminated)throw new _s(Is.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const t=new Ts;return e._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(e){if(!ju.vt())return Promise.resolve();const t=e+"main";await ju.delete(t)}(vh(e._databaseId,e._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}(e._delegate)}}class lb{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof ro||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();e.merge||t.host===e.host||gs("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,n={}){!function(e,t,n,r={}){var i;const s=(e=gp(e,wp))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==t&&gs("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},s),{host:`${t}:${n}`,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=ls.MOCK_USER;else{t=function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[T(JSON.stringify({alg:"none",type:"JWT"})),T(JSON.stringify(s)),""].join(".")}(r.mockUserToken,null===(i=e._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new _s(Is.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new ls(s)}e._authCredentials=new ks(new Es(t,n))}}(this._delegate,e,t,n)}enableNetwork(){return function(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await rp(e),n=await sp(e);return t.setNetworkEnabled(!0),function(e){const t=bs(e);return t.wu.delete(0),yd(t)}(n)}))}(Rp(e=gp(e,Dp)))}(this._delegate)}disableNetwork(){return function(e){return function(e){return e.asyncQueue.enqueue((async()=>{const t=await rp(e),n=await sp(e);return t.setNetworkEnabled(!1),async function(e){const t=bs(e);t.wu.add(0),await vd(t),t.yu.set("Offline")}(n)}))}(Rp(e=gp(e,Dp)))}(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,dp("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function(e){return function(e){const t=new Ts;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t){const n=bs(e);Sd(n.remoteStore)||ps("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await function(e){const t=bs(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(e=>t.Bs.getHighestUnacknowledgedBatchId(e)))}(n.localStore);if(-1===e)return void t.resolve();const r=n.la.get(e)||[];r.push(t),n.la.set(e,r)}catch(e){const n=zd(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}(await op(e),t))),t.promise}(Rp(e=gp(e,Dp)))}(this._delegate)}onSnapshotsInSync(e){return function(e,t){return function(e,t){const n=new Hf(t);return e.asyncQueue.enqueueAndForget((async()=>function(e,t){bs(e).bu.add(t),t.next()}(await ap(e),n))),()=>{n.Aa(),e.asyncQueue.enqueueAndForget((async()=>function(e,t){bs(e).bu.delete(t)}(await ap(e),n)))}}(Rp(e=gp(e,Dp)),Np(t)?t:{next:t})}(this._delegate,e)}get app(){if(!this._appCompat)throw new _s("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Eb(this,Tp(this._delegate,e))}catch(e){throw gb(e,"collection()","Firestore.collection()")}}doc(e){try{return new mb(this,Ep(this._delegate,e))}catch(e){throw gb(e,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Ib(this,function(e,t){if(e=gp(e,wp),hp("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new _s(Is.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ip(e,null,function(e){return new ga($s.emptyPath(),e)}(t))}(this._delegate,e))}catch(e){throw gb(e,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function(e,t,n){e=gp(e,Dp);const r=Object.assign(Object.assign({},Pm),n);return function(e){if(e.maxAttempts<1)throw new _s(Is.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){const r=new Ts;return e.asyncQueue.enqueueAndForget((async()=>{const i=await function(e){return np(e).then((e=>e.datastore))}(e);new Jf(e.asyncQueue,i,n,t,r).run()})),r.promise}(Rp(e),(n=>t(new zm(e,n))),r)}(this._delegate,(t=>e(new db(this,t))))}batch(){return Rp(this._delegate),new fb(new Fm(this._delegate,(e=>$m(this._delegate,e))))}loadBundle(e){return function(e,t){const n=Rp(e=gp(e,Dp)),r=new Cp;return function(e,t,n,r){const i=function(e,t){let n;return n="string"==typeof e?(new TextEncoder).encode(e):e,function(e,t){return new Qf(e,t)}(function(e,t){if(e instanceof Uint8Array)return Wf(e,t);if(e instanceof ArrayBuffer)return Wf(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),t)}(n,ud(t));e.asyncQueue.enqueueAndForget((async()=>{!function(e,t,n){const r=bs(e);(async function(e,t,n){try{const r=await t.getMetadata();if(await function(e,t){const n=bs(e),r=Bc(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(e=>n._s.getBundleMetadata(e,t.id))).then((e=>!!e&&e.createTime.compareTo(r)>=0))}(e.localStore,r))return await t.close(),n._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(r)),Promise.resolve(new Set);n._updateProgress(cf(r));const i=new af(r,e.localStore,t.M);let s=await t.ma();for(;s;){const e=await i.Fu(s);e&&n._updateProgress(e),s=await t.ma()}const o=await i.complete();return await Df(e,o.Lu,void 0),await function(e,t){const n=bs(e);return n.persistence.runTransaction("Save bundle","readwrite",(e=>n._s.saveBundleMetadata(e,t)))}(e.localStore,r),n._completeWith(o.progress),Promise.resolve(o.Bu)}catch(e){return gs("SyncEngine",`Loading bundle failed with ${e}`),n._failWith(e),Promise.resolve(new Set)}})(r,t,n).then((e=>{r.sharedClientState.notifyBundleLoaded(e)}))}(await op(e),i,r)}))}(n,e._databaseId,t,r),r}(this._delegate,e)}namedQuery(e){return function(e,t){return function(e,t){return e.asyncQueue.enqueue((async()=>function(e,t){const n=bs(e);return n.persistence.runTransaction("Get named query","readonly",(e=>n._s.getNamedQuery(e,t)))}(await ip(e),t)))}(Rp(e=gp(e,Dp)),t).then((t=>t?new Ip(e,null,t.query):null))}(this._delegate,e).then((e=>e?new Ib(this,e):null))}}class hb extends Om{constructor(e){super(),this.firestore=e}convertBytes(e){return new ab(new Mp(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return mb.forKey(t,this.firestore,null)}}class db{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new hb(e)}get(e){const t=Sb(e);return this._delegate.get(t).then((e=>new wb(this._firestore,new mm(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,t.converter))))}set(e,t,n){const r=Sb(e);return n?(ib("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=Sb(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=Sb(e);return this._delegate.delete(t),this}}class fb{constructor(e){this._delegate=e}set(e,t,n){const r=Sb(e);return n?(ib("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}update(e,t,n,...r){const i=Sb(e);return 2===arguments.length?this._delegate.update(i,t):this._delegate.update(i,t,n,...r),this}delete(e){const t=Sb(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class pb{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){const n=new gm(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new bb(this._firestore,n),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const n=pb.INSTANCES;let r=n.get(e);r||(r=new WeakMap,n.set(e,r));let i=r.get(t);return i||(i=new pb(e,new hb(e),t),r.set(t,i)),i}}pb.INSTANCES=new WeakMap;class mb{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new hb(e)}static forPath(e,t,n){if(e.length%2!=0)throw new _s("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new mb(t,new bp(t._delegate,n,new ao(e)))}static forKey(e,t,n){return new mb(t,new bp(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new Eb(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Eb(this.firestore,Tp(this._delegate,e))}catch(e){throw gb(e,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=G(e))instanceof bp&&Sp(this._delegate,e)}set(e,t){t=ib("DocumentReference.set",t);try{return t?Bm(this._delegate,e,t):Bm(this._delegate,e)}catch(e){throw gb(e,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return 1===arguments.length?jm(this._delegate,e):jm(this._delegate,e,t,...n)}catch(e){throw gb(e,"updateDoc()","DocumentReference.update()")}}delete(){return function(e){return $m(gp(e.firestore,Dp),[new cc(e._key,Qa.none())])}(this._delegate)}onSnapshot(...e){const t=yb(e),n=vb(e,(e=>new wb(this.firestore,new mm(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))));return Km(this._delegate,t,n)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(e){e=gp(e,bp);const t=gp(e.firestore,Dp),n=Rp(t),r=new Um(t);return function(e,t){const n=new Ts;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await function(e,t){const n=bs(e);return n.persistence.runTransaction("read document","readonly",(e=>n.fi.Ls(e,t)))}(e,t);r.isFoundDocument()?n.resolve(r):r.isNoDocument()?n.resolve(null):n.reject(new _s(Is.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(e){const r=zd(e,`Failed to get document '${t} from cache`);n.reject(r)}}(await ip(e),t,n))),n.promise}(n,e._key).then((n=>new mm(t,r,e._key,n,new pm(null!==n&&n.hasLocalMutations,!0),e.converter)))}(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=gp(e,bp);const t=gp(e.firestore,Dp);return cp(Rp(t),e._key,{source:"server"}).then((n=>Gm(t,e,n)))}(this._delegate):function(e){e=gp(e,bp);const t=gp(e.firestore,Dp);return cp(Rp(t),e._key).then((n=>Gm(t,e,n)))}(this._delegate),t.then((e=>new wb(this.firestore,new mm(this.firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,this._delegate.converter))))}withConverter(e){return new mb(this.firestore,e?this._delegate.withConverter(pb.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function gb(e,t,n){return e.message=e.message.replace(t,n),e}function yb(e){for(const t of e)if("object"==typeof t&&!cb(t))return t;return{}}function vb(e,t){var n,r;let i;return i=cb(e[0])?e[0]:cb(e[1])?e[1]:"function"==typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]},{next:e=>{i.next&&i.next(t(e))},error:null===(n=i.error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class wb{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new mb(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return wm(this._delegate,e._delegate)}}class bb extends wb{data(e){const t=this._delegate.data(e);return function(e,t){e||vs()}(void 0!==t),t}}class Ib{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new hb(e)}where(e,t,n){try{return new Ib(this.firestore,_m(this._delegate,Em(e,t,n)))}catch(e){throw gb(e,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Ib(this.firestore,_m(this._delegate,function(e,t="asc"){const n=t,r=fm("orderBy",e);return new Sm(r,n)}(e,t)))}catch(e){throw gb(e,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Ib(this.firestore,_m(this._delegate,function(e){return yp("limit",e),new km("limit",e,"F")}(e)))}catch(e){throw gb(e,"limit()","Query.limit()")}}limitToLast(e){try{return new Ib(this.firestore,_m(this._delegate,function(e){return yp("limitToLast",e),new km("limitToLast",e,"L")}(e)))}catch(e){throw gb(e,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Ib(this.firestore,_m(this._delegate,function(...e){return new Am("startAt",e,!0)}(...e)))}catch(e){throw gb(e,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Ib(this.firestore,_m(this._delegate,function(...e){return new Am("startAfter",e,!1)}(...e)))}catch(e){throw gb(e,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Ib(this.firestore,_m(this._delegate,function(...e){return new Nm("endBefore",e,!1)}(...e)))}catch(e){throw gb(e,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Ib(this.firestore,_m(this._delegate,function(...e){return new Nm("endAt",e,!0)}(...e)))}catch(e){throw gb(e,"endAt()","Query.endAt()")}}isEqual(e){return kp(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function(e){e=gp(e,Ip);const t=gp(e.firestore,Dp),n=Rp(t),r=new Um(t);return function(e,t){const n=new Ts;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){try{const r=await Dh(e,t,!0),i=new hf(t,r._i),s=i.Wu(r.documents),o=i.applyChanges(s,!1);n.resolve(o.snapshot)}catch(e){const r=zd(e,`Failed to execute query '${t} against cache`);n.reject(r)}}(await ip(e),t,n))),n.promise}(n,e._query).then((n=>new ym(t,r,e,n)))}(this._delegate):"server"===(null==e?void 0:e.source)?function(e){e=gp(e,Ip);const t=gp(e.firestore,Dp),n=Rp(t),r=new Um(t);return up(n,e._query,{source:"server"}).then((n=>new ym(t,r,e,n)))}(this._delegate):qm(this._delegate),t.then((e=>new Tb(this.firestore,new ym(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))))}onSnapshot(...e){const t=yb(e),n=vb(e,(e=>new Tb(this.firestore,new ym(this.firestore._delegate,this._userDataWriter,this._delegate,e._snapshot))));return Km(this._delegate,t,n)}withConverter(e){return new Ib(this.firestore,e?this._delegate.withConverter(pb.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class _b{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new bb(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Tb{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Ib(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map((e=>new bb(this._firestore,e)))}docChanges(e){return this._delegate.docChanges(e).map((e=>new _b(this._firestore,e)))}forEach(e,t){this._delegate.forEach((n=>{e.call(t,new bb(this._firestore,n))}))}isEqual(e){return wm(this._delegate,e._delegate)}}class Eb extends Ib{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new mb(this.firestore,e):null}doc(e){try{return new mb(this.firestore,void 0===e?Ep(this._delegate):Ep(this._delegate,e))}catch(e){throw gb(e,"doc()","CollectionReference.doc()")}}add(e){return function(e,t){const n=gp(e.firestore,Dp),r=Ep(e),i=Lm(e.converter,t);return $m(n,[zp(Gp(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Qa.exists(!1))]).then((()=>r))}(this._delegate,e).then((e=>new mb(this.firestore,e)))}isEqual(e){return Sp(this._delegate,e._delegate)}withConverter(e){return new Eb(this.firestore,e?this._delegate.withConverter(pb.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Sb(e){return gp(e,bp)}class kb{constructor(...e){this._delegate=new Lp(...e)}static documentId(){return new kb(zs.keyField().canonicalString())}isEqual(e){return(e=G(e))instanceof Lp&&this._delegate._internalPath.isEqual(e._internalPath)}}class Ab{constructor(e){this._delegate=e}static serverTimestamp(){const e=new Qp("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new Ab(e)}static delete(){const e=new Wp("deleteField");return e._methodName="FieldValue.delete",new Ab(e)}static arrayUnion(...e){const t=function(...e){return new Yp("arrayUnion",e)}(...e);return t._methodName="FieldValue.arrayUnion",new Ab(t)}static arrayRemove(...e){const t=function(...e){return new Jp("arrayRemove",e)}(...e);return t._methodName="FieldValue.arrayRemove",new Ab(t)}static increment(e){const t=function(e){return new Xp("increment",e)}(e);return t._methodName="FieldValue.increment",new Ab(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const Nb={Firestore:lb,GeoPoint:Vp,Timestamp:Vs,Blob:ab,Transaction:db,WriteBatch:fb,DocumentReference:mb,DocumentSnapshot:wb,Query:Ib,QueryDocumentSnapshot:bb,QuerySnapshot:Tb,CollectionReference:Eb,FieldPath:kb,FieldValue:Ab,setLogLevel:function(e){!function(e){ds.setLogLevel(e)}(e)},CACHE_SIZE_UNLIMITED:-1};!function(e){!function(e,t){e.INTERNAL.registerComponent(new z("firestore-compat",(e=>((e,t)=>new lb(e,t,new ub))(e.getProvider("app-compat").getImmediate(),e.getProvider("firestore").getImmediate())),"PUBLIC").setServiceProps(Object.assign({},Nb)))}(e),e.registerVersion("@firebase/firestore-compat","0.1.18")}(Jm);const Cb=Jm.initializeApp({apiKey:"AIzaSyB_Aq0rBpwOcrbLM9n-rIxQHN38nukT1B0",authDomain:"heritage-b475a.firebaseapp.com",databaseURL:"https://heritage-b475a-default-rtdb.firebaseio.com",projectId:"heritage-b475a",storageBucket:"heritage-b475a.appspot.com",messagingSenderId:"1038614162962",appId:"1:1038614162962:web:0504abcd10154adf12b2cb"}).firestore(),Db=Cb.collection("Routes"),Rb=Cb.collection("Clients"),xb=Cb.collection("Reviews"),{roursEl:Pb,modalRoute:Ob,reviews:Lb}=b;var Mb;(async()=>{try{await Db.get().then((e=>e.docs.map((e=>e.data())))).then((e=>{e.forEach((e=>{Pb.innerHTML+=`\n\t\t\t\t<div id="${e.id}" class="card" style="width: 18rem;">\n\t\t\t\t\t<img src="${e.images[0]}" class="card-img-top" alt="image">\n\t\t\t\t\t<div class="card-body">\n\t\t\t\t\t\t<h5 class="card-title">${e.title}</h5>\n\t\t\t\t\t\t<p class="card-text tour">${e.desc}</p>\n\t\t\t\t\t\t<button class="btn btn-primary btn-getRouteInfo">Подробнее</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>`}))})),document.querySelectorAll(".btn-getRouteInfo").forEach((e=>{e.addEventListener("click",(async e=>{const t=e.target.parentElement.parentElement.getAttribute("id"),n=_m(Tp(Cb,"Routes"),Em("id","==",t));(await qm(n)).forEach((e=>{const t=e.data(),n=t.tourProgram.map(((e,t)=>`<div class="accordion-item">\n\t\t\t\t\t\t<h2 class="accordion-header" id="headingThree">\n\t\t\t\t\t\t\t<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${t+1}" aria-expanded="false" aria-controls="collapse${t+1}">\n\t\t\t\t\t\t\t\t<div class="numberDay">${t+1} день</div> <strong>${e.title}</strong>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</h2>\n\t\t\t\t\t\t<div id="collapse${t+1}" class="accordion-collapse collapse" aria-labelledby="heading${t+1}" data-bs-parent="#accordionExample">\n\t\t\t\t\t\t\t<div class="accordion-body">\n\t\t\t\t\t\t\t\t${e.desc}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`));if(Ob.innerHTML=`\n\t\t\t\t\t\t<div class="modal-content">\n\t\t\t\t\t\t\t<div class="modal-header">\n\t\t\t\t\t\t\t\t<span><h1 class="modal-title" id="exampleModalLabel">${t.title}</h1> <span>Сложность <strong>${t.complexity} / 5</strong></span> </span>\n\t\t\t\t\t\t\t\t<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="modal-body">\n\t\t\t\t\t\t\t\t<p>${t.desc}</p>\n\t\t\t\t\t\t\t\t<div id="carouselExampleControlsNoTouching" class="carousel slide" data-bs-touch="false" data-bs-interval="false">\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t\x3c!-- slider start --\x3e\n\t\t\t\t\t\t\t\t<div class="carousel-inner">\n\t\t\t\t\t\t\t\t\t<div class="carousel-item active">\n\t\t\t\t\t\t\t\t\t\t<img src="${t.images[0]}" class="d-block w-100" alt="image">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="carousel-item">\n\t\t\t\t\t\t\t\t\t\t<img src="${t.images[1]}" class="d-block w-100" alt="image">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="carousel-item">\n\t\t\t\t\t\t\t\t\t\t<img src="${t.images[2]}" class="d-block w-100" alt="image">\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControlsNoTouching" data-bs-slide="prev">\n\t\t\t\t\t\t\t\t\t<span class="carousel-control-prev-icon" aria-hidden="true"></span>\n\t\t\t\t\t\t\t\t\t<span class="visually-hidden">Previous</span>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t<button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControlsNoTouching" data-bs-slide="next">\n\t\t\t\t\t\t\t\t\t<span class="carousel-control-next-icon" aria-hidden="true"></span>\n\t\t\t\t\t\t\t\t\t<span class="visually-hidden">Next</span>\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\x3c!-- slider end --\x3e\n\n\t\t\t\t\t\t\t\t\x3c!-- accordion start --\x3e\n\t\t\t\t\t\t\t\t<h1 class="accordion-title">Программа тура</h1>\n\t\t\t\t\t\t\t\t<div class="accordion" id="accordionExample">\n\t\t\t\t\t\t\t\t${n.join(" ")}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\x3c!-- accordion end --\x3e\n\n\t\t\t\t\t\t\t\t<h1 class="accordion-title">Дополнительный услуги</h1>\n\t\t\t\t\t\t\t\t<ul class="list-group">\n\t\t\t\t\t\t\t\t\t${t.services.map((e=>`<li class="list-group-item">${e}</li>`)).join(" ")}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t`,e.id)return o.show()}))}))}))}catch(e){console.log(e),alert("Не удалось получить туры")}})(),(async()=>{try{await xb.get().then((e=>e.docs.map((e=>e.data())))).then((e=>{e.forEach((e=>{Lb.innerHTML+=`\n\t\t\t\t\t\t<div class="card text-bg-success mb-3" style="max-width: 18rem;">\n\t\t\t\t\t\t\t<div class="card-header">${e.tour_name}</div>\n\t\t\t\t\t\t\t<div class="card-body">\n\t\t\t\t\t\t\t\t<h5 class="card-title">${e.FIO}</h5>\n\t\t\t\t\t\t\t\t<p class="card-text">${e.comment}</p>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t`}))}))}catch(e){console.log(e),alert("Не удалось получить отзывы")}})();var Fb=new Uint8Array(16);function Vb(){if(!Mb&&!(Mb="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Mb(Fb)}const Ub=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,qb=function(e){return"string"==typeof e&&Ub.test(e)};for(var Bb=[],jb=0;jb<256;++jb)Bb.push((jb+256).toString(16).substr(1));const Kb=function(e,t,n){var r=(e=e||{}).random||(e.rng||Vb)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(Bb[e[t+0]]+Bb[e[t+1]]+Bb[e[t+2]]+Bb[e[t+3]]+"-"+Bb[e[t+4]]+Bb[e[t+5]]+"-"+Bb[e[t+6]]+Bb[e[t+7]]+"-"+Bb[e[t+8]]+Bb[e[t+9]]+"-"+Bb[e[t+10]]+Bb[e[t+11]]+Bb[e[t+12]]+Bb[e[t+13]]+Bb[e[t+14]]+Bb[e[t+15]]).toLowerCase();if(!qb(n))throw TypeError("Stringified UUID is invalid");return n}(r)},{formClients:$b,btnSubmitClient:Gb,btnSubmitRoute:zb,formRoutes:Wb,formClientsDevops:Hb,formReviews:Qb,btnSubmitReviews:Yb,reviews:Jb,roursEl:Xb}=b,Zb=async e=>{try{const{FIO:t,email:n,phone:r,sex:i}=e,s=Kb();return await Rb.add({id:s,...e}),{id:s,...e}}catch(e){console.log(e)}};$b.addEventListener("submit",(async e=>{const t=new FormData($b);Gb.disabled=!0;const n=await Zb({FIO:t.get("FIO"),phone:t.get("phone"),email:t.get("email")||null,sex:t.get("sex")});Gb.disabled=!1,n.id?(alert("Заявка успешно создана!"),$b.reset()):alert("Не удалось создать заявку"),e.preventDefault()})),Hb.addEventListener("submit",(async e=>{e.preventDefault();const t=new FormData($b);zb.disabled=!0;const n=await Zb({FIO:t.get("FIO"),phone:t.get("phone"),email:t.get("email")||null,sex:t.get("sex")});zb.disabled=!1,n.id?(alert("Заявка успешно создана!"),Hb.reset(),$b.reset()):alert("Не удалось создать заявку")})),Wb.addEventListener("submit",(async e=>{e.preventDefault();const t=new FormData(Wb);zb.disabled=!0;const n=await(async e=>{try{const{title:t,desc:n,complexity:r,images:i,services:s,tourProgram:o}=e,a=Kb();return await Db.add({id:a,...e}),{id:a,...e}}catch(e){console.log(e)}})({title:t.get("title"),desc:t.get("desc"),complexity:t.get("complexity"),images:t.get("images").split("|").map((e=>e.trim())),services:t.get("services").split("|").map((e=>e.trim())),tourProgram:t.get("tourProgram").split("|").map((e=>({title:e.split("&")[0].trim(),desc:e.split("&")[1].trim()})))});zb.disabled=!1,n.id?(Xb.innerHTML+=`\n\t\t<div id="${n.id}" class="card" style="width: 18rem;">\n\t\t\t<img src="${n.images[0]}" class="card-img-top" alt="image">\n\t\t\t<div class="card-body">\n\t\t\t\t<h5 class="card-title">${n.title}</h5>\n\t\t\t\t<p class="card-text">${n.desc}</p>\n\t\t\t\t<button class="btn btn-primary btn-getRouteInfo">Подробнее</button>\n\t\t\t</div>\n\t\t</div>`,Wb.reset()):alert("Не удалось добавить тур")})),Qb.addEventListener("submit",(async e=>{e.preventDefault();const t=new FormData(Qb);Yb.disabled=!0;const n=await(async e=>{try{const{FIO:t,comment:n,tour_name:r}=e,i=Kb();return await xb.add({id:i,...e}),{id:i,...e}}catch(e){console.log(e)}})({FIO:t.get("FIO"),tour_name:t.get("tour_name"),comment:t.get("comment")});Yb.disabled=!1,n.id?(Jb.innerHTML+=`\n\t\t<div class="card text-bg-success mb-3" style="max-width: 18rem;">\n\t\t\t<div class="card-header">${n.tour_name}</div>\n\t\t\t<div class="card-body">\n\t\t\t\t<h5 class="card-title">${n.FIO}</h5>\n\t\t\t\t<p class="card-text">${n.comment}</p>\n\t\t\t</div>\n\t\t</div>\n\t`,Qb.reset(),a.hide()):alert("Не удалось добавить отзыв")})),i.e(654).then(i.bind(i,654))})();